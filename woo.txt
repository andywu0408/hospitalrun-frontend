

DO NOT EVER ADD “WORKSPACE IN FILE PATH, start with src folder!” DO NOT ADD EM DASH! MUST CITE 5 real files in each section especially ideal answer!

Make sure to obey these 100% “

-  All answers should have  5+ meaningful sentences and clear as well 
- Adding a few file references in the feedback section could strength the answer.
- The ideal response could benefit from a dedicated file-list section summarizing all referenced files together.
- Adding separate strength and weakness points inside summaries would enhance readability and make the evaluation feel more complete.


1.new task, question is: “What kind of client side error handling is put in place across the reactjs codebase, and what kind of architectural design patterns does it follow?”




2.here is model A's response:    
bash
command
find /tmp/inputs/hospitalrun-frontend -type f -name "*.ts" -o -name "*.tsx" | head -50
output
/tmp/inputs/hospitalrun-frontend/src/index.tsx
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
/tmp/inputs/hospitalrun-frontend/src/custom-pouchdb.d.ts
/tmp/inputs/hospitalrun-frontend/src/react-app-env.d.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/Incidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/IncidentFilter.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/model/IncidentSearchRequest.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/Imagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/model/ImagingSearchRequest.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ImagingRequestTable.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ViewImagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/useAddBreadcrumbs.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/Breadcrumbs.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/breadcrumbs-slice.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonToolBar.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/App.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/HospitalRun.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/Incidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/report/ReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/view/ViewIncidentDetails.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/view/ViewIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/list/ViewIncidentsTable.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/list/ViewIncidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useResolvedIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useIncidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/util/validate-incident.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/Imagings.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/hooks/useRequestImaging.test.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend, excluding hidden items and node_modules:
113M	/tmp/inputs/hospitalrun-frontend
79K	/tmp/inputs/hospitalrun-frontend/CHANGELOG.md
1.5K	/tmp/inputs/hospitalrun-frontend/LICENSE
3.0K	/tmp/inputs/hospitalrun-frontend/README.md
1.5K	/tmp/inputs/hospitalrun-frontend/SECURITY.md
3.0K	/tmp/inputs/hospitalrun-frontend/azure.yaml
512	/tmp/inputs/hospitalrun-frontend/commitlint.config.js
3.0K	/tmp/inputs/hospitalrun-frontend/couchdb
512	/tmp/inputs/hospitalrun-frontend/couchdb/Dockerfile
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-cleanup.bat
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-cleanup.sh
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-init.bat
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-init.sh
512	/tmp/inputs/hospitalrun-frontend/couchdb/local.ini
1.5K	/tmp/inputs/hospitalrun-frontend/docker-compose.yml
512	/tmp/inputs/hospitalrun-frontend/docs
512	/tmp/inputs/hospitalrun-frontend/docs/index.md
512	/tmp/inputs/hospitalrun-frontend/jest.config.js
512	/tmp/inputs/hospitalrun-frontend/mkdocs.yml
512	/tmp/inputs/hospitalrun-frontend/nginx.conf
5.5K	/tmp/inputs/hospitalrun-frontend/package.json
20K	/tmp/inputs/hospitalrun-frontend/public
1.5K	/tmp/inputs/hospitalrun-frontend/public/favicon.ico
2.0K	/tmp/inputs/hospitalrun-frontend/public/index.html
16K	/tmp/inputs/hospitalrun-frontend/public/logo.png
512	/tmp/inputs/hospitalrun-frontend/public/manifest.json
512	/tmp/inputs/hospitalrun-frontend/public/robots.txt
3.5K	/tmp/inputs/hospitalrun-frontend/scripts
2.5K	/tmp/inputs/hospitalrun-frontend/scripts/check-translations
512	/tmp/inputs/hospitalrun-frontend/scripts/tsconfig.json
1.2M	/tmp/inputs/hospitalrun-frontend/src
2.0K	/tmp/inputs/hospitalrun-frontend/src/App.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/__mocks__
564K	/tmp/inputs/hospitalrun-frontend/src/__tests__
1.5K	/tmp/inputs/hospitalrun-frontend/src/custom-pouchdb.d.ts
512	/tmp/inputs/hospitalrun-frontend/src/dashboard
17K	/tmp/inputs/hospitalrun-frontend/src/imagings
29K	/tmp/inputs/hospitalrun-frontend/src/incidents
2.0K	/tmp/inputs/hospitalrun-frontend/src/index.css
1.0K	/tmp/inputs/hospitalrun-frontend/src/index.tsx
28K	/tmp/inputs/hospitalrun-frontend/src/labs
36K	/tmp/inputs/hospitalrun-frontend/src/medications
6.5K	/tmp/inputs/hospitalrun-frontend/src/page-header
192K	/tmp/inputs/hospitalrun-frontend/src/patients
512	/tmp/inputs/hospitalrun-frontend/src/react-app-env.d.ts
30K	/tmp/inputs/hospitalrun-frontend/src/scheduling
5.5K	/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/settings
1.0K	/tmp/inputs/hospitalrun-frontend/src/setupTests.js
254K	/tmp/inputs/hospitalrun-frontend/src/shared
4.0K	/tmp/inputs/hospitalrun-frontend/src/user
1.0K	/tmp/inputs/hospitalrun-frontend/tsconfig.json



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/shared, excluding hidden items and node_modules:
254K	/tmp/inputs/hospitalrun-frontend/src/shared
38K	/tmp/inputs/hospitalrun-frontend/src/shared/components
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/PageComponent.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/PrivateRoute.tsx
15K	/tmp/inputs/hospitalrun-frontend/src/shared/components/Sidebar.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/component-slice.ts
8.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input
7.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/navbar
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/config
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/config/i18n.ts
2.5K	/tmp/inputs/hospitalrun-frontend/src/shared/config/pouchdb.ts
15K	/tmp/inputs/hospitalrun-frontend/src/shared/db
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/AppointmentRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/ImagingRepository.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/db/IncidentRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/LabRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/MedicationRepository.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Page.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/PageRequest.ts
2.0K	/tmp/inputs/hospitalrun-frontend/src/shared/db/PatientRepository.ts
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Search.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Sort.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/SortRequest.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/hooks
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useDebounce.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useTranslator.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useUpdateEffect.ts
151K	/tmp/inputs/hospitalrun-frontend/src/shared/locales
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/README.md
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ar
15K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/de
21K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/es
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/id
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/index.ts
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/it
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ja
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr
27K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru
22K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/zhCN
13K	/tmp/inputs/hospitalrun-frontend/src/shared/model
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/AbstractDBModel.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Allergy.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Appointment.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Breadcrumb.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/CareGoal.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/CarePlan.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/ContactInformation.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Diagnosis.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Imaging.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Incident.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Lab.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Medication.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Name.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Note.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Patient.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/PatientHistoryRecord.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Permissions.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/RelatedPerson.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/User.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Visit.ts
29K	/tmp/inputs/hospitalrun-frontend/src/shared/static
29K	/tmp/inputs/hospitalrun-frontend/src/shared/static/images
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/store
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts
3.0K	/tmp/inputs/hospitalrun-frontend/src/shared/util
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/util/DataHelpers.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/extractUsername.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/formatDate.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/generateCode.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/uuid.ts



bash
command
grep -r "error" /tmp/inputs/hospitalrun-frontend/src --include="*.ts" --include="*.tsx" -l | head -30
output
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/report/ReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/util/validate-incident.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/Imagings.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/hooks/useRequestImaging.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/requests/NewImagingRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/util/validate-imaging-request.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/user/user-slice.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/hooks/useScheduleAppointment.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/appointments/AppointmentDetailForm.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/appointments/new/NewAppointment.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/ViewMedication.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/Medications.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/medication-slice.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/requests/NewMedicationRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/test-utils/console.utils.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/ViewLab.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/hooks/useRequestLab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/hooks/useCompleteLab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/requests/NewLabRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/utils/validate-lab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/patients/ContactInfo.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/patients/GeneralInformation.test.tsx


bash
command
grep -r "Error" /tmp/inputs/hospitalrun-frontend/src --include="*.ts" --include="*.tsx" -l | grep -v "__tests__"
output
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
/tmp/inputs/hospitalrun-frontend/src/shared/locales/zhCN/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/states/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/es/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/id/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ar/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/it/translations/states/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/it/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/it/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ja/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/edit/EditAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts
/tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/search/MedicationRequestSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCompleteLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useRemovePatientRelatedPerson.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCarePlan.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientNote.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAllergy.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCareGoal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useDiagnosis.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/notes/NewNoteModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/edit/EditPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/AddDiagnosisModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/DiagnosisForm.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/AddCareGoalModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalForm.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/AddCarePlanModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/CarePlanForm.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/visits/VisitForm.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/visits/AddVisitModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-allergy.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-diagnosis.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-related-person.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-note.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-visit.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-careplan.ts

Let me look at the validation utilities and hooks to understand the error handling patterns:

str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts with line numbers:
1	import isAfter from 'date-fns/isAfter'
2	import parseISO from 'date-fns/parseISO'
3	import validator from 'validator'
4
5	import { ContactInfoPiece } from '../../shared/model/ContactInformation'
6	import Patient from '../../shared/model/Patient'
7
8	const validateEmails = (emails: ContactInfoPiece[] | undefined) =>
9	  (emails ?? []).map((email) =>
10	    !validator.isEmail(email.value) ? 'patient.errors.invalidEmail' : undefined,
11	  )
12
13	const validatePhoneNumbers = (phoneNumbers: ContactInfoPiece[] | undefined) =>
14	  (phoneNumbers ?? []).map((phone) =>
15	    !validator.isMobilePhone(phone.value) ? 'patient.errors.invalidPhoneNumber' : undefined,
16	  )
17
18	const existAndIsAfterToday = (value: string | undefined) => {
19	  if (!value) {
20	    return false
21	  }
22
23	  const today = new Date(Date.now())
24	  const dateOfBirth = parseISO(value)
25
26	  return isAfter(dateOfBirth, today)
27	}
28
29	const existAndHasNumbers = (value: string | undefined) => value && /\d/.test(value)
30
31	interface IPatientFieldErrors {
32	  givenName?: 'patient.errors.patientGivenNameFeedback'
33	  dateOfBirth?: 'patient.errors.patientDateOfBirthFeedback'
34	  suffix?: 'patient.errors.patientNumInSuffixFeedback'
35	  prefix?: 'patient.errors.patientNumInPrefixFeedback'
36	  familyName?: 'patient.errors.patientNumInFamilyNameFeedback'
37	  preferredLanguage?: 'patient.errors.patientNumInPreferredLanguageFeedback'
38	  emails?: ('patient.errors.invalidEmail' | undefined)[]
39	  phoneNumbers?: ('patient.errors.invalidPhoneNumber' | undefined)[]
40	}
41
42	export class PatientValidationError extends Error {
43	  public fieldErrors: IPatientFieldErrors
44
45	  constructor() {
46	    super('Patient data is invalid.')
47	    this.name = 'PatientValidationError'
48	    this.fieldErrors = {}
49	  }
50
51	  get count(): number {
52	    return Object.keys(this.fieldErrors).length
53	  }
54	}
55
56	export default function validatePatient(patient: Patient) {
57	  const error = new PatientValidationError()
58
59	  if (!patient.givenName) {
60	    error.fieldErrors.givenName = 'patient.errors.patientGivenNameFeedback'
61	  }
62
63	  if (existAndIsAfterToday(patient.dateOfBirth)) {
64	    error.fieldErrors.dateOfBirth = 'patient.errors.patientDateOfBirthFeedback'
65	  }
66
67	  if (existAndHasNumbers(patient.suffix)) {
68	    error.fieldErrors.suffix = 'patient.errors.patientNumInSuffixFeedback'
69	  }
70
71	  if (existAndHasNumbers(patient.prefix)) {
72	    error.fieldErrors.prefix = 'patient.errors.patientNumInPrefixFeedback'
73	  }
74
75	  if (existAndHasNumbers(patient.familyName)) {
76	    error.fieldErrors.familyName = 'patient.errors.patientNumInFamilyNameFeedback'
77	  }
78
79	  if (existAndHasNumbers(patient.preferredLanguage)) {
80	    error.fieldErrors.preferredLanguage = 'patient.errors.patientNumInPreferredLanguageFeedback'
81	  }
82
83	  const emailsErrors = validateEmails(patient.emails)
84	  const phoneNumbersErrors = validatePhoneNumbers(patient.phoneNumbers)
85
86	  if (emailsErrors.some(Boolean)) {
87	    error.fieldErrors.emails = emailsErrors
88	  }
89
90	  if (phoneNumbersErrors.some(Boolean)) {
91	    error.fieldErrors.phoneNumbers = phoneNumbersErrors
92	  }
93
94	  if (error.count === 0) {
95	    return null
96	  }
97
98	  return error
99	}
100	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts with line numbers:
1	import isAfter from 'date-fns/isAfter'
2
3	import Incident from '../../shared/model/Incident'
4
5	export class IncidentError extends Error {
6	  date?: string
7
8	  department?: string
9
10	  category?: string
11
12	  categoryItem?: string
13
14	  description?: string
15
16	  constructor(
17	    message: string,
18	    date: string,
19	    department: string,
20	    category: string,
21	    categoryItem: string,
22	    description: string,
23	  ) {
24	    super(message)
25	    this.date = date
26	    this.department = department
27	    this.category = category
28	    this.categoryItem = categoryItem
29	    this.description = description
30	    Object.setPrototypeOf(this, IncidentError.prototype)
31	  }
32	}
33
34	export default function validateIncident(incident: Incident): IncidentError {
35	  const newError: any = {}
36
37	  if (!incident.date) {
38	    newError.date = 'incidents.reports.error.dateRequired'
39	  } else if (isAfter(new Date(incident.date), new Date(Date.now()))) {
40	    newError.date = 'incidents.reports.error.dateMustBeInThePast'
41	  }
42
43	  if (!incident.department) {
44	    newError.department = 'incidents.reports.error.departmentRequired'
45	  }
46
47	  if (!incident.category) {
48	    newError.category = 'incidents.reports.error.categoryRequired'
49	  }
50
51	  if (!incident.categoryItem) {
52	    newError.categoryItem = 'incidents.reports.error.categoryItemRequired'
53	  }
54
55	  if (!incident.description) {
56	    newError.description = 'incidents.reports.error.descriptionRequired'
57	  }
58
59	  return newError as IncidentError
60	}
61	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3	import shortid from 'shortid'
4
5	import IncidentRepository from '../../shared/db/IncidentRepository'
6	import Incident from '../../shared/model/Incident'
7	import validateIncident from '../util/validate-incident'
8
9	const getIncidentCode = (): string => `I-${shortid.generate()}`
10
11	export function reportIncident(incident: Incident): Promise<Incident> {
12	  const error = validateIncident(incident)
13	  if (isEmpty(error)) {
14	    const updatedIncident: Incident = {
15	      ...incident,
16	      code: getIncidentCode(),
17	      status: 'reported',
18	      reportedBy: 'some user',
19	      reportedOn: new Date(Date.now()).toISOString(),
20	    }
21	    return IncidentRepository.save(updatedIncident)
22	  }
23
24	  throw error
25	}
26
27	export default function useReportIncident() {
28	  return useMutation(reportIncident, {
29	    onSuccess: async () => {
30	      await queryCache.invalidateQueries('incidents')
31	    },
32	    throwOnError: true,
33	  })
34	}
35	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx with line numbers:
1	import { Button, Row, Column, Typeahead, Label } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3	import { useHistory } from 'react-router-dom'
4
5	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
6	import { useUpdateTitle } from '../../page-header/title/TitleContext'
7	import DateTimePickerWithLabelFormGroup from '../../shared/components/input/DateTimePickerWithLabelFormGroup'
8	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
9	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
10	import PatientRepository from '../../shared/db/PatientRepository'
11	import useTranslator from '../../shared/hooks/useTranslator'
12	import Incident from '../../shared/model/Incident'
13	import Patient from '../../shared/model/Patient'
14	import useReportIncident from '../hooks/useReportIncident'
15	import { IncidentError } from '../util/validate-incident'
16
17	const ReportIncident = () => {
18	  const [mutate] = useReportIncident()
19	  const history = useHistory()
20	  const { t } = useTranslator()
21	  const updateTitle = useUpdateTitle()
22	  useEffect(() => {
23	    updateTitle(t('incidents.reports.new'))
24	  })
25	  const breadcrumbs = [
26	    {
27	      i18nKey: 'incidents.reports.new',
28	      location: `/incidents/new`,
29	    },
30	  ]
31	  useAddBreadcrumbs(breadcrumbs)
32	  const [incident, setIncident] = useState({
33	    date: new Date().toISOString(),
34	    department: '',
35	    category: '',
36	    categoryItem: '',
37	    description: '',
38	    patient: '',
39	  })
40
41	  const [error, setError] = useState<IncidentError | undefined>(undefined)
42
43	  const onDateChange = (newDate: Date) => {
44	    setIncident((prevState) => ({
45	      ...prevState,
46	      date: newDate.toISOString(),
47	    }))
48	  }
49
50	  const onTextInputChange = (text: string, name: string) => {
51	    setIncident((prevState) => ({
52	      ...prevState,
53	      [name]: text,
54	    }))
55	  }
56
57	  const onSave = async () => {
58	    try {
59	      const data = await mutate(incident as Incident)
60	      history.push(`/incidents/${data?.id}`)
61	    } catch (e) {
62	      setError(e)
63	    }
64	  }
65
66	  const onCancel = () => {
67	    history.push('/incidents')
68	  }
69
70	  const onPatientChange = (patient: Patient) => {
71	    if (patient) {
72	      setIncident((prevIncident) => ({
73	        ...prevIncident,
74	        patient: patient.id,
75	      }))
76	    } else {
77	      setIncident((prevIncident) => ({
78	        ...prevIncident,
79	        patient: '',
80	      }))
81	    }
82	  }
83
84	  return (
85	    <form aria-label="Report Incident form">
86	      <Row>
87	        <Column md={6}>
88	          <DateTimePickerWithLabelFormGroup
89	            name="dateOfIncident"
90	            label={t('incidents.reports.dateOfIncident')}
91	            isEditable
92	            isRequired
93	            onChange={onDateChange}
94	            value={new Date(incident.date)}
95	            isInvalid={!!error?.date}
96	            feedback={t(error?.date as string)}
97	          />
98	        </Column>
99	        <Column md={6}>
100	          <TextInputWithLabelFormGroup
101	            label={t('incidents.reports.department')}
102	            name="department"
103	            isRequired
104	            isEditable
105	            value={incident.department}
106	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'department')}
107	            isInvalid={!!error?.department}
108	            feedback={t(error?.department as string)}
109	          />
110	        </Column>
111	      </Row>
112	      <Row>
113	        <Column md={6}>
114	          <TextInputWithLabelFormGroup
115	            name="category"
116	            label={t('incidents.reports.category')}
117	            isEditable
118	            isRequired
119	            value={incident.category}
120	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'category')}
121	            isInvalid={!!error?.category}
122	            feedback={t(error?.category as string)}
123	          />
124	        </Column>
125	        <Column md={6}>
126	          <TextInputWithLabelFormGroup
127	            label={t('incidents.reports.categoryItem')}
128	            name="categoryItem"
129	            isRequired
130	            isEditable
131	            value={incident.categoryItem}
132	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'categoryItem')}
133	            isInvalid={!!error?.categoryItem}
134	            feedback={t(error?.categoryItem as string)}
135	          />
136	        </Column>
137	      </Row>
138	      <Row>
139	        <Column md={12}>
140	          <TextFieldWithLabelFormGroup
141	            label={t('incidents.reports.description')}
142	            name="description"
143	            isRequired
144	            isEditable
145	            value={incident.description}
146	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'description')}
147	            isInvalid={!!error?.description}
148	            feedback={t(error?.description as string)}
149	          />
150	        </Column>
151	      </Row>
152	      <Row>
153	        <Column md={6}>
154	          <div className="form-group patient-typeahead">
155	            <Label htmlFor="patientTypeahead" text={t('incidents.reports.patient')} />
156	            <Typeahead
157	              id="patientTypeahead"
158	              placeholder={t('incidents.reports.patient')}
159	              onChange={(p: Patient[]) => onPatientChange(p[0])}
160	              onSearch={async (query: string) => PatientRepository.search(query)}
161	              searchAccessor="fullName"
162	              renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
163	            />
164	          </div>
165	        </Column>
166	      </Row>
167
168	      <div className="row float-right">
169	        <div className="btn-group btn-group-lg mt-3 mr-3">
170	          <Button className="mr-2" color="success" onClick={onSave}>
171	            {t('incidents.reports.new')}
172	          </Button>
173	          <Button color="danger" onClick={onCancel}>
174	            {t('actions.cancel')}
175	          </Button>
176	        </div>
177	      </div>
178	    </form>
179	  )
180	}
181
182	export default ReportIncident
183	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3
4	import PatientRepository from '../../shared/db/PatientRepository'
5	import Diagnosis from '../../shared/model/Diagnosis'
6	import { uuid } from '../../shared/util/uuid'
7	import validateDiagnosis from '../util/validate-diagnosis'
8
9	interface AddDiagnosisRequest {
10	  patientId: string
11	  diagnosis: Omit<Diagnosis, 'id'>
12	}
13
14	async function addDiagnosis(request: AddDiagnosisRequest): Promise<Diagnosis[]> {
15	  const error = validateDiagnosis(request.diagnosis)
16	  if (isEmpty(error)) {
17	    const patient = await PatientRepository.find(request.patientId)
18	    const diagnoses = patient.diagnoses ? [...patient.diagnoses] : []
19	    const newDiagnosis: Diagnosis = {
20	      id: uuid(),
21	      ...request.diagnosis,
22	    }
23	    diagnoses.push(newDiagnosis)
24	    await PatientRepository.saveOrUpdate({ ...patient, diagnoses })
25	    return diagnoses
26	  }
27	  throw error
28	}
29
30	export default function useAddPatientDiagnosis() {
31	  return useMutation(addDiagnosis, {
32	    onSuccess: async (data, variables) => {
33	      await queryCache.setQueryData(['diagnoses', variables.patientId], data)
34	    },
35	    throwOnError: true,
36	  })
37	}
38	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx with line numbers:
1	import { Button, Toast } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3	import { useDispatch, useSelector } from 'react-redux'
4	import { useHistory } from 'react-router-dom'
5
6	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
7	import { useUpdateTitle } from '../../page-header/title/TitleContext'
8	import useTranslator from '../../shared/hooks/useTranslator'
9	import Patient from '../../shared/model/Patient'
10	import { RootState } from '../../shared/store'
11	import GeneralInformation from '../GeneralInformation'
12	import { createPatient } from '../patient-slice'
13	import { isPossibleDuplicatePatient } from '../util/is-possible-duplicate-patient'
14	import DuplicateNewPatientModal from './DuplicateNewPatientModal'
15
16	const breadcrumbs = [
17	  { i18nKey: 'patients.label', location: '/patients' },
18	  { i18nKey: 'patients.newPatient', location: '/patients/new' },
19	]
20
21	const NewPatient = () => {
22	  const { t } = useTranslator()
23	  const history = useHistory()
24	  const dispatch = useDispatch()
25	  const { createError } = useSelector((state: RootState) => state.patient)
26	  const { patients } = Object(useSelector((state: RootState) => state.patients))
27
28	  const [patient, setPatient] = useState({} as Patient)
29	  const [duplicatePatient, setDuplicatePatient] = useState<Patient | undefined>(undefined)
30	  const [showDuplicateNewPatientModal, setShowDuplicateNewPatientModal] = useState<boolean>(false)
31
32	  const testPatient = {
33	    givenName: 'Kelly',
34	    familyName: 'Clark',
35	    sex: 'female',
36	    dateOfBirth: '1963-01-09T05:00:00.000Z',
37	  } as Patient
38
39	  const updateTitle = useUpdateTitle()
40	  useEffect(() => {
41	    updateTitle(t('patients.newPatient'))
42	  })
43	  useAddBreadcrumbs(breadcrumbs, true)
44
45	  const onCancel = () => {
46	    history.push('/patients')
47	  }
48
49	  const onSuccessfulSave = (newPatient: Patient) => {
50	    history.push(`/patients/${newPatient.id}`)
51	    Toast(
52	      'success',
53	      t('states.success'),
54	      `${t('patients.successfullyCreated')} ${newPatient.fullName}`,
55	    )
56	  }
57
58	  const onSave = () => {
59	    let duplicatePatients = []
60	    if (patients !== undefined) {
61	      duplicatePatients = patients.filter((existingPatient: any) =>
62	        isPossibleDuplicatePatient(patient, existingPatient),
63	      )
64	    }
65
66	    if (duplicatePatients.length > 0) {
67	      setShowDuplicateNewPatientModal(true)
68	      setDuplicatePatient(duplicatePatients as Patient)
69	    } else {
70	      dispatch(createPatient(patient, onSuccessfulSave))
71	    }
72
73	    const testCase = [isPossibleDuplicatePatient(patient, testPatient)]
74	    if (testCase.length > 0) {
75	      return true
76	    }
77	    return false
78	  }
79
80	  const onPatientChange = (newPatient: Partial<Patient>) => {
81	    setPatient(newPatient as Patient)
82	  }
83
84	  const createDuplicateNewPatient = () => {
85	    dispatch(createPatient(patient, onSuccessfulSave))
86	  }
87
88	  const closeDuplicateNewPatientModal = () => {
89	    setShowDuplicateNewPatientModal(false)
90	  }
91
92	  return (
93	    <div>
94	      <GeneralInformation
95	        patient={patient}
96	        isEditable
97	        onChange={onPatientChange}
98	        error={createError}
99	      />
100	      <div className="row float-right">
101	        <div className="btn-group btn-group-lg mt-3 mr-3">
102	          <Button className="btn-save mr-2" color="success" onClick={onSave}>
103	            {t('patients.createPatient')}
104	          </Button>
105	          <Button className="btn-cancel" color="danger" onClick={onCancel}>
106	            {t('actions.cancel')}
107	          </Button>
108	        </div>
109	      </div>
110
111	      <DuplicateNewPatientModal
112	        duplicatePatient={duplicatePatient}
113	        show={showDuplicateNewPatientModal}
114	        toggle={closeDuplicateNewPatientModal}
115	        onContinueButtonClick={createDuplicateNewPatient}
116	        onCloseButtonClick={closeDuplicateNewPatientModal}
117	      />
118	    </div>
119	  )
120	}
121
122	export default NewPatient
123	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts with line numbers:
1	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
2	import isEmpty from 'lodash/isEmpty'
3
4	import PatientRepository from '../shared/db/PatientRepository'
5	import Diagnosis from '../shared/model/Diagnosis'
6	import Patient from '../shared/model/Patient'
7	import { AppThunk } from '../shared/store'
8	import { uuid } from '../shared/util/uuid'
9	import { cleanupPatient } from './util/set-patient-helper'
10	import validatePatient from './util/validate-patient'
11
12	interface PatientState {
13	  status: 'loading' | 'error' | 'completed'
14	  isUpdatedSuccessfully: boolean
15	  patient: Patient
16	  relatedPersons: Patient[]
17	  createError?: Error
18	  updateError?: Error
19	  allergyError?: AddAllergyError
20	  diagnosisError?: AddDiagnosisError
21	  relatedPersonError?: AddRelatedPersonError
22	}
23
24	interface Error {
25	  message?: string
26	  givenName?: string
27	  dateOfBirth?: string
28	  suffix?: string
29	  prefix?: string
30	  familyName?: string
31	  preferredLanguage?: string
32	  emails?: (string | undefined)[]
33	  phoneNumbers?: (string | undefined)[]
34	}
35
36	interface AddRelatedPersonError {
37	  message?: string
38	  relatedPerson?: string
39	  relationshipType?: string
40	}
41
42	interface AddAllergyError {
43	  message?: string
44	  name?: string
45	}
46
47	interface AddDiagnosisError {
48	  message?: string
49	  name?: string
50	  date?: string
51	  status?: string
52	}
53
54	const initialState: PatientState = {
55	  status: 'loading',
56	  isUpdatedSuccessfully: false,
57	  patient: {} as Patient,
58	  relatedPersons: [],
59	  createError: undefined,
60	  updateError: undefined,
61	  diagnosisError: undefined,
62	  relatedPersonError: undefined,
63	}
64
65	function start(state: PatientState) {
66	  state.status = 'loading'
67	  state.createError = {}
68	}
69
70	const patientSlice = createSlice({
71	  name: 'patient',
72	  initialState,
73	  reducers: {
74	    createPatientStart: start,
75	    createPatientSuccess(state) {
76	      state.status = 'completed'
77	    },
78	    createPatientError(state, { payload }: PayloadAction<Error>) {
79	      state.status = 'error'
80	      state.createError = payload
81	    },
82	    updatePatientStart: start,
83	    updatePatientSuccess(state, { payload }: PayloadAction<Patient>) {
84	      state.status = 'completed'
85	      state.patient = payload
86	    },
87	    updatePatientError(state, { payload }: PayloadAction<Error>) {
88	      state.status = 'error'
89	      state.updateError = payload
90	    },
91	    addDiagnosisError(state, { payload }: PayloadAction<AddDiagnosisError>) {
92	      state.status = 'error'
93	      state.diagnosisError = payload
94	    },
95	  },
96	})
97
98	export const {
99	  createPatientStart,
100	  createPatientSuccess,
101	  createPatientError,
102	  updatePatientStart,
103	  updatePatientSuccess,
104	  updatePatientError,
105	  addDiagnosisError,
106	} = patientSlice.actions
107
108	export const createPatient = (
109	  patient: Patient,
110	  onSuccess?: (patient: Patient) => void,
111	): AppThunk => async (dispatch) => {
112	  dispatch(createPatientStart())
113
114	  const cleanPatient = cleanupPatient(patient)
115	  const newPatientError = validatePatient(cleanPatient)
116
117	  if (!newPatientError) {
118	    const newPatient = await PatientRepository.save(cleanPatient)
119	    dispatch(createPatientSuccess())
120
121	    if (onSuccess) {
122	      onSuccess(newPatient)
123	    }
124	  } else {
125	    dispatch(
126	      createPatientError({
127	        ...newPatientError.fieldErrors,
128	        message: 'patient.errors.createPatientError',
129	      }),
130	    )
131	  }
132	}
133
134	export const updatePatient = (
135	  patient: Patient,
136	  onSuccess?: (patient: Patient) => void,
137	): AppThunk => async (dispatch) => {
138	  dispatch(updatePatientStart())
139
140	  const cleanPatient = cleanupPatient(patient)
141	  const updateError = validatePatient(cleanPatient)
142
143	  if (!updateError) {
144	    const updatedPatient = await PatientRepository.saveOrUpdate(cleanPatient)
145	    dispatch(updatePatientSuccess(updatedPatient))
146
147	    if (onSuccess) {
148	      onSuccess(updatedPatient)
149	    }
150	  } else {
151	    dispatch(
152	      updatePatientError({
153	        ...updateError.fieldErrors,
154	        message: 'patient.errors.updatePatientError',
155	      }),
156	    )
157	  }
158	}
159
160	function validateDiagnosis(diagnosis: Diagnosis) {
161	  const error: AddDiagnosisError = {}
162
163	  if (!diagnosis.name) {
164	    error.name = 'patient.diagnoses.error.nameRequired'
165	  }
166
167	  if (!diagnosis.diagnosisDate) {
168	    error.date = 'patient.diagnoses.error.dateRequired'
169	  }
170
171	  if (!diagnosis.onsetDate) {
172	    error.date = 'patient.diagnoses.error.dateRequired'
173	  }
174
175	  if (!diagnosis.status) {
176	    error.status = 'patient.diagnoses.error.statusRequired'
177	  }
178	  return error
179	}
180
181	export const addDiagnosis = (
182	  patientId: string,
183	  diagnosis: Diagnosis,
184	  onSuccess?: (patient: Patient) => void,
185	): AppThunk => async (dispatch) => {
186	  const newDiagnosisError = validateDiagnosis(diagnosis)
187
188	  if (isEmpty(newDiagnosisError)) {
189	    const patient = await PatientRepository.find(patientId)
190	    const diagnoses = patient.diagnoses || []
191	    diagnoses.push({ id: uuid(), ...diagnosis })
192	    patient.diagnoses = diagnoses
193
194	    await dispatch(updatePatient(patient, onSuccess))
195	  } else {
196	    newDiagnosisError.message = 'patient.diagnoses.error.unableToAdd'
197	    dispatch(addDiagnosisError(newDiagnosisError))
198	  }
199	}
200
201	export default patientSlice.reducer
202	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts with line numbers:
1	import { configureStore, combineReducers, Action } from '@reduxjs/toolkit'
2	import ReduxThunk, { ThunkAction } from 'redux-thunk'
3
4	import medication from '../../medications/medication-slice'
5	import breadcrumbs from '../../page-header/breadcrumbs/breadcrumbs-slice'
6	import patient from '../../patients/patient-slice'
7	import patients from '../../patients/patients-slice'
8	import user from '../../user/user-slice'
9	import components from '../components/component-slice'
10
11	const reducer = combineReducers({
12	  patient,
13	  patients,
14	  user,
15	  breadcrumbs,
16	  components,
17	  medication,
18	})
19
20	const store = configureStore({
21	  reducer,
22	  middleware: [ReduxThunk],
23	})
24
25	export type AppDispatch = typeof store.dispatch
26	export type AppThunk = ThunkAction<void, RootState, null, Action<string>>
27	export type RootState = ReturnType<typeof reducer>
28
29	export default store
30	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts with line numbers:
1	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
2
3	import MedicationRepository from '../shared/db/MedicationRepository'
4	import PatientRepository from '../shared/db/PatientRepository'
5	import Medication from '../shared/model/Medication'
6	import Patient from '../shared/model/Patient'
7	import { AppThunk } from '../shared/store'
8
9	interface Error {
10	  medication?: string
11	  patient?: string
12	  quantity?: string
13	  quantityValue?: string
14	  quantityUnit?: string
15	  message?: string
16	}
17
18	interface MedicationState {
19	  error: Error
20	  medication?: Medication
21	  patient?: Patient
22	  status: 'loading' | 'error' | 'completed'
23	}
24
25	const initialState: MedicationState = {
26	  error: {},
27	  medication: undefined,
28	  patient: undefined,
29	  status: 'loading',
30	}
31
32	function start(state: MedicationState) {
33	  state.status = 'loading'
34	}
35
36	function finish(state: MedicationState, { payload }: PayloadAction<Medication>) {
37	  state.status = 'completed'
38	  state.medication = payload
39	  state.error = {}
40	}
41
42	function error(state: MedicationState, { payload }: PayloadAction<Error>) {
43	  state.status = 'error'
44	  state.error = payload
45	}
46
47	const medicationSlice = createSlice({
48	  name: 'medication',
49	  initialState,
50	  reducers: {
51	    fetchMedicationStart: start,
52	    fetchMedicationSuccess: (
53	      state: MedicationState,
54	      { payload }: PayloadAction<{ medication: Medication; patient: Patient }>,
55	    ) => {
56	      state.status = 'completed'
57	      state.medication = payload.medication
58	      state.patient = payload.patient
59	    },
60	    updateMedicationStart: start,
61	    updateMedicationSuccess: finish,
62	    requestMedicationStart: start,
63	    requestMedicationSuccess: finish,
64	    requestMedicationError: error,
65	    cancelMedicationStart: start,
66	    cancelMedicationSuccess: finish,
67	  },
68	})
69
70	export const {
71	  fetchMedicationStart,
72	  fetchMedicationSuccess,
73	  updateMedicationStart,
74	  updateMedicationSuccess,
75	  requestMedicationStart,
76	  requestMedicationSuccess,
77	  requestMedicationError,
78	  cancelMedicationStart,
79	  cancelMedicationSuccess,
80	} = medicationSlice.actions
81
82	export const fetchMedication = (medicationId: string): AppThunk => async (dispatch) => {
83	  dispatch(fetchMedicationStart())
84	  const fetchedMedication = await MedicationRepository.find(medicationId)
85	  const fetchedPatient = await PatientRepository.find(fetchedMedication.patient)
86	  dispatch(fetchMedicationSuccess({ medication: fetchedMedication, patient: fetchedPatient }))
87	}
88
89	const validateMedicationRequest = (newMedication: Medication): Error => {
90	  const medicationRequestError: Error = {}
91	  if (!newMedication.patient) {
92	    medicationRequestError.patient = 'medications.requests.error.patientRequired'
93	  }
94
95	  if (!newMedication.quantity) {
96	    medicationRequestError.quantity = 'medications.requests.error.quantityRequired'
97	  }
98
99	  return medicationRequestError
100	}
101
102	export const requestMedication = (
103	  newMedication: Medication,
104	  onSuccess?: (medication: Medication) => void,
105	): AppThunk => async (dispatch, getState) => {
106	  dispatch(requestMedicationStart())
107
108	  const medicationRequestError = validateMedicationRequest(newMedication)
109	  if (Object.keys(medicationRequestError).length > 0) {
110	    medicationRequestError.message = 'medications.requests.error.unableToRequest'
111	    dispatch(requestMedicationError(medicationRequestError))
112	  } else {
113	    newMedication.status = 'draft'
114	    newMedication.requestedOn = new Date(Date.now().valueOf()).toISOString()
115	    newMedication.requestedBy = getState().user?.user?.id || ''
116	    const requestedMedication = await MedicationRepository.save(newMedication)
117	    dispatch(requestMedicationSuccess(requestedMedication))
118
119	    if (onSuccess) {
120	      onSuccess(requestedMedication)
121	    }
122	  }
123	}
124
125	export const cancelMedication = (
126	  medicationToCancel: Medication,
127	  onSuccess?: (medication: Medication) => void,
128	): AppThunk => async (dispatch) => {
129	  dispatch(cancelMedicationStart())
130
131	  medicationToCancel.canceledOn = new Date(Date.now().valueOf()).toISOString()
132	  medicationToCancel.status = 'canceled'
133	  const canceledMedication = await MedicationRepository.saveOrUpdate(medicationToCancel)
134	  dispatch(cancelMedicationSuccess(canceledMedication))
135
136	  if (onSuccess) {
137	    onSuccess(canceledMedication)
138	  }
139	}
140
141	export const updateMedication = (
142	  medicationToUpdate: Medication,
143	  onSuccess?: (medication: Medication) => void,
144	): AppThunk => async (dispatch) => {
145	  dispatch(updateMedicationStart())
146	  const updatedMedication = await MedicationRepository.saveOrUpdate(medicationToUpdate)
147	  dispatch(updateMedicationSuccess(updatedMedication))
148
149	  if (onSuccess) {
150	    onSuccess(updatedMedication)
151	  }
152	}
153
154	export default medicationSlice.reducer
155	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx with line numbers:
1	import { Select, Label, Panel, Checkbox, Alert } from '@hospitalrun/components'
2	import differenceInYears from 'date-fns/differenceInYears'
3	import startOfDay from 'date-fns/startOfDay'
4	import subYears from 'date-fns/subYears'
5	import React, { ReactElement } from 'react'
6
7	import DatePickerWithLabelFormGroup from '../shared/components/input/DatePickerWithLabelFormGroup'
8	import { SelectOption } from '../shared/components/input/SelectOption'
9	import TextInputWithLabelFormGroup from '../shared/components/input/TextInputWithLabelFormGroup'
10	import useTranslator from '../shared/hooks/useTranslator'
11	import { ContactInfoPiece } from '../shared/model/ContactInformation'
12	import Patient from '../shared/model/Patient'
13	import ContactInfo from './ContactInfo'
14
15	interface Error {
16	  message?: string
17	  prefix?: string
18	  givenName?: string
19	  familyName?: string
20	  suffix?: string
21	  dateOfBirth?: string
22	  preferredLanguage?: string
23	  phoneNumbers?: (string | undefined)[]
24	  emails?: (string | undefined)[]
25	}
26
27	interface Props {
28	  patient: Patient
29	  isEditable?: boolean
30	  onChange?: (newPatient: Partial<Patient>) => void
31	  error?: Error
32	}
33
34	const GeneralInformation = (props: Props): ReactElement => {
35	  const { t } = useTranslator()
36	  const { patient, isEditable, onChange, error } = props
37
38	  const onFieldChange = (name: string, value: string | boolean | ContactInfoPiece[]) => {
39	    if (onChange) {
40	      const newPatient = {
41	        ...patient,
42	        [name]: value,
43	      }
44	      onChange(newPatient)
45	    }
46	  }
47
48	  const guessDateOfBirthFromApproximateAge = (value: string) => {
49	    const age = Number.isNaN(parseFloat(value)) ? 0 : parseFloat(value)
50	    const dateOfBirth = subYears(new Date(Date.now()), age)
51	    return startOfDay(dateOfBirth).toISOString()
52	  }
53
54	  const onApproximateAgeChange = (event: React.ChangeEvent<HTMLInputElement>) => {
55	    const { value } = event.currentTarget
56	    onFieldChange('dateOfBirth', guessDateOfBirthFromApproximateAge(value))
57	  }
58
59	  const onUnknownDateOfBirthChange = (event: React.ChangeEvent<HTMLInputElement>) => {
60	    const { checked } = event.currentTarget
61	    onFieldChange('isApproximateDateOfBirth', checked)
62	  }
63
64	  const sexOptions: SelectOption[] = [
65	    { label: t('sex.male'), value: 'male' },
66	    { label: t('sex.female'), value: 'female' },
67	    { label: t('sex.other'), value: 'other' },
68	    { label: t('sex.unknown'), value: 'unknown' },
69	  ]
70
71	  const typeOptions: SelectOption[] = [
72	    { label: t('patient.types.charity'), value: 'charity' },
73	    { label: t('patient.types.private'), value: 'private' },
74	  ]
75
76	  const bloodTypeOptions: SelectOption[] = [
77	    { label: t('bloodType.apositive'), value: 'A+' },
78	    { label: t('bloodType.anegative'), value: 'A-' },
79	    { label: t('bloodType.abpositive'), value: 'AB+' },
80	    { label: t('bloodType.abnegative'), value: 'AB-' },
81	    { label: t('bloodType.bpositive'), value: 'B+' },
82	    { label: t('bloodType.bnegative'), value: 'B-' },
83	    { label: t('bloodType.opositive'), value: 'O+' },
84	    { label: t('bloodType.onegative'), value: 'O-' },
85	    { label: t('bloodType.unknown'), value: 'unknown' },
86	  ]
87
88	  return (
89	    <div>
90	      <Panel title={t('patient.basicInformation')} color="primary" collapsible>
91	        {error?.message && <Alert className="alert" color="danger" message={t(error?.message)} />}
92	        <div className="row">
93	          <div className="col-md-2">
94	            <TextInputWithLabelFormGroup
95	              label={t('patient.prefix')}
96	              name="prefix"
97	              value={patient.prefix}
98	              isEditable={isEditable}
99	              onChange={(event) => onFieldChange('prefix', event.currentTarget.value)}
100	              isInvalid={!!error?.prefix}
101	              feedback={t(error?.prefix)}
102	            />
103	          </div>
104	          <div className="col-md-4">
105	            <TextInputWithLabelFormGroup
106	              label={t('patient.givenName')}
107	              name="givenName"
108	              value={patient.givenName}
109	              isEditable={isEditable}
110	              onChange={(event) => onFieldChange('givenName', event.currentTarget.value)}
111	              isRequired
112	              isInvalid={!!error?.givenName}
113	              feedback={t(error?.givenName)}
114	            />
115	          </div>
116	          <div className="col-md-4">
117	            <TextInputWithLabelFormGroup
118	              label={t('patient.familyName')}
119	              name="familyName"
120	              value={patient.familyName}
121	              isEditable={isEditable}
122	              onChange={(event) => onFieldChange('familyName', event.currentTarget.value)}
123	              isInvalid={!!error?.familyName}
124	              feedback={t(error?.familyName)}
125	            />
126	          </div>
127	          <div className="col-md-2">
128	            <TextInputWithLabelFormGroup
129	              label={t('patient.suffix')}
130	              name="suffix"
131	              value={patient.suffix}
132	              isEditable={isEditable}
133	              onChange={(event) => onFieldChange('suffix', event.currentTarget.value)}
134	              isInvalid={!!error?.suffix}
135	              feedback={t(error?.suffix)}
136	            />
137	          </div>
138	        </div>
139	        <div className="row">
140	          <div className="col">
141	            <div className="form-group" data-testid="sexSelect">
142	              <Label text={t('patient.sex')} title="sex" />
143	              <Select
144	                id="sexSelect"
145	                options={sexOptions}
146	                defaultSelected={sexOptions.filter(({ value }) => value === patient.sex)}
147	                onChange={(values) => onFieldChange('sex', values[0])}
148	                disabled={!isEditable}
149	              />
150	            </div>
151	          </div>
152	          <div className="col">
153	            <div className="form-group" data-testid="typeSelect">
154	              <Label text={t('patient.type')} title="type" />
155	              <Select
156	                id="typeSelect"
157	                options={typeOptions}
158	                defaultSelected={typeOptions.filter(({ value }) => value === patient.type)}
159	                onChange={(values) => onFieldChange('type', values[0])}
160	                disabled={!isEditable}
161	              />
162	            </div>
163	          </div>
164	          <div className="col">
165	            <div className="form-group" data-testid="bloodTypeSelect">
166	              <Label text={t('patient.bloodType')} title="bloodType" />
167	              <Select
168	                id="bloodTypeSelect"
169	                options={bloodTypeOptions}
170	                defaultSelected={bloodTypeOptions.filter(
171	                  ({ value }) => value === patient.bloodType,
172	                )}
173	                onChange={(values) => onFieldChange('bloodType', values[0])}
174	                disabled={!isEditable}
175	              />
176	            </div>
177	          </div>
178	        </div>
179	        <div className="row">
180	          <div className="col-md-3">
181	            {patient.isApproximateDateOfBirth ? (
182	              <TextInputWithLabelFormGroup
183	                label={t('patient.approximateAge')}
184	                name="approximateAge"
185	                type="number"
186	                value={`${differenceInYears(new Date(Date.now()), new Date(patient.dateOfBirth))}`}
187	                isEditable={isEditable}
188	                onChange={onApproximateAgeChange}
189	              />
190	            ) : (
191	              <DatePickerWithLabelFormGroup
192	                name="dateOfBirth"
193	                label={t('patient.dateOfBirth')}
194	                isEditable={isEditable && !patient.isApproximateDateOfBirth}
195	                value={
196	                  patient.dateOfBirth && patient.dateOfBirth.length > 0
197	                    ? new Date(patient.dateOfBirth)
198	                    : undefined
199	                }
200	                maxDate={new Date(Date.now().valueOf())}
201	                onChange={(date: Date) => onFieldChange('dateOfBirth', date.toISOString())}
202	                isInvalid={!!error?.dateOfBirth}
203	                feedback={t(error?.dateOfBirth)}
204	              />
205	            )}
206	            <div className="form-group">
207	              <Checkbox
208	                label={t('patient.unknownDateOfBirth')}
209	                name="unknown"
210	                disabled={!isEditable}
211	                onChange={onUnknownDateOfBirthChange}
212	              />
213	            </div>
214	          </div>
215	          <div className="col">
216	            <TextInputWithLabelFormGroup
217	              label={t('patient.occupation')}
218	              name="occupation"
219	              value={patient.occupation}
220	              isEditable={isEditable}
221	              onChange={(event) => onFieldChange('occupation', event.currentTarget.value)}
222	            />
223	          </div>
224	          <div className="col">
225	            <TextInputWithLabelFormGroup
226	              label={t('patient.preferredLanguage')}
227	              name="preferredLanguage"
228	              value={patient.preferredLanguage}
229	              isEditable={isEditable}
230	              onChange={(event) => onFieldChange('preferredLanguage', event.currentTarget.value)}
231	              isInvalid={!!error?.preferredLanguage}
232	              feedback={t(error?.preferredLanguage)}
233	            />
234	          </div>
235	        </div>
236	      </Panel>
237	      <br />
238	      <Panel title={t('patient.contactInformation')} color="primary" collapsible>
239	        <div className="mb-4">
240	          <Panel title={t('patient.phoneNumber')} color="primary" collapsible>
241	            <ContactInfo
242	              component="TextInputWithLabelFormGroup"
243	              data={patient.phoneNumbers}
244	              errors={error?.phoneNumbers}
245	              label="patient.phoneNumber"
246	              name="phoneNumber"
247	              isEditable={isEditable}
248	              onChange={(newPhoneNumbers) => onFieldChange('phoneNumbers', newPhoneNumbers)}
249	            />
250	          </Panel>
251	        </div>
252	        <div className="mb-4">
253	          <Panel title={t('patient.email')} color="primary" collapsible>
254	            <ContactInfo
255	              component="TextInputWithLabelFormGroup"
256	              data={patient.emails}
257	              errors={error?.emails}
258	              label="patient.email"
259	              name="email"
260	              isEditable={isEditable}
261	              onChange={(newEmails) => onFieldChange('emails', newEmails)}
262	            />
263	          </Panel>
264	        </div>
265	        <div>
266	          <Panel title={t('patient.address')} color="primary" collapsible>
267	            <ContactInfo
268	              component="TextFieldWithLabelFormGroup"
269	              data={patient.addresses}
270	              label="patient.address"
271	              name="address"
272	              isEditable={isEditable}
273	              onChange={(newAddresses) => onFieldChange('addresses', newAddresses)}
274	            />
275	          </Panel>
276	        </div>
277	      </Panel>
278	    </div>
279	  )
280	}
281
282	export default GeneralInformation
283	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextInputWithLabelFormGroup.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextInputWithLabelFormGroup.tsx with line numbers:
1	import { TextInput, Label } from '@hospitalrun/components'
2	import React from 'react'
3
4	interface Props {
5	  value: string
6	  label?: string
7	  name: string
8	  isEditable?: boolean
9	  type: 'text' | 'email' | 'number' | 'tel' | 'password'
10	  placeholder?: string
11	  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void
12	  isRequired?: boolean
13	  feedback?: string
14	  isInvalid?: boolean
15	}
16
17	const TextInputWithLabelFormGroup = (props: Props) => {
18	  const {
19	    value,
20	    label,
21	    name,
22	    isEditable,
23	    onChange,
24	    placeholder,
25	    type,
26	    isRequired,
27	    feedback,
28	    isInvalid,
29	  } = props
30	  const id = `${name}TextInput`
31	  return (
32	    <div className="form-group">
33	      {label && <Label text={label} htmlFor={id} isRequired={isRequired} />}
34	      <TextInput
35	        feedback={feedback}
36	        id={id}
37	        isInvalid={isInvalid}
38	        value={value}
39	        disabled={!isEditable}
40	        onChange={onChange}
41	        type={type}
42	        placeholder={placeholder || label}
43	      />
44	    </div>
45	  )
46	}
47
48	TextInputWithLabelFormGroup.defaultProps = {
49	  value: '',
50	  type: 'text',
51	}
52
53	export default TextInputWithLabelFormGroup
54	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { useMutation, queryCache } from 'react-query'
3
4	import LabRepository from '../../shared/db/LabRepository'
5	import Lab from '../../shared/model/Lab'
6	import { validateLabRequest } from '../utils/validate-lab'
7
8	function requestLab(newLab: Lab): Promise<Lab> {
9	  const requestLabErrors = validateLabRequest(newLab)
10
11	  if (isEmpty(requestLabErrors)) {
12	    newLab.requestedOn = new Date(Date.now().valueOf()).toISOString()
13	    return LabRepository.save(newLab)
14	  }
15
16	  throw requestLabErrors
17	}
18
19	export default function useRequestLab() {
20	  return useMutation(requestLab, {
21	    onSuccess: async () => {
22	      await queryCache.invalidateQueries('labs')
23	    },
24	    throwOnError: true,
25	  })
26	}
27	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2
3	import Lab from '../../shared/model/Lab'
4
5	export class LabError extends Error {
6	  message: string
7
8	  result?: string
9
10	  patient?: string
11
12	  type?: string
13
14	  constructor(message: string, result: string, patient: string, type: string) {
15	    super(message)
16	    this.message = message
17	    this.result = result
18	    this.patient = patient
19	    this.type = type
20	  }
21	}
22
23	export function validateLabRequest(lab: Partial<Lab>): LabError {
24	  const labError = {} as LabError
25
26	  if (!lab.patient) {
27	    labError.patient = 'labs.requests.error.patientRequired'
28	  }
29
30	  if (!lab.type) {
31	    labError.type = 'labs.requests.error.typeRequired'
32	  }
33
34	  if (!isEmpty(labError)) {
35	    labError.message = 'labs.requests.error.unableToRequest'
36	  }
37	  return labError
38	}
39
40	export function validateLabComplete(lab: Partial<Lab>): LabError {
41	  const labError = {} as LabError
42
43	  if (!lab.result) {
44	    labError.result = 'labs.requests.error.resultRequiredToComplete'
45	    labError.message = 'labs.requests.error.unableToComplete'
46	  }
47
48	  return labError
49	}
50	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx with line numbers:
1	import {
2	  Select,
3	  Typeahead,
4	  Label,
5	  Button,
6	  Alert,
7	  Toast,
8	  Column,
9	  Row,
10	} from '@hospitalrun/components'
11	import format from 'date-fns/format'
12	import React, { useState, useEffect } from 'react'
13	import { useSelector } from 'react-redux'
14	import { useHistory } from 'react-router-dom'
15
16	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
17	import { useUpdateTitle } from '../../page-header/title/TitleContext'
18	import { SelectOption } from '../../shared/components/input/SelectOption'
19	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
20	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
21	import PatientRepository from '../../shared/db/PatientRepository'
22	import useTranslator from '../../shared/hooks/useTranslator'
23	import Lab from '../../shared/model/Lab'
24	import Note from '../../shared/model/Note'
25	import Patient from '../../shared/model/Patient'
26	import { RootState } from '../../shared/store'
27	import { uuid } from '../../shared/util/uuid'
28	import useRequestLab from '../hooks/useRequestLab'
29	import { LabError } from '../utils/validate-lab'
30
31	const NewLabRequest = () => {
32	  const { t } = useTranslator()
33	  const history = useHistory()
34	  const { user } = useSelector((state: RootState) => state.user)
35	  const [mutate] = useRequestLab()
36	  const [newNoteText, setNewNoteText] = useState('')
37	  const [error, setError] = useState<LabError | undefined>(undefined)
38	  const [visitOptions, setVisitOptions] = useState([] as SelectOption[])
39
40	  const updateTitle = useUpdateTitle()
41	  useEffect(() => {
42	    updateTitle(t('labs.requests.new'))
43	  })
44	  const [newLabRequest, setNewLabRequest] = useState({
45	    patient: '',
46	    type: '',
47	    status: 'requested',
48	    requestedBy: user?.id || '',
49	    requestedOn: '',
50	    visitId: '',
51	  })
52
53	  const breadcrumbs = [
54	    {
55	      i18nKey: 'labs.requests.new',
56	      location: `/labs/new`,
57	    },
58	  ]
59	  useAddBreadcrumbs(breadcrumbs)
60
61	  const onPatientChange = (patient: Patient) => {
62	    if (patient) {
63	      const visits = patient.visits?.map((v) => ({
64	        label: `${v.type} at ${format(new Date(v.startDateTime), 'yyyy-MM-dd hh:mm a')}`,
65	        value: v.id,
66	      })) as SelectOption[]
67
68	      setVisitOptions(visits)
69	      setNewLabRequest((previousNewLabRequest) => ({
70	        ...previousNewLabRequest,
71	        patient: patient.id,
72	        fullName: patient.fullName,
73	      }))
74	    } else {
75	      setVisitOptions([])
76	      setNewLabRequest((previousNewLabRequest) => ({
77	        ...previousNewLabRequest,
78	        patient: '',
79	        visitId: '',
80	      }))
81	    }
82	  }
83
84	  const onLabTypeChange = (event: React.ChangeEvent<HTMLInputElement>) => {
85	    const type = event.currentTarget.value
86	    setNewLabRequest((previousNewLabRequest) => ({
87	      ...previousNewLabRequest,
88	      type,
89	    }))
90	  }
91
92	  const onNoteChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
93	    const noteText = event.currentTarget.value
94	    setNewNoteText(noteText)
95
96	    const newNote: Note = {
97	      id: uuid(),
98	      date: new Date().toISOString(),
99	      text: noteText,
100	      deleted: false,
101	    }
102
103	    setNewLabRequest((previousNewLabRequest) => ({
104	      ...previousNewLabRequest,
105	      notes: [newNote],
106	    }))
107	  }
108
109	  const onSave = async () => {
110	    try {
111	      const newLab = await mutate(newLabRequest as Lab)
112	      history.push(`/labs/${newLab?.id}`)
113	      Toast(
114	        'success',
115	        t('states.success'),
116	        `${t('labs.successfullyCreated')} ${newLab?.type} ${t('labs.lab.for')} ${
117	          (await PatientRepository.find(newLab?.patient || '')).fullName
118	        }`,
119	      )
120	      setError(undefined)
121	    } catch (e) {
122	      setError(e)
123	    }
124	  }
125
126	  const onVisitChange = (visitId: string) => {
127	    setNewLabRequest((previousNewLabRequest) => ({
128	      ...previousNewLabRequest,
129	      visitId,
130	    }))
131	  }
132
133	  const onCancel = () => {
134	    history.push('/labs')
135	  }
136
137	  const defaultSelectedVisitsOption = () => {
138	    if (visitOptions !== undefined) {
139	      return visitOptions.filter(({ value }) => value === newLabRequest.visitId)
140	    }
141	    return []
142	  }
143
144	  return (
145	    <>
146	      {error && <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />}
147	      <form>
148	        <Row>
149	          <Column>
150	            <div className="form-group patient-typeahead">
151	              <Label htmlFor="patientTypeahead" isRequired text={t('labs.lab.patient')} />
152	              <Typeahead
153	                id="patientTypeahead"
154	                placeholder={t('labs.lab.patient')}
155	                onChange={(p: Patient[]) => onPatientChange(p[0])}
156	                onSearch={async (query: string) => PatientRepository.search(query)}
157	                searchAccessor="fullName"
158	                renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
159	                isInvalid={!!error?.patient}
160	                feedback={t(error?.patient as string)}
161	              />
162	            </div>
163	          </Column>
164	          <Column>
165	            <div className="form-group" data-testid="visitSelect">
166	              <Label text={t('patient.visit')} title="This is a required input" isRequired />
167	              <Select
168	                id="visit"
169	                options={visitOptions || []}
170	                defaultSelected={defaultSelectedVisitsOption()}
171	                onChange={(values) => {
172	                  onVisitChange(values[0])
173	                }}
174	                disabled={false}
175	              />
176	            </div>
177	          </Column>
178	        </Row>
179	        <TextInputWithLabelFormGroup
180	          name="labType"
181	          label={t('labs.lab.type')}
182	          isRequired
183	          isEditable
184	          isInvalid={!!error?.type}
185	          feedback={t(error?.type as string)}
186	          value={newLabRequest.type}
187	          onChange={onLabTypeChange}
188	        />
189	        <div className="form-group">
190	          <TextFieldWithLabelFormGroup
191	            name="labNotes"
192	            label={t('labs.lab.notes')}
193	            isEditable
194	            value={newNoteText}
195	            onChange={onNoteChange}
196	          />
197	        </div>
198	        <div className="row float-right">
199	          <div className="btn-group btn-group-lg mt-3 mr-3">
200	            <Button className="mr-2" color="success" onClick={onSave}>
201	              {t('labs.requests.new')}
202	            </Button>
203
204	            <Button color="danger" onClick={onCancel}>
205	              {t('actions.cancel')}
206	            </Button>
207	          </div>
208	        </div>
209	      </form>
210	    </>
211	  )
212	}
213
214	export default NewLabRequest
215	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx with line numbers:
1	import { MutateFunction, queryCache, useMutation } from 'react-query'
2
3	import AppointmentRepository from '../../shared/db/AppointmentRepository'
4	import Appointment from '../../shared/model/Appointment'
5	import validateAppointment, { AppointmentError } from '../appointments/util/validate-appointment'
6
7	interface newAppointmentResult {
8	  mutate: MutateFunction<Appointment, unknown, Appointment, unknown>
9	  isLoading: boolean
10	  isError: boolean
11	  validator(appointment: Appointment): AppointmentError
12	}
13
14	async function createNewAppointment(appointment: Appointment): Promise<Appointment> {
15	  return AppointmentRepository.save(appointment)
16	}
17
18	function validateCreateAppointment(appointment: Appointment): AppointmentError {
19	  return validateAppointment(appointment)
20	}
21
22	export default function useScheduleAppointment(): newAppointmentResult {
23	  const [mutate, { isLoading, isError }] = useMutation(createNewAppointment, {
24	    onSuccess: async () => {
25	      await queryCache.invalidateQueries('appointment')
26	    },
27	    throwOnError: true,
28	  })
29	  const result: newAppointmentResult = {
30	    mutate,
31	    isLoading,
32	    isError,
33	    validator: validateCreateAppointment,
34	  }
35	  return result
36	}
37	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts with line numbers:
1	import isBefore from 'date-fns/isBefore'
2
3	import Appointment from '../../../shared/model/Appointment'
4
5	export class AppointmentError extends Error {
6	  patient?: string
7
8	  startDateTime?: string
9
10	  constructor(patient: string, startDateTime: string, message: string) {
11	    super(message)
12	    this.patient = patient
13	    this.startDateTime = startDateTime
14	    Object.setPrototypeOf(this, AppointmentError.prototype)
15	  }
16	}
17
18	export default function validateAppointment(appointment: Appointment): AppointmentError {
19	  const newError: any = {}
20
21	  if (!appointment.patient) {
22	    newError.patient = 'scheduling.appointment.errors.patientRequired'
23	  }
24	  if (isBefore(new Date(appointment.endDateTime), new Date(appointment.startDateTime))) {
25	    newError.startDateTime = 'scheduling.appointment.errors.startDateMustBeBeforeEndDate'
26	  }
27
28	  return newError as AppointmentError
29	}
30	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx with line numbers:
1	import { Button, Spinner, Toast } from '@hospitalrun/components'
2	import addMinutes from 'date-fns/addMinutes'
3	import roundToNearestMinutes from 'date-fns/roundToNearestMinutes'
4	import isEmpty from 'lodash/isEmpty'
5	import React, { useEffect, useState } from 'react'
6	import { useHistory, useLocation } from 'react-router-dom'
7
8	import useAddBreadcrumbs from '../../../page-header/breadcrumbs/useAddBreadcrumbs'
9	import { useUpdateTitle } from '../../../page-header/title/TitleContext'
10	import useTranslator from '../../../shared/hooks/useTranslator'
11	import Appointment from '../../../shared/model/Appointment'
12	import Patient from '../../../shared/model/Patient'
13	import useScheduleAppointment from '../../hooks/useScheduleAppointment'
14	import AppointmentDetailForm from '../AppointmentDetailForm'
15	import { AppointmentError } from '../util/validate-appointment'
16
17	const breadcrumbs = [
18	  { i18nKey: 'scheduling.appointments.label', location: '/appointments' },
19	  { i18nKey: 'scheduling.appointments.new', location: '/appointments/new' },
20	]
21
22	interface LocationProps {
23	  pathname: string
24	  state?: {
25	    patient: Patient
26	  }
27	}
28
29	const NewAppointment = () => {
30	  const { t } = useTranslator()
31	  const history = useHistory()
32	  const location: LocationProps = useLocation()
33	  const patient = location.state?.patient
34	  const updateTitle = useUpdateTitle()
35	  useEffect(() => {
36	    updateTitle(t('scheduling.appointments.new'))
37	  })
38	  useAddBreadcrumbs(breadcrumbs, true)
39
40	  const startDateTime = roundToNearestMinutes(new Date(), { nearestTo: 15 })
41	  const endDateTime = addMinutes(startDateTime, 60)
42	  const [saved, setSaved] = useState(false)
43	  const [newAppointmentMutateError, setError] = useState<AppointmentError>({} as AppointmentError)
44	  const [newAppointment, setAppointment] = useState({
45	    patient: patient || '',
46	    startDateTime: startDateTime.toISOString(),
47	    endDateTime: endDateTime.toISOString(),
48	    location: '',
49	    reason: '',
50	    type: '',
51	  } as Appointment)
52
53	  const {
54	    mutate: newAppointmentMutate,
55	    isLoading: isLoadingNewAppointment,
56	    isError: isErrorNewAppointment,
57	    validator: validateNewAppointment,
58	  } = useScheduleAppointment()
59
60	  const onCancelClick = () => {
61	    history.push('/appointments')
62	  }
63
64	  const onSave = () => {
65	    setSaved(true)
66	    setError(validateNewAppointment(newAppointment))
67	  }
68
69	  useEffect(() => {
70	    // if save click and no error proceed, else give error message.
71	    if (saved) {
72	      if (isEmpty(newAppointmentMutateError) && !isErrorNewAppointment) {
73	        newAppointmentMutate(newAppointment).then((result) => {
74	          Toast('success', t('states.success'), t('scheduling.appointment.successfullyCreated'))
75	          history.push(`/appointments/${result?.id}`)
76	        })
77	      } else if (!isEmpty(newAppointmentMutateError)) {
78	        newAppointmentMutateError.message = 'scheduling.appointment.errors.createAppointmentError'
79	      }
80	    }
81	    setSaved(false)
82	  }, [
83	    saved,
84	    newAppointmentMutateError,
85	    isErrorNewAppointment,
86	    newAppointmentMutate,
87	    newAppointment,
88	    t,
89	    history,
90	  ])
91
92	  if (isLoadingNewAppointment) {
93	    return <Spinner color="blue" loading size={[10, 25]} type="ScaleLoader" />
94	  }
95
96	  const onFieldChange = (key: string, value: string | boolean) => {
97	    setAppointment({
98	      ...newAppointment,
99	      [key]: value,
100	    })
101	  }
102
103	  return (
104	    <div>
105	      <form aria-label="new appointment form">
106	        <AppointmentDetailForm
107	          appointment={newAppointment as Appointment}
108	          patient={patient as Patient}
109	          error={newAppointmentMutateError}
110	          onFieldChange={onFieldChange}
111	        />
112	        <div className="row float-right">
113	          <div className="btn-group btn-group-lg mr-3">
114	            <Button className="mr-2" color="success" onClick={onSave}>
115	              {t('scheduling.appointments.createAppointment')}
116	            </Button>
117	            <Button color="danger" onClick={onCancelClick}>
118	              {t('actions.cancel')}
119	            </Button>
120	          </div>
121	        </div>
122	      </form>
123	    </div>
124	  )
125	}
126
127	export default NewAppointment
128	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status, excluding hidden items and node_modules:
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/index.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/types.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx with line numbers:
1	import React, { useState } from 'react'
2
3	import useTranslator from '../../hooks/useTranslator'
4	import { useNetworkStatus } from './useNetworkStatus'
5
6	const ONLINE_COLOR = 'rgba(0, 255, 0, 0.55)'
7	const OFFLINE_COLOR = 'rgba(255, 0, 0, 0.65)'
8	const OPACITY_TRANSITION_TIME = 4000
9	const BASE_STYLE = {
10	  height: '50px',
11	  pointerEvents: 'none' as const,
12	  transition: `opacity ${OPACITY_TRANSITION_TIME}ms ease-in`,
13	}
14
15	export const NetworkStatusMessage = () => {
16	  const { t } = useTranslator()
17	  const { isOnline, wasOffline } = useNetworkStatus()
18	  const [shouldRender, setShouldRender] = useState(true)
19	  const [opacity, setOpacity] = useState(1)
20
21	  if (isOnline && !wasOffline) {
22	    return null
23	  }
24
25	  if (!isOnline && opacity !== 1) {
26	    setShouldRender(true)
27	    setOpacity(1)
28	  }
29
30	  if (isOnline && wasOffline && opacity !== 0) {
31	    setOpacity(0)
32	    setTimeout(() => {
33	      setShouldRender(false)
34	    }, OPACITY_TRANSITION_TIME)
35	  }
36
37	  if (!shouldRender) {
38	    return null
39	  }
40
41	  const style = {
42	    ...BASE_STYLE,
43	    backgroundColor: isOnline ? ONLINE_COLOR : OFFLINE_COLOR,
44	    opacity,
45	  }
46
47	  return (
48	    <div
49	      className={`fixed-bottom d-flex justify-content-center align-items-center ${
50	        isOnline ? 'online' : 'offline'
51	      }`}
52	      style={style}
53	    >
54	      {isOnline ? t('networkStatus.online') : t('networkStatus.offline')}
55	    </div>
56	  )
57	}
58	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts with line numbers:
1	import { useState, useEffect } from 'react'
2
3	import { NetworkStatus } from './types'
4
5	export const useNetworkStatus = (): NetworkStatus => {
6	  const isOnline = navigator.onLine
7	  const [networkStatus, setNetworkStatus] = useState({
8	    isOnline,
9	    wasOffline: !isOnline,
10	  })
11	  const handleOnline = () => {
12	    setNetworkStatus((prevState) => ({ ...prevState, isOnline: true }))
13	  }
14	  const handleOffline = () => {
15	    setNetworkStatus((prevState) => ({ ...prevState, isOnline: false, wasOffline: true }))
16	  }
17	  useEffect(() => {
18	    window.addEventListener('online', handleOnline)
19	    window.addEventListener('offline', handleOffline)
20
21	    return () => {
22	      window.removeEventListener('online', handleOnline)
23	      window.removeEventListener('offline', handleOffline)
24	    }
25	  }, [])
26
27	  return networkStatus
28	}
29	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts with line numbers:
1	import { v4 as uuidv4 } from 'uuid'
2
3	import { schema } from '../config/pouchdb'
4	import AbstractDBModel from '../model/AbstractDBModel'
5	import SortRequest, { Unsorted } from './SortRequest'
6
7	export default class Repository<T extends AbstractDBModel> {
8	  db: PouchDB.RelDatabase
9
10	  type: string
11
12	  pluralType: string
13
14	  constructor(type: string, db: PouchDB.RelDatabase) {
15	    this.db = db
16	    this.type = type
17	    this.pluralType = schema.find((s) => s.singular === this.type)?.plural || ''
18	  }
19
20	  async find(id: string): Promise<T> {
21	    const documents = await this.db.rel.find(this.type, id)
22	    const entity = documents[this.pluralType][0]
23	    return entity
24	  }
25
26	  async findAll(sort = Unsorted): Promise<T[]> {
27	    const selector: any = {
28	      _id: {
29	        $regex: RegExp(this.type, 'i'),
30	      },
31	    }
32
33	    sort.sorts.forEach((s) => {
34	      selector[`data.${s.field}`] = { $gt: null }
35	    })
36
37	    // Adds an index to each of the fields coming from the sorting object
38	    // allowing the algorithm to sort by any given SortRequest, by avoiding the default index error (lack of index)
39
40	    await Promise.all(
41	      sort.sorts.map(
42	        async (s): Promise<SortRequest> => {
43	          await this.db.createIndex({
44	            index: {
45	              fields: [`data.${s.field}`],
46	            },
47	          })
48
49	          return sort
50	        },
51	      ),
52	    )
53
54	    const result = await this.db.find({
55	      selector,
56	      sort:
57	        sort.sorts.length > 0
58	          ? sort.sorts.map((s) => ({ [`data.${s.field}`]: s.direction }))
59	          : undefined,
60	    })
61	    const relDocs = await this.db.rel.parseRelDocs(this.type, result.docs)
62	    return relDocs[this.pluralType]
63	  }
64
65	  async count(): Promise<number> {
66	    const result = await this.findAll()
67	    return result.length
68	  }
69
70	  async search(criteria: any): Promise<T[]> {
71	    const response = await this.db.find({
72	      selector: {
73	        $and: [
74	          {
75	            _id: {
76	              $regex: RegExp(this.type, 'i'),
77	            },
78	          },
79	          { ...criteria.selector },
80	        ],
81	      },
82	    })
83	    const data = await this.db.rel.parseRelDocs(this.type, response.docs)
84	    return data[this.pluralType]
85	  }
86
87	  async save(entity: T): Promise<T> {
88	    const currentTime = new Date().toISOString()
89
90	    const { id, rev, ...valuesToSave } = entity
91	    const savedEntity = await this.db.rel.save(this.type, {
92	      id: uuidv4(),
93	      ...valuesToSave,
94	      createdAt: currentTime,
95	      updatedAt: currentTime,
96	    })
97	    return this.find(savedEntity.id)
98	  }
99
100	  async saveOrUpdate(entity: T): Promise<T> {
101	    if (!entity.id) {
102	      return this.save(entity)
103	    }
104
105	    const { id, rev, ...dataToSave } = entity
106
107	    try {
108	      await this.find(entity.id)
109	      const entityToUpdate = {
110	        id,
111	        rev,
112	        ...dataToSave,
113	        updatedAt: new Date().toISOString(),
114	      }
115
116	      await this.db.rel.save(this.type, entityToUpdate)
117	      return this.find(entity.id)
118	    } catch (error) {
119	      return this.save(entity)
120	    }
121	  }
122
123	  async delete(entity: T): Promise<T> {
124	    const entityToDelete = await this.find(entity.id)
125	    await this.db.rel.del(this.type, entity)
126	    return entityToDelete
127	  }
128	}
129	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/App.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/App.tsx with line numbers:
1	/* eslint-disable no-console */
2
3	import { Spinner } from '@hospitalrun/components'
4	import React, { Suspense, useEffect, useState } from 'react'
5	import { ReactQueryDevtools } from 'react-query-devtools'
6	import { useDispatch } from 'react-redux'
7	import { BrowserRouter, Route, Switch } from 'react-router-dom'
8
9	import HospitalRun from './HospitalRun'
10	import { TitleProvider } from './page-header/title/TitleContext'
11	import { remoteDb } from './shared/config/pouchdb'
12	import { getCurrentSession } from './user/user-slice'
13
14	const App: React.FC = () => {
15	  const dispatch = useDispatch()
16	  const [loading, setLoading] = useState(true)
17
18	  useEffect(() => {
19	    let cancelled = false
20
21	    remoteDb
22	      .getSession()
23	      .then((session) => {
24	        if (cancelled) {
25	          return
26	        }
27	        if (session.userCtx.name) {
28	          dispatch(getCurrentSession(session.userCtx.name))
29	        }
30	      })
31	      .catch((e) => {
32	        console.log(e)
33	      })
34	      .finally(() => {
35	        if (!cancelled) {
36	          setLoading(false)
37	        }
38	      })
39
40	    return () => {
41	      cancelled = true
42	    }
43	  }, [dispatch])
44
45	  if (loading) {
46	    return null
47	  }
48
49	  return (
50	    <>
51	      <BrowserRouter>
52	        <Suspense fallback={<Spinner color="blue" loading size={[10, 25]} type="ScaleLoader" />}>
53	          <Switch>
54	            <TitleProvider>
55	              <Route path="/" component={HospitalRun} />
56	            </TitleProvider>
57	          </Switch>
58	        </Suspense>
59	      </BrowserRouter>
60	      <ReactQueryDevtools initialIsOpen={false} />
61	    </>
62	  )
63	}
64
65	export default App
66	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx with line numbers:
1	import { Toaster } from '@hospitalrun/components'
2	import React from 'react'
3	import { useSelector } from 'react-redux'
4	import { Route, Switch } from 'react-router-dom'
5
6	import Dashboard from './dashboard/Dashboard'
7	import Imagings from './imagings/Imagings'
8	import Incidents from './incidents/Incidents'
9	import Labs from './labs/Labs'
10	import Medications from './medications/Medications'
11	import Breadcrumbs from './page-header/breadcrumbs/Breadcrumbs'
12	import { ButtonBarProvider } from './page-header/button-toolbar/ButtonBarProvider'
13	import ButtonToolBar from './page-header/button-toolbar/ButtonToolBar'
14	import { useTitle } from './page-header/title/TitleContext'
15	import Patients from './patients/Patients'
16	import Appointments from './scheduling/appointments/Appointments'
17	import Settings from './settings/Settings'
18	import Navbar from './shared/components/navbar/Navbar'
19	import { NetworkStatusMessage } from './shared/components/network-status'
20	import Sidebar from './shared/components/Sidebar'
21	import { RootState } from './shared/store'
22
23	const HospitalRun = () => {
24	  const { title } = useTitle()
25	  const { sidebarCollapsed } = useSelector((state: RootState) => state.components)
26
27	  return (
28	    <div>
29	      <NetworkStatusMessage />
30	      <Navbar />
31	      <div className="container-fluid">
32	        <div className="col-md-2">
33	          <Sidebar />
34	        </div>
35	        <ButtonBarProvider>
36	          <div className="row">
37	            <main
38	              role="main"
39	              className={`${
40	                sidebarCollapsed ? 'col-md-10 col-lg-11' : 'col-md-9 col-lg-10'
41	              } ml-sm-auto px-4`}
42	            >
43	              <div className="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
44	                <h1 className="h2">{title}</h1>
45	                <ButtonToolBar />
46	              </div>
47	              <Breadcrumbs />
48	              <div>
49	                <Switch>
50	                  <Route exact path="/" component={Dashboard} />
51	                  <Route path="/appointments" component={Appointments} />
52	                  <Route path="/patients" component={Patients} />
53	                  <Route path="/labs" component={Labs} />
54	                  <Route path="/medications" component={Medications} />
55	                  <Route path="/incidents" component={Incidents} />
56	                  <Route path="/settings" component={Settings} />
57	                  <Route path="/imaging" component={Imagings} />
58	                </Switch>
59	              </div>
60	              <Toaster autoClose={5000} hideProgressBar draggable />
61	            </main>
62	          </div>
63	        </ButtonBarProvider>
64	      </div>
65	    </div>
66	  )
67	}
68
69	export default HospitalRun
70	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts with line numbers:
1	/* eslint-disable no-underscore-dangle */
2	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
3
4	import { remoteDb } from '../shared/config/pouchdb'
5	import Permissions from '../shared/model/Permissions'
6	import User from '../shared/model/User'
7	import { AppThunk } from '../shared/store'
8
9	export interface LoginError {
10	  message?: string
11	  username?: string
12	  password?: string
13	}
14
15	export interface UserState {
16	  permissions: (Permissions | null)[]
17	  user?: User
18	  loginError?: LoginError
19	}
20
21	const initialState: UserState = {
22	  user: {
23	    givenName: 'HospitalRun',
24	    familyName: 'Test',
25	    fullName: 'HospitalRun Test',
26	    id: 'test-hospitalrun',
27	  },
28	  permissions: [
29	    Permissions.ReadPatients,
30	    Permissions.WritePatients,
31	    Permissions.ReadAppointments,
32	    Permissions.WriteAppointments,
33	    Permissions.DeleteAppointment,
34	    Permissions.AddAllergy,
35	    Permissions.AddDiagnosis,
36	    Permissions.ViewLabs,
37	    Permissions.ViewLab,
38	    Permissions.RequestLab,
39	    Permissions.CompleteLab,
40	    Permissions.CancelLab,
41	    Permissions.ViewIncident,
42	    Permissions.ViewIncidents,
43	    Permissions.ReportIncident,
44	    Permissions.ResolveIncident,
45	    Permissions.ViewIncidentWidgets,
46	    Permissions.AddCarePlan,
47	    Permissions.ReadCarePlan,
48	    Permissions.AddCareGoal,
49	    Permissions.ReadCareGoal,
50	    Permissions.RequestMedication,
51	    Permissions.CompleteMedication,
52	    Permissions.CancelMedication,
53	    Permissions.ViewMedications,
54	    Permissions.ViewMedication,
55	    Permissions.AddVisit,
56	    Permissions.ReadVisits,
57	    Permissions.ViewImagings,
58	    Permissions.RequestImaging,
59	  ],
60	}
61
62	const userSlice = createSlice({
63	  name: 'user',
64	  initialState,
65	  reducers: {
66	    fetchPermissions(state, { payload }: PayloadAction<Permissions[]>) {
67	      state.permissions = payload
68	    },
69	    loginSuccess(
70	      state,
71	      { payload }: PayloadAction<{ user: User; permissions: (Permissions | null)[] }>,
72	    ) {
73	      state.user = payload.user
74	      state.permissions = initialState.permissions
75	    },
76	    loginError(state, { payload }: PayloadAction<LoginError>) {
77	      state.loginError = payload
78	    },
79	    logoutSuccess(state) {
80	      state.user = undefined
81	      state.permissions = []
82	    },
83	  },
84	})
85
86	export const { fetchPermissions, loginError, loginSuccess, logoutSuccess } = userSlice.actions
87
88	export const getCurrentSession = (username: string): AppThunk => async (dispatch) => {
89	  const user = await remoteDb.getUser(username)
90	  dispatch(
91	    loginSuccess({
92	      user: {
93	        id: user._id,
94	        givenName: (user as any).metadata.givenName,
95	        familyName: (user as any).metadata.familyName,
96	      },
97	      permissions: initialState.permissions,
98	    }),
99	  )
100	}
101
102	export const login = (username: string, password: string): AppThunk => async (dispatch) => {
103	  try {
104	    const response = await remoteDb.logIn(username, password)
105	    const user = await remoteDb.getUser(response.name)
106	    dispatch(
107	      loginSuccess({
108	        user: {
109	          id: user._id,
110	          givenName: (user as any).metadata.givenName,
111	          familyName: (user as any).metadata.familyName,
112	        },
113	        permissions: initialState.permissions,
114	      }),
115	    )
116	  } catch (error) {
117	    if (!username || !password) {
118	      dispatch(
119	        loginError({
120	          message: 'user.login.error.message.required',
121	          username: 'user.login.error.username.required',
122	          password: 'user.login.error.password.required',
123	        }),
124	      )
125	    } else if (error.status === 401) {
126	      dispatch(
127	        loginError({
128	          message: 'user.login.error.message.incorrect',
129	        }),
130	      )
131	    }
132	  }
133	}
134
135	export const logout = (): AppThunk => async (dispatch) => {
136	  await remoteDb.logOut()
137	  dispatch(logoutSuccess())
138	}
139
140	export default userSlice.reducer
141	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3
4	import PatientRepository from '../../shared/db/PatientRepository'
5	import CareGoal from '../../shared/model/CareGoal'
6	import { uuid } from '../../shared/util/uuid'
7	import validateCareGoal from '../util/validate-caregoal'
8
9	interface AddCareGoalRequest {
10	  patientId: string
11	  careGoal: Omit<CareGoal, 'id' | 'createdOn'>
12	}
13
14	async function addCareGoal(request: AddCareGoalRequest): Promise<CareGoal[]> {
15	  const error = validateCareGoal(request.careGoal)
16
17	  if (isEmpty(error)) {
18	    const patient = await PatientRepository.find(request.patientId)
19	    const careGoals = patient.careGoals ? [...patient.careGoals] : []
20
21	    const newCareGoal: CareGoal = {
22	      id: uuid(),
23	      createdOn: new Date(Date.now()).toISOString(),
24	      ...request.careGoal,
25	    }
26	    careGoals.push(newCareGoal)
27
28	    await PatientRepository.saveOrUpdate({
29	      ...patient,
30	      careGoals,
31	    })
32
33	    return careGoals
34	  }
35
36	  error.message = 'patient.careGoal.error.unableToAdd'
37	  throw error
38	}
39
40	export default function useAddCareGoal() {
41	  return useMutation(addCareGoal, {
42	    onSuccess: async (data, variables) => {
43	      await queryCache.setQueryData(['care-goals', variables.patientId], data)
44	    },
45	    throwOnError: true,
46	  })
47	}
48	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/AddCareGoalModal.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/care-goals/AddCareGoalModal.tsx with line numbers:
1	import { Modal } from '@hospitalrun/components'
2	import addMonths from 'date-fns/addMonths'
3	import React, { useState, useEffect } from 'react'
4
5	import useTranslator from '../../shared/hooks/useTranslator'
6	import CareGoal, { CareGoalStatus, CareGoalAchievementStatus } from '../../shared/model/CareGoal'
7	import Patient from '../../shared/model/Patient'
8	import useAddCareGoal from '../hooks/useAddCareGoal'
9	import { CareGoalError } from '../util/validate-caregoal'
10	import CareGoalForm from './CareGoalForm'
11
12	interface Props {
13	  patient: Patient
14	  show: boolean
15	  onCloseButtonClick: () => void
16	}
17
18	const initialCareGoalState = {
19	  description: '',
20	  startDate: new Date().toISOString(),
21	  dueDate: addMonths(new Date(), 1).toISOString(),
22	  note: '',
23	  priority: 'medium',
24	  status: CareGoalStatus.Accepted,
25	  achievementStatus: CareGoalAchievementStatus.InProgress,
26	} as CareGoal
27
28	const AddCareGoalModal = (props: Props) => {
29	  const { t } = useTranslator()
30	  const { patient, show, onCloseButtonClick } = props
31	  const [mutate] = useAddCareGoal()
32	  const [careGoal, setCareGoal] = useState(initialCareGoalState)
33	  const [careGoalError, setCareGoalError] = useState<CareGoalError | undefined>(undefined)
34
35	  useEffect(() => {
36	    setCareGoal(initialCareGoalState)
37	  }, [show])
38
39	  const onClose = () => {
40	    onCloseButtonClick()
41	  }
42
43	  const onCareGoalChange = (newCareGoal: Partial<CareGoal>) => {
44	    setCareGoal(newCareGoal as CareGoal)
45	  }
46
47	  const onSaveButtonClick = async () => {
48	    try {
49	      await mutate({ patientId: patient.id, careGoal })
50	      onClose()
51	    } catch (e) {
52	      setCareGoalError(e)
53	    }
54	  }
55
56	  const body = (
57	    <CareGoalForm careGoal={careGoal} careGoalError={careGoalError} onChange={onCareGoalChange} />
58	  )
59
60	  return (
61	    <Modal
62	      show={show}
63	      toggle={onClose}
64	      title={t('patient.careGoal.new')}
65	      body={body}
66	      closeButton={{
67	        children: t('actions.cancel'),
68	        color: 'danger',
69	        onClick: onClose,
70	      }}
71	      successButton={{
72	        children: t('patient.careGoal.new'),
73	        color: 'success',
74	        icon: 'add',
75	        iconLocation: 'left',
76	        onClick: onSaveButtonClick,
77	      }}
78	    />
79	  )
80	}
81
82	export default AddCareGoalModal
83	


bash
command
grep -r "useQuery\|useMutation" /tmp/inputs/hospitalrun-frontend/src --include="*.ts" --include="*.tsx" | grep -v "__tests__" | head -30
output
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx:import { queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx:  return useMutation(reportIncident, {
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx:  return useQuery(['incident', incidentId], fetchIncidentById)
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx:  return useQuery(['incidents', searchRequest], fetchIncidents)
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx:import { queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx:  return useMutation(resolveIncident, {
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx:  return useQuery(['imagings', searchRequest], searchImagingRequests)
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx:  return useQuery(['imaging', imagingRequestId], getImagingRequestById)
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx:import { queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx:  return useMutation(requestImagingWrapper(user), {
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointments.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointments.tsx:  return useQuery(['appointments'], fetchAppointments)
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx:import { MutateFunction, queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx:  const [mutate, { isLoading, isError }] = useMutation(createNewAppointment, {
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointment.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointment.tsx:  return useQuery(['appointment', appointmentId], getAppointmentById)
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useDeleteAppointment.tsx:import { queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useDeleteAppointment.tsx:  return useMutation(deleteAppointment, {
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx:import { MutateFunction, queryCache, useMutation } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx:  const [mutate, { isLoading, isError }] = useMutation(updateAppointment, {
/tmp/inputs/hospitalrun-frontend/src/medications/hooks/useMedicationSearch.tsx:import { useQuery } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/medications/hooks/useMedicationSearch.tsx:  return useQuery(['medication-requests', searchRequest], searchMedicationRequests)
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts:import { useMutation, queryCache } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts:  return useMutation(requestLab, {
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCancelLab.ts:import { useMutation, queryCache } from 'react-query'
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCancelLab.ts:  return useMutation(cancelLab, {


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx with line numbers:
1	import { useQuery } from 'react-query'
2
3	import IncidentRepository from '../../shared/db/IncidentRepository'
4	import Incident from '../../shared/model/Incident'
5
6	function fetchIncidentById(_: any, incidentId: string): Promise<Incident> {
7	  return IncidentRepository.find(incidentId)
8	}
9
10	export default function useIncident(incidentId: string) {
11	  return useQuery(['incident', incidentId], fetchIncidentById)
12	}
13	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx with line numbers:
1	import React, { useEffect } from 'react'
2	import { useSelector } from 'react-redux'
3	import { useParams } from 'react-router-dom'
4
5	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
6	import { useUpdateTitle } from '../../page-header/title/TitleContext'
7	import useTranslator from '../../shared/hooks/useTranslator'
8	import { RootState } from '../../shared/store'
9	import ViewIncidentDetails from './ViewIncidentDetails'
10
11	const ViewIncident = () => {
12	  const { id } = useParams()
13	  const { permissions } = useSelector((root: RootState) => root.user)
14	  const { t } = useTranslator()
15	  const updateTitle = useUpdateTitle()
16	  useEffect(() => {
17	    updateTitle(t('incidents.reports.view'))
18	  })
19	  useAddBreadcrumbs([
20	    {
21	      i18nKey: 'incidents.reports.view',
22	      location: `/incidents/${id}`,
23	    },
24	  ])
25
26	  if (id === undefined || permissions === undefined) {
27	    return <></>
28	  }
29
30	  return <ViewIncidentDetails incidentId={id} permissions={permissions} />
31	}
32
33	export default ViewIncident
34	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx with line numbers:
1	import { Button, Column, Row, Spinner } from '@hospitalrun/components'
2	import format from 'date-fns/format'
3	import React from 'react'
4	import { useHistory } from 'react-router'
5
6	import usePatient from '../../patients/hooks/usePatient'
7	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
8	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
9	import useTranslator from '../../shared/hooks/useTranslator'
10	import Permissions from '../../shared/model/Permissions'
11	import { extractUsername } from '../../shared/util/extractUsername'
12	import useIncident from '../hooks/useIncident'
13	import useResolveIncident from '../hooks/useResolveIncident'
14
15	interface Props {
16	  incidentId: string
17	  permissions: (Permissions | null)[]
18	}
19
20	function ViewIncidentDetails(props: Props) {
21	  const { incidentId, permissions } = props
22	  const history = useHistory()
23	  const { t } = useTranslator()
24	  const { data, isLoading } = useIncident(incidentId)
25	  const { data: patient } = usePatient(data?.patient)
26	  const [mutate] = useResolveIncident()
27
28	  if (data === undefined || isLoading) {
29	    return <Spinner type="DotLoader" loading />
30	  }
31
32	  const onResolve = async () => {
33	    await mutate(data)
34	    history.push('/incidents')
35	  }
36
37	  const getButtons = () => {
38	    const buttons: React.ReactNode[] = []
39	    if (data.status === 'resolved') {
40	      return buttons
41	    }
42
43	    if (permissions.includes(Permissions.ResolveIncident)) {
44	      buttons.push(
45	        <Button onClick={onResolve} color="primary" key="incidents.reports.resolve">
46	          {t('incidents.reports.resolve')}
47	        </Button>,
48	      )
49	    }
50
51	    return buttons
52	  }
53
54	  const getResolvedOnDate = () => {
55	    if (data.status === 'resolved' && data.resolvedOn) {
56	      return (
57	        <Column>
58	          <div className="form-group incident-resolved-on">
59	            <h4>{t('incidents.reports.resolvedOn')}</h4>
60	            <h5>{format(new Date(data.resolvedOn), 'yyyy-MM-dd hh:mm a')}</h5>
61	          </div>
62	        </Column>
63	      )
64	    }
65	    return <></>
66	  }
67
68	  return (
69	    <>
70	      <Row>
71	        <Column>
72	          <div className="form-group incident-date">
73	            <h4>{t('incidents.reports.dateOfIncident')}</h4>
74	            <h5>{format(new Date(data.date || ''), 'yyyy-MM-dd hh:mm a')}</h5>
75	          </div>
76	        </Column>
77	        <Column>
78	          <div className="form-group incident-status">
79	            <h4>{t('incidents.reports.status')}</h4>
80	            <h5>{data.status}</h5>
81	          </div>
82	        </Column>
83	        <Column>
84	          <div className="form-group incident-reported-by">
85	            <h4>{t('incidents.reports.reportedBy')}</h4>
86	            <h5>{extractUsername(data.reportedBy)}</h5>
87	          </div>
88	        </Column>
89	        <Column>
90	          <div className="form-group incident-reported-on">
91	            <h4>{t('incidents.reports.reportedOn')}</h4>
92	            <h5>{format(new Date(data.reportedOn || ''), 'yyyy-MM-dd hh:mm a')}</h5>
93	          </div>
94	        </Column>
95	        {getResolvedOnDate()}
96	      </Row>
97	      <div className="border-bottom mb-2" />
98	      <Row>
99	        <Column md={12}>
100	          <TextInputWithLabelFormGroup
101	            label={t('incidents.reports.department')}
102	            name="department"
103	            value={data.department}
104	          />
105	        </Column>
106	      </Row>
107	      <Row>
108	        <Column md={6}>
109	          <TextInputWithLabelFormGroup
110	            name="category"
111	            label={t('incidents.reports.category')}
112	            value={data.category}
113	          />
114	        </Column>
115	        <Column md={6}>
116	          <TextInputWithLabelFormGroup
117	            label={t('incidents.reports.categoryItem')}
118	            name="categoryItem"
119	            value={data.categoryItem}
120	          />
121	        </Column>
122	      </Row>
123	      <Row>
124	        <Column md={12}>
125	          <TextFieldWithLabelFormGroup
126	            label={t('incidents.reports.description')}
127	            name="description"
128	            value={data.description}
129	          />
130	        </Column>
131	      </Row>
132	      {data.patient && (
133	        <Row>
134	          <Column md={6}>
135	            <TextInputWithLabelFormGroup
136	              label={t('incidents.reports.patient')}
137	              name="patient"
138	              value={patient?.fullName}
139	            />
140	          </Column>
141	        </Row>
142	      )}
143	      {data.resolvedOn === undefined && (
144	        <div className="row float-right">
145	          <div className="btn-group btn-group-lg mt-3 mr-3">{getButtons()}</div>
146	        </div>
147	      )}
148	    </>
149	  )
150	}
151
152	export default ViewIncidentDetails
153	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx with line numbers:
1	import { Spinner } from '@hospitalrun/components'
2	import React from 'react'
3
4	const Loading = () => <Spinner color="blue" loading size={20} type="BeatLoader" />
5
6	export default Loading
7	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts with line numbers:
1	export default {
2	  patient: {
3	    label: 'Patient',
4	    code: 'Patient Code',
5	    firstName: 'First Name',
6	    lastName: 'Last Name',
7	    suffix: 'Suffix',
8	    prefix: 'Prefix',
9	    givenName: 'Given Name',
10	    familyName: 'Family Name',
11	    dateOfBirth: 'Date of Birth',
12	    approximateDateOfBirth: 'Approximate Date of Birth',
13	    age: 'Age',
14	    approximateAge: 'Approximate Age',
15	    placeOfBirth: 'Place of Birth',
16	    sex: 'Sex',
17	    bloodType: 'Blood Type',
18	    contactInfoType: {
19	      label: 'Type',
20	      options: {
21	        home: 'Home',
22	        mobile: 'Mobile',
23	        work: 'Work',
24	        temporary: 'Temporary',
25	        old: 'Old',
26	      },
27	    },
28	    phoneNumber: 'Phone Number',
29	    email: 'Email',
30	    address: 'Address',
31	    occupation: 'Occupation',
32	    type: 'Patient Type',
33	    preferredLanguage: 'Preferred Language',
34	    basicInformation: 'Basic Information',
35	    generalInformation: 'General Information',
36	    contactInformation: 'Contact Information',
37	    unknownDateOfBirth: 'Unknown',
38	    relatedPerson: 'Related Person',
39	    relatedPersons: {
40	      error: {
41	        unableToAddRelatedPerson: 'Unable to add new related person.',
42	        relatedPersonRequired: 'Related Person is required.',
43	        relationshipTypeRequired: 'Relationship Type is required.',
44	      },
45	      label: 'Related Persons',
46	      new: 'New Related Person',
47	      add: 'Add Related Person',
48	      relationshipType: 'Relationship Type',
49	      warning: {
50	        noRelatedPersons: 'No related persons',
51	      },
52	      addRelatedPersonAbove: 'Add a related person using the button above.',
53	    },
54	    appointments: {
55	      new: 'Add Appointment',
56	      warning: {
57	        noAppointments: 'No Appointments',
58	      },
59	      addAppointmentAbove: 'Add an appointment using the button above.',
60	    },
61	    allergies: {
62	      label: 'Allergies',
63	      allergyName: 'Allergy Name',
64	      new: 'Add Allergy',
65	      error: {
66	        nameRequired: 'Name is required.',
67	        unableToAdd: 'Unable to add allergy.',
68	      },
69	      warning: {
70	        noAllergies: 'No Allergies',
71	      },
72	      addAllergyAbove: 'Add an allergy using the button above.',
73	      successfullyAdded: 'Successfully added a new allergy!',
74	    },
75	    diagnoses: {
76	      label: 'Diagnoses',
77	      new: 'Add Diagnosis',
78	      diagnosisName: 'Name',
79	      diagnosisDate: 'Date',
80	      onsetDate: 'Onset Date',
81	      abatementDate: 'Abatement Date',
82	      visit: 'Visit',
83	      status: 'Status',
84	      active: 'Active',
85	      recurrence: 'Recurrence',
86	      relapse: 'Relapse',
87	      inactive: 'Inactive',
88	      remission: 'Remission',
89	      resolved: 'Resolved',
90	      note: 'Note',
91	      warning: {
92	        noDiagnoses: 'No Diagnoses',
93	      },
94	      error: {
95	        nameRequired: 'Diagnosis Name is required.',
96	        dateRequired: 'Diagnosis Date is required.',
97	        unableToAdd: 'Unable to add new diagnosis',
98	      },
99	      addDiagnosisAbove: 'Add a diagnosis using the button above.',
100	      successfullyAdded: 'Successfully added a new diagnosis!',
101	    },
102	    note: 'Note',
103	    notes: {
104	      label: 'Notes',
105	      new: 'Add New Note',
106	      warning: {
107	        noNotes: 'No Notes',
108	      },
109	      error: {
110	        noteRequired: 'Note is required.',
111	        unableToAdd: 'Unable to add new note.',
112	      },
113	      addNoteAbove: 'Add a note using the button above.',
114	    },
115	    labs: {
116	      label: 'Labs',
117	      new: 'Add New Lab',
118	      warning: {
119	        noLabs: 'No Labs',
120	      },
121	      noLabsMessage: 'No labs requests for this person.',
122	    },
123	    medications: {
124	      label: 'Medications',
125	      new: 'Add New Medication',
126	      warning: {
127	        noMedications: 'No Medications',
128	      },
129	      noMedicationsMessage: 'No medications requests for this person.',
130	    },
131	    careGoal: {
132	      new: 'Add Care Goal',
133	      label: 'Care Goals',
134	      title: 'Title',
135	      description: 'Description',
136	      status: 'Status',
137	      achievementStatus: 'Achievement Status',
138	      priority: {
139	        label: 'Priority',
140	        low: 'low',
141	        medium: 'medium',
142	        high: 'high',
143	      },
144	      startDate: 'Start Date',
145	      dueDate: 'Due Date',
146	      note: 'Note',
147	      error: {
148	        unableToAdd: 'Unable to add a new care goal.',
149	        descriptionRequired: 'Description is required.',
150	        priorityRequired: 'Priority is required.',
151	        statusRequired: 'Status is required.',
152	        achievementStatusRequired: 'Achievement Status is required.',
153	        startDate: 'Start date is required.',
154	        dueDate: 'Due date is required.',
155	        dueDateMustBeAfterStartDate: 'Due date must be after start date',
156	      },
157	    },
158	    careGoals: {
159	      warning: {
160	        noCareGoals: 'No Care Goals',
161	        addCareGoalAbove: 'Add a care goal using the button above.',
162	      },
163	    },
164	    carePlan: {
165	      new: 'Add Care Plan',
166	      label: 'Care Plans',
167	      title: 'Title',
168	      description: 'Description',
169	      status: 'Status',
170	      condition: 'Condition',
171	      intent: 'Intent',
172	      startDate: 'Start Date',
173	      endDate: 'End Date',
174	      note: 'Note',
175	      error: {
176	        unableToAdd: 'Unable to add a new care plan.',
177	        titleRequired: 'Title is required.',
178	        descriptionRequired: 'Description is required.',
179	        conditionRequired: 'Condition is required.',
180	        statusRequired: 'Status is required.',
181	        intentRequired: 'Intent is required.',
182	        startDate: 'Start date is required.',
183	        endDate: 'End date is required',
184	      },
185	    },
186	    carePlans: {
187	      warning: {
188	        noCarePlans: 'No Care Plans',
189	        addCarePlanAbove: 'Add a care plan using the button above.',
190	      },
191	    },
192	    visit: 'Visit',
193	    history: {
194	      label: 'History',
195	      eventDate: 'Event Date',
196	      recordType: 'Record Type',
197	      information: 'Information',
198	      noHistoryTitle: 'No History',
199	      noHistoryMessage: 'There is no histories for this patient',
200	    },
201	    visits: {
202	      new: 'Add Visit',
203	      label: 'Visits',
204	      startDateTime: 'Start Date',
205	      endDateTime: 'End Date',
206	      type: 'Type',
207	      status: 'Status',
208	      reason: 'Reason',
209	      location: 'Location',
210	      error: {
211	        unableToAdd: 'Unable to add a new visit.',
212	        startDateRequired: 'Start date is required.',
213	        endDateRequired: 'End date is required',
214	        endDateMustBeAfterStartDate: 'End date must be after start date',
215	        typeRequired: 'Type is required.',
216	        statusRequired: 'Status is required.',
217	        reasonRequired: 'Reason is required.',
218	        locationRequired: 'Location is required.',
219	      },
220	      warning: {
221	        noVisits: 'No Visits',
222	        addVisitAbove: 'Add a visit using the button above.',
223	      },
224	    },
225	    types: {
226	      charity: 'Charity',
227	      private: 'Private',
228	    },
229	    errors: {
230	      createPatientError: 'Could not create new patient.',
231	      updatePatientError: 'Could not update patient.',
232	      patientGivenNameFeedback: 'Given Name is required.',
233	      patientDateOfBirthFeedback: 'Date of Birth can not be greater than today',
234	      patientNumInSuffixFeedback: 'Cannot contain numbers.',
235	      patientNumInPrefixFeedback: 'Cannot contain numbers.',
236	      patientNumInFamilyNameFeedback: 'Cannot contain numbers.',
237	      patientNumInPreferredLanguageFeedback: 'Cannot contain numbers.',
238	      invalidEmail: 'Must be a valid email.',
239	      invalidPhoneNumber: 'Must be a valid phone number.',
240	    },
241	  },
242	}
243	


bash
command
grep -r "Toast" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" | grep -v "__tests__" | head -20
output
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx:import { Toaster } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx:              <Toaster autoClose={5000} hideProgressBar draggable />
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx:import { Spinner, Button, Modal, Toast } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx:      Toast('success', t('states.success'), t('scheduling.appointment.successfullyDeleted'))
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx:import { Button, Spinner, Toast } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx:          Toast('success', t('states.success'), t('scheduling.appointment.successfullyCreated'))
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/edit/EditAppointment.tsx:import { Spinner, Button, Toast } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/edit/EditAppointment.tsx:        Toast('success', t('states.success'), t('scheduling.appointment.successfullyUpdated'))
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:import { Row, Column, Badge, Button, Alert, Toast, Callout, Label } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:    Toast('success', t('states.success'), t('labs.successfullyDeletedNote'))
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:      Toast(
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:        Toast(
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx:  Toast,
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx:      Toast(
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx:import { Button, Toast } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx:    Toast(
/tmp/inputs/hospitalrun-frontend/src/patients/edit/EditPatient.tsx:import { Spinner, Button, Toast } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/edit/EditPatient.tsx:    Toast(


bash
command
grep -r "Alert" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" | grep -v "__tests__" | head -20
output
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx:import { Select, Typeahead, Label, Button, Alert, Column, Row } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx:        <Alert color="danger" title={t('states.error')} message={t(error.message)} />
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/AppointmentDetailForm.tsx:import { Select, Typeahead, Label, Alert } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/AppointmentDetailForm.tsx:      {error?.message && <Alert className="alert" color="danger" message={t(error?.message)} />}
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx:import { Select, Row, Column, Badge, Button, Alert, Label } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx:          <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />
/tmp/inputs/hospitalrun-frontend/src/medications/requests/NewMedicationRequest.tsx:import { Select, Typeahead, Label, Button, Alert, Column, Row } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/medications/requests/NewMedicationRequest.tsx:        <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:import { Row, Column, Badge, Button, Alert, Toast, Callout, Label } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx:          <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx:  Alert,
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx:      {error && <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />}
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx:import { Select, Label, Panel, Checkbox, Alert } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx:        {error?.message && <Alert className="alert" color="danger" message={t(error?.message)} />}
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/AllergiesList.tsx:import { Alert, List, ListItem } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/AllergiesList.tsx:      <Alert
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx:import { Modal, Alert } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx:        <Alert
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx:import { Modal, Alert, Typeahead, Label } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx:        <Alert


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx with line numbers:
1	import { Row, Column, Badge, Button, Alert, Toast, Callout, Label } from '@hospitalrun/components'
2	import format from 'date-fns/format'
3	import React, { useEffect, useState } from 'react'
4	import { useSelector } from 'react-redux'
5	import { useParams, useHistory } from 'react-router-dom'
6
7	import useAddBreadcrumbs from '../page-header/breadcrumbs/useAddBreadcrumbs'
8	import { useUpdateTitle } from '../page-header/title/TitleContext'
9	import usePatient from '../patients/hooks/usePatient'
10	import TextFieldWithLabelFormGroup from '../shared/components/input/TextFieldWithLabelFormGroup'
11	import useTranslator from '../shared/hooks/useTranslator'
12	import Lab from '../shared/model/Lab'
13	import Patient from '../shared/model/Patient'
14	import Permissions from '../shared/model/Permissions'
15	import { RootState } from '../shared/store'
16	import { uuid } from '../shared/util/uuid'
17	import useCancelLab from './hooks/useCancelLab'
18	import useCompleteLab from './hooks/useCompleteLab'
19	import useLab from './hooks/useLab'
20	import useUpdateLab from './hooks/useUpdateLab'
21	import { LabError } from './utils/validate-lab'
22
23	const getTitle = (patient: Patient | undefined, lab: Lab | undefined) =>
24	  patient && lab ? `${lab.type} for ${patient.fullName}(${lab.code})` : ''
25
26	const ViewLab = () => {
27	  const { id } = useParams()
28	  const { t } = useTranslator()
29	  const history = useHistory()
30	  const { permissions } = useSelector((state: RootState) => state.user)
31
32	  const [labToView, setLabToView] = useState<Lab>()
33	  const [newNoteText, setNewNoteText] = useState<string>()
34	  const [isEditable, setIsEditable] = useState<boolean>(true)
35
36	  const { data: lab } = useLab(id)
37	  const { data: patient } = usePatient(lab?.patient)
38	  const [updateLab] = useUpdateLab()
39	  const [completeLab] = useCompleteLab()
40	  const [cancelLab] = useCancelLab()
41	  const [error, setError] = useState<LabError | undefined>(undefined)
42
43	  const updateTitle = useUpdateTitle()
44	  useEffect(() => {
45	    updateTitle(getTitle(patient, labToView))
46	  })
47
48	  const breadcrumbs = [
49	    {
50	      i18nKey: 'labs.requests.view',
51	      location: `/labs/${labToView?.id}`,
52	    },
53	  ]
54	  useAddBreadcrumbs(breadcrumbs)
55
56	  useEffect(() => {
57	    if (lab) {
58	      setLabToView({ ...lab })
59	      setIsEditable(lab.status === 'requested')
60	    }
61	  }, [lab])
62
63	  const onResultChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
64	    const result = event.currentTarget.value
65	    const newLab = labToView as Lab
66	    setLabToView({ ...newLab, result })
67	  }
68
69	  const onNotesChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
70	    const notes = event.currentTarget.value
71	    setNewNoteText(notes)
72	  }
73
74	  const deleteNote = async (noteIdToDelete: string) => {
75	    if (!labToView || !labToView.notes) {
76	      return
77	    }
78
79	    const updatedNotes = labToView!.notes!.map((note) => {
80	      if (note.id === noteIdToDelete) {
81	        note.deleted = true
82	      }
83
84	      return note
85	    })
86
87	    const newLab = {
88	      ...labToView,
89	      notes: updatedNotes,
90	    }
91
92	    await updateLab(newLab as Lab)
93	    Toast('success', t('states.success'), t('labs.successfullyDeletedNote'))
94	  }
95
96	  const onUpdate = async () => {
97	    if (labToView) {
98	      const newLab = labToView as Lab
99
100	      if (newNoteText) {
101	        const newNote = {
102	          id: uuid(),
103	          date: new Date().toISOString(),
104	          text: newNoteText,
105	          deleted: false,
106	        }
107
108	        newLab.notes = newLab.notes ? [...newLab.notes, newNote] : [newNote]
109	        setNewNoteText('')
110	      }
111
112	      const updatedLab = await updateLab(newLab)
113	      history.push(`/labs/${updatedLab?.id}`)
114	      Toast(
115	        'success',
116	        t('states.success'),
117	        `${t('labs.successfullyUpdated')} ${updatedLab?.type} for ${patient?.fullName}`,
118	      )
119	    }
120	    setError(undefined)
121	  }
122
123	  const onComplete = async () => {
124	    try {
125	      if (labToView) {
126	        const completedLab = await completeLab(labToView)
127	        history.push(`/labs/${completedLab?.id}`)
128	        Toast(
129	          'success',
130	          t('states.success'),
131	          `${t('labs.successfullyCompleted')} ${completedLab?.type} for ${patient?.fullName} `,
132	        )
133	      }
134	      setError(undefined)
135	    } catch (e) {
136	      setError(e)
137	    }
138	  }
139
140	  const onCancel = async () => {
141	    if (labToView) {
142	      cancelLab(labToView)
143	      history.push('/labs')
144	    }
145	  }
146
147	  const getButtons = () => {
148	    const buttons: React.ReactNode[] = []
149	    if (labToView?.status === 'completed' || labToView?.status === 'canceled') {
150	      return buttons
151	    }
152
153	    buttons.push(
154	      <Button className="mr-2" color="success" onClick={onUpdate} key="actions.update">
155	        {t('labs.requests.update')}
156	      </Button>,
157	    )
158
159	    if (permissions.includes(Permissions.CompleteLab)) {
160	      buttons.push(
161	        <Button className="mr-2" onClick={onComplete} color="primary" key="labs.requests.complete">
162	          {t('labs.requests.complete')}
163	        </Button>,
164	      )
165	    }
166
167	    if (permissions.includes(Permissions.CancelLab)) {
168	      buttons.push(
169	        <Button onClick={onCancel} color="danger" key="labs.requests.cancel">
170	          {t('labs.requests.cancel')}
171	        </Button>,
172	      )
173	    }
174
175	    return buttons
176	  }
177
178	  if (labToView && patient) {
179	    const getBadgeColor = () => {
180	      if (labToView.status === 'completed') {
181	        return 'primary'
182	      }
183	      if (labToView.status === 'canceled') {
184	        return 'danger'
185	      }
186	      return 'warning'
187	    }
188
189	    const getCanceledOnOrCompletedOnDate = () => {
190	      if (labToView.status === 'completed' && labToView.completedOn) {
191	        return (
192	          <Column>
193	            <div className="form-group completed-on">
194	              <h4>{t('labs.lab.completedOn')}</h4>
195	              <h5>{format(new Date(labToView.completedOn), 'yyyy-MM-dd hh:mm a')}</h5>
196	            </div>
197	          </Column>
198	        )
199	      }
200	      if (labToView.status === 'canceled' && labToView.canceledOn) {
201	        return (
202	          <Column>
203	            <div className="form-group canceled-on">
204	              <h4>{t('labs.lab.canceledOn')}</h4>
205	              <h5>{format(new Date(labToView.canceledOn), 'yyyy-MM-dd hh:mm a')}</h5>
206	            </div>
207	          </Column>
208	        )
209	      }
210	      return <></>
211	    }
212
213	    const getPastNotes = () => {
214	      if (labToView?.notes?.length && labToView.notes.length > 0) {
215	        return labToView.notes
216	          .filter((note) => !note.deleted)
217	          .map((note) => (
218	            <Callout key={note.id} color="info">
219	              <div className="d-flex justify-content-between">
220	                <p data-testid="note">{note.text}</p>
221	                {labToView.status === 'requested' && (
222	                  <Button icon="remove" onClick={async () => deleteNote(note.id)} color="danger">
223	                    <span data-testid={`delete-note-${note.id}`}>Delete</span>
224	                  </Button>
225	                )}
226	              </div>
227	            </Callout>
228	          ))
229	      }
230
231	      return <></>
232	    }
233
234	    return (
235	      <>
236	        {error && (
237	          <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />
238	        )}
239	        <Row>
240	          <Column>
241	            <div className="form-group lab-status">
242	              <h4>{t('labs.lab.status')}</h4>
243	              <Badge color={getBadgeColor()}>
244	                <h5>{labToView.status}</h5>
245	              </Badge>
246	            </div>
247	          </Column>
248	          <Column>
249	            <div className="form-group for-patient">
250	              <h4>{t('labs.lab.for')}</h4>
251	              <h5>{patient.fullName}</h5>
252	            </div>
253	          </Column>
254	          <Column>
255	            <div className="form-group lab-type">
256	              <h4>{t('labs.lab.type')}</h4>
257	              <h5>{labToView.type}</h5>
258	            </div>
259	          </Column>
260	          <Column>
261	            <div className="form-group requested-on">
262	              <h4>{t('labs.lab.requestedOn')}</h4>
263	              <h5>{format(new Date(labToView.requestedOn), 'yyyy-MM-dd hh:mm a')}</h5>
264	            </div>
265	          </Column>
266	          {getCanceledOnOrCompletedOnDate()}
267	        </Row>
268	        <div className="border-bottom" />
269	        <form>
270	          <TextFieldWithLabelFormGroup
271	            name="result"
272	            label={t('labs.lab.result')}
273	            value={labToView.result}
274	            isEditable={isEditable}
275	            isInvalid={!!error?.result}
276	            feedback={t(error?.result as string)}
277	            onChange={onResultChange}
278	          />
279	          <Label text={t('labs.lab.notes')} htmlFor="notesTextField" />
280	          {getPastNotes()}
281	          {isEditable && (
282	            <TextFieldWithLabelFormGroup
283	              name="notes"
284	              value={newNoteText}
285	              isEditable={isEditable}
286	              onChange={onNotesChange}
287	            />
288	          )}
289	          {isEditable && (
290	            <div className="row float-right">
291	              <div className="btn-group btn-group-lg mt-3 mr-3">{getButtons()}</div>
292	            </div>
293	          )}
294	        </form>
295	      </>
296	    )
297	  }
298	  return <h1>Loading...</h1>
299	}
300
301	export default ViewLab
302	

Now let me look at a few more patterns including the i18n setup and some additional slices:

str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/util
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/patients/util, excluding hidden items and node_modules:
16K	/tmp/inputs/hospitalrun-frontend/src/patients/util
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/is-possible-duplicate-patient.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/patient-util.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/set-patient-helper.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/timestamp-id-generator.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-allergy.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-careplan.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-diagnosis.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-note.ts
3.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-related-person.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-visit.ts



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts with line numbers:
1	import isBefore from 'date-fns/isBefore'
2
3	import CareGoal from '../../shared/model/CareGoal'
4
5	export class CareGoalError extends Error {
6	  message: string
7
8	  description?: string
9
10	  status?: string
11
12	  achievementStatus?: string
13
14	  priority?: string
15
16	  startDate?: string
17
18	  dueDate?: string
19
20	  constructor(
21	    message: string,
22	    description: string,
23	    status: string,
24	    achievementStatus: string,
25	    priority: string,
26	    startDate: string,
27	    dueDate: string,
28	  ) {
29	    super(message)
30	    this.message = message
31	    this.description = description
32	    this.status = status
33	    this.achievementStatus = achievementStatus
34	    this.priority = priority
35	    this.startDate = startDate
36	    this.dueDate = dueDate
37	  }
38	}
39
40	export default function validateCareGoal(careGoal: Partial<CareGoal>): CareGoalError {
41	  const error = {} as CareGoalError
42
43	  if (!careGoal.description) {
44	    error.description = 'patient.careGoal.error.descriptionRequired'
45	  }
46
47	  if (!careGoal.status) {
48	    error.status = 'patient.careGoal.error.statusRequired'
49	  }
50
51	  if (!careGoal.achievementStatus) {
52	    error.achievementStatus = 'patient.careGoal.error.achievementStatusRequired'
53	  }
54
55	  if (!careGoal.priority) {
56	    error.priority = 'patient.careGoal.error.priorityRequired'
57	  }
58
59	  if (!careGoal.startDate) {
60	    error.startDate = 'patient.careGoal.error.startDate'
61	  }
62
63	  if (!careGoal.dueDate) {
64	    error.dueDate = 'patient.careGoal.error.dueDate'
65	  }
66
67	  if (careGoal.startDate && careGoal.dueDate) {
68	    if (isBefore(new Date(careGoal.dueDate), new Date(careGoal.startDate))) {
69	      error.dueDate = 'patient.careGoal.error.dueDateMustBeAfterStartDate'
70	    }
71	  }
72
73	  return error
74	}
75	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalForm.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalForm.tsx with line numbers:
1	import { Select, Label, Alert, Row, Column } from '@hospitalrun/components'
2	import React, { useState } from 'react'
3
4	import DatePickerWithLabelFormGroup from '../../shared/components/input/DatePickerWithLabelFormGroup'
5	import { SelectOption } from '../../shared/components/input/SelectOption'
6	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
7	import useTranslator from '../../shared/hooks/useTranslator'
8	import CareGoal, { CareGoalStatus, CareGoalAchievementStatus } from '../../shared/model/CareGoal'
9
10	interface Error {
11	  message?: string
12	  description?: string
13	  status?: string
14	  achievementStatus?: string
15	  priority?: string
16	  startDate?: string
17	  dueDate?: string
18	  note?: string
19	}
20
21	interface Props {
22	  careGoal: Partial<CareGoal>
23	  careGoalError?: Error
24	  onChange?: (newCareGoal: Partial<CareGoal>) => void
25	  disabled: boolean
26	}
27
28	const CareGoalForm = (props: Props) => {
29	  const { careGoal, careGoalError, disabled, onChange } = props
30	  const { t } = useTranslator()
31
32	  const [priority, setPriority] = useState(careGoal.priority)
33	  const [status, setStatus] = useState(careGoal.status)
34	  const [achievementStatus, setAchievementStatus] = useState(careGoal.achievementStatus)
35
36	  const priorityOptions: SelectOption[] = [
37	    { label: t('patient.careGoal.priority.low'), value: 'low' },
38	    { label: t('patient.careGoal.priority.medium'), value: 'medium' },
39	    { label: t('patient.careGoal.priority.high'), value: 'high' },
40	  ]
41
42	  const statusOptions: SelectOption[] = Object.values(CareGoalStatus).map((v) => ({
43	    label: v,
44	    value: v,
45	  }))
46
47	  const achievementsStatusOptions: SelectOption[] = Object.values(CareGoalAchievementStatus).map(
48	    (v) => ({
49	      label: v,
50	      value: v,
51	    }),
52	  )
53
54	  const onFieldChange = (
55	    name: string,
56	    value: string | CareGoalStatus | CareGoalAchievementStatus,
57	  ) => {
58	    if (onChange) {
59	      const newCareGoal = {
60	        ...careGoal,
61	        [name]: value,
62	      }
63	      onChange(newCareGoal)
64	    }
65	  }
66
67	  const onPriorityChange = (values: string[]) => {
68	    const value = values[0] as 'low' | 'medium' | 'high'
69
70	    onFieldChange('priority', value)
71	    setPriority(value)
72	  }
73
74	  return (
75	    <form aria-label="care-goal-form">
76	      {careGoalError?.message && <Alert color="danger" message={t(careGoalError.message)} />}
77	      <Row>
78	        <Column sm={12}>
79	          <TextFieldWithLabelFormGroup
80	            isRequired
81	            value={careGoal.description}
82	            label={t('patient.careGoal.description')}
83	            name="description"
84	            feedback={t(careGoalError?.description || '')}
85	            isInvalid={!!careGoalError?.description}
86	            isEditable={!disabled}
87	            onChange={(event) => onFieldChange('description', event.currentTarget.value)}
88	          />
89	        </Column>
90	      </Row>
91	      <Row>
92	        <Column sm={12}>
93	          <div className="form-group" data-testid="prioritySelect">
94	            <Label
95	              title="This is a required input"
96	              text={t('patient.careGoal.priority.label')}
97	              htmlFor="prioritySelect"
98	              isRequired
99	            />
100	            <Select
101	              id="prioritySelect"
102	              options={priorityOptions}
103	              onChange={onPriorityChange}
104	              defaultSelected={priorityOptions.filter(({ value }) => value === priority)}
105	              isInvalid={!!careGoalError?.priority}
106	              disabled={disabled}
107	            />
108	          </div>
109	        </Column>
110	      </Row>
111	      <Row>
112	        <Column sm={6}>
113	          <div className="form-group" data-testid="statusSelect">
114	            <Label
115	              title="This is a required input"
116	              text={t('patient.careGoal.status')}
117	              htmlFor="statusSelect"
118	              isRequired
119	            />
120	            <Select
121	              id="statusSelect"
122	              options={statusOptions}
123	              onChange={(values) => {
124	                onFieldChange('status', values[0])
125	                setStatus(values[0] as CareGoalStatus)
126	              }}
127	              defaultSelected={statusOptions.filter(({ value }) => value === status)}
128	              isInvalid={!!careGoalError?.status}
129	              disabled={disabled}
130	            />
131	          </div>
132	        </Column>
133	        <Column sm={6}>
134	          <div className="form-group" data-testid="achievementStatusSelect">
135	            <Label
136	              title="This is a required input"
137	              text={t('patient.careGoal.achievementStatus')}
138	              htmlFor="achievementStatusSelect"
139	              isRequired
140	            />
141	            <Select
142	              id="achievementStatusSelect"
143	              options={achievementsStatusOptions}
144	              onChange={(values) => {
145	                onFieldChange('achievementStatus', values[0])
146	                setAchievementStatus(values[0] as CareGoalAchievementStatus)
147	              }}
148	              defaultSelected={achievementsStatusOptions.filter(
149	                ({ value }) => value === achievementStatus,
150	              )}
151	              isInvalid={!!careGoalError?.achievementStatus}
152	              disabled={disabled}
153	            />
154	          </div>
155	        </Column>
156	      </Row>
157	      <Row>
158	        <Column sm={6}>
159	          <DatePickerWithLabelFormGroup
160	            name="startDate"
161	            label={t('patient.careGoal.startDate')}
162	            isRequired
163	            value={careGoal.startDate ? new Date(careGoal.startDate) : new Date()}
164	            isEditable={!disabled}
165	            isInvalid={!!careGoalError?.startDate}
166	            feedback={t(careGoalError?.startDate) || ''}
167	            onChange={(date) => (date ? onFieldChange('startDate', date.toISOString()) : null)}
168	          />
169	        </Column>
170	        <Column sm={6}>
171	          <DatePickerWithLabelFormGroup
172	            name="dueDate"
173	            label={t('patient.careGoal.dueDate')}
174	            isRequired
175	            isEditable={!disabled}
176	            isInvalid={!!careGoalError?.dueDate}
177	            feedback={t(careGoalError?.dueDate) || ''}
178	            value={careGoal.dueDate ? new Date(careGoal.dueDate) : new Date()}
179	            onChange={(date) => (date ? onFieldChange('dueDate', date.toISOString()) : null)}
180	          />
181	        </Column>
182	      </Row>
183	      <Row>
184	        <Column sm={12}>
185	          <TextFieldWithLabelFormGroup
186	            name="note"
187	            label={t('patient.careGoal.note')}
188	            value={careGoal.note}
189	            isEditable={!disabled}
190	            isInvalid={!!careGoalError?.note}
191	            feedback={t(careGoalError?.note) || ''}
192	            onChange={(event) => onFieldChange('note', event.currentTarget.value)}
193	          />
194	        </Column>
195	      </Row>
196	    </form>
197	  )
198	}
199
200	CareGoalForm.defaultProps = {
201	  disabled: false,
202	}
203
204	export default CareGoalForm
205	


bash
command
grep -r "Spinner\|loading\|isLoading" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" | grep -v "__tests__" | head -30
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx:import { Spinner } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/App.tsx:  const [loading, setLoading] = useState(true)
/tmp/inputs/hospitalrun-frontend/src/App.tsx:  if (loading) {
/tmp/inputs/hospitalrun-frontend/src/App.tsx:        <Suspense fallback={<Spinner color="blue" loading size={[10, 25]} type="ScaleLoader" />}>
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx:import { Button, Column, Row, Spinner } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx:  const { data, isLoading } = useIncident(incidentId)
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx:  if (data === undefined || isLoading) {
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx:    return <Spinner type="DotLoader" loading />
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx:import { Spinner, Table, Dropdown } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx:  const { data, isLoading } = useIncidents(searchRequest)
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx:  if (data === undefined || isLoading) {
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx:    return <Spinner type="DotLoader" loading />
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx:import { LineGraph, Spinner } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx:  const { data, isLoading } = useIncidents(searchRequest)
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx:    if (data === undefined || isLoading) {
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx:  }, [data, monthlyIncidents, isLoading, incident])
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx:    <Spinner type="DotLoader" loading />
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ImagingRequestTable.tsx:  if (data === undefined || status === 'loading') {
/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx:import { Spinner } from '@hospitalrun/components'
/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx:const Loading = () => <Spinner color="blue" loading size={20} type="BeatLoader" />
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx:  isLoading: boolean
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx:  const [mutate, { isLoading, isError }] = useMutation(createNewAppointment, {
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx:    isLoading,
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx:  isLoading: boolean
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx:  const [mutate, { isLoading, isError }] = useMutation(updateAppointment, {
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx:    isLoading,
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx:  const { data: appointments, isLoading } = useAppointments()
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx:    if (appointments && !isLoading) {
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx:  }, [appointments, isLoading])
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx:  if (isLoading || appointments === undefined) {


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/hooks
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/patients/hooks, excluding hidden items and node_modules:
25K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAllergy.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCareGoal.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCarePlan.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useDiagnosis.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatient.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientAllergies.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientAppointments.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientCareGoals.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientCarePlans.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientDiagnoses.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientLabs.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientMedications.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientNote.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientNotes.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientRelatedPersons.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientVisits.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatients.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useRemovePatientRelatedPerson.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useVisit.tsx



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatient.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatient.tsx with line numbers:
1	import { useQuery } from 'react-query'
2
3	import PatientRepository from '../../shared/db/PatientRepository'
4	import Patient from '../../shared/model/Patient'
5
6	function fetchPatient(_: any, id?: string): Promise<Patient> {
7	  return PatientRepository.find(id || '')
8	}
9
10	export default function usePatient(id?: string) {
11	  return useQuery(['patient', id], fetchPatient, { enabled: id })
12	}
13	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx with line numbers:
1	import * as React from 'react'
2
3	type SetTitle = (title: string) => void
4	type State = { title: string }
5	type TitleProviderProps = { children: React.ReactNode }
6	const TitleStateContext = React.createContext<State | undefined>(undefined)
7	const TitleDispatchContext = React.createContext<SetTitle | undefined>(undefined)
8
9	function TitleProvider({ children }: TitleProviderProps) {
10	  const [title, setTitle] = React.useState('')
11	  return (
12	    <TitleStateContext.Provider value={{ title }}>
13	      <TitleDispatchContext.Provider value={setTitle}>{children}</TitleDispatchContext.Provider>
14	    </TitleStateContext.Provider>
15	  )
16	}
17	function useTitle() {
18	  const context = React.useContext(TitleStateContext)
19	  if (context === undefined) {
20	    throw new Error('useTitle must be used within a TitleProvider')
21	  }
22	  return context
23	}
24	function useUpdateTitle() {
25	  const context = React.useContext(TitleDispatchContext)
26	  if (context === undefined) {
27	    throw new Error('useUpdateTitle must be used within a TitleProvider')
28	  }
29	  return context
30	}
31	export { TitleProvider, useTitle, useUpdateTitle }
32	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx with line numbers:
1	import React, { useState } from 'react'
2
3	type Props = {
4	  children?: React.ReactNode
5	}
6
7	type ButtonUpdater = (buttons: React.ReactNode[]) => void
8
9	const ButtonBarStateContext = React.createContext<React.ReactNode[]>([])
10	const ButtonBarUpdateContext = React.createContext<ButtonUpdater>(() => {
11	  // empty initial state
12	})
13
14	function ButtonBarProvider(props: Props) {
15	  const { children } = props
16	  const [state, setState] = useState<React.ReactNode[]>([])
17	  return (
18	    <ButtonBarStateContext.Provider value={state}>
19	      <ButtonBarUpdateContext.Provider value={setState}>{children}</ButtonBarUpdateContext.Provider>
20	    </ButtonBarStateContext.Provider>
21	  )
22	}
23	function useButtons() {
24	  const context = React.useContext(ButtonBarStateContext)
25	  if (context === undefined) {
26	    throw new Error('useButtons must be used within a Button Bar Context')
27	  }
28	  return context
29	}
30	function useButtonToolbarSetter() {
31	  const context = React.useContext(ButtonBarUpdateContext)
32	  if (context === undefined) {
33	    throw new Error('useButtonToolBarSetter must be used within a Button Bar Context')
34	  }
35	  return context
36	}
37
38	export { ButtonBarProvider, useButtons, useButtonToolbarSetter }
39	

Based on my thorough examination of this HospitalRun frontend codebase, I can now give you a comprehensive answer about the client-side error handling and architectural patterns.

## Error Handling Patterns

The codebase implements a **multi-layered error handling strategy** that combines several complementary approaches:

### 1. Custom Validation Error Classes
The codebase uses domain-specific error classes that extend the native `Error` class. Each major entity has its own validation error type:

- `PatientValidationError` with a `fieldErrors` object containing field-specific error keys
- `IncidentError`, `LabError`, `AppointmentError`, `CareGoalError`, `ImagingRequestError`, etc.

These error classes carry structured field-level error information (not just a message), and the error properties are i18n translation keys like `'patient.errors.patientGivenNameFeedback'`.

### 2. Validation Functions in `/util` Directories
Each feature module has a `util` directory with dedicated validation functions (e.g., `validate-patient.ts`, `validate-caregoal.ts`). These validators perform synchronous validation before any API calls, checking required fields, business rules like dates (e.g., due date must be after start date), and format validation using the `validator` library for emails and phone numbers.

### 3. React Query Mutations with `throwOnError: true`
For data mutations, the codebase uses React Query's `useMutation` hook configured with `throwOnError: true`. This allows errors from validation or API calls to propagate to the component level where they can be caught in try/catch blocks and stored in local state.

### 4. Component-Level Error State
Components maintain error state using `useState` hooks. When a mutation fails, the error is caught and stored, then passed down to form components. Form inputs receive `isInvalid` and `feedback` props that display field-level validation messages.

### 5. Redux Slices for Complex State
For more complex flows (like patient CRUD), Redux Toolkit slices manage error state with dedicated error actions like `createPatientError`, `updatePatientError`, and `addDiagnosisError`. The slice state tracks both the operation status (`'loading' | 'error' | 'completed'`) and specific error details.

### 6. User Feedback Mechanisms
- **Alert components**: Banner-style alerts at the top of forms for general error messages
- **Toast notifications**: For success messages and some error cases, using the `@hospitalrun/components` Toast component
- **Inline field feedback**: Input components display translated error messages directly below the field

### 7. Network Status Handling
A dedicated `NetworkStatusMessage` component with a `useNetworkStatus` hook listens for browser online/offline events and displays a colored banner to inform users of connectivity issues.

## Architectural Design Patterns

### 1. Feature-Based Module Structure
The codebase is organized by domain feature (patients, labs, medications, incidents, scheduling, imagings) rather than by technical layer. Each feature contains its own components, hooks, utilities, and models.

### 2. Repository Pattern
A base `Repository` class in `shared/db/Repository.ts` provides a generic data access layer over PouchDB. Specific repositories like `PatientRepository`, `LabRepository`, and `IncidentRepository` extend this base, providing type-safe CRUD operations.

### 3. Custom Hooks for Data Fetching and Mutations
The codebase extensively uses custom hooks following naming conventions:
- `usePatient`, `useLab`, `useIncident` for fetching single entities
- `usePatients`, `useLabs`, `useIncidents` for fetching collections
- `useAddCareGoal`, `useRequestLab`, `useScheduleAppointment` for mutations

These hooks wrap React Query's `useQuery` and `useMutation`, encapsulating caching logic and query invalidation.

### 4. Presentational/Container Separation
Form components like `CareGoalForm` and `GeneralInformation` are presentational, receiving data and error props and calling `onChange` handlers. Container components like `AddCareGoalModal` or `NewPatient` manage state, call mutations, and handle errors.

### 5. Redux Toolkit for Global State
Redux is used selectively for user authentication/permissions, breadcrumbs, UI component state, and some legacy patient operations. Most data fetching has migrated to React Query.

### 6. Context API for Cross-Cutting Concerns
React Context is used for the page title (`TitleContext`) and button toolbar (`ButtonBarProvider`), allowing deep components to update header elements without prop drilling.

### 7. Internationalization (i18n)
All user-facing strings, including error messages, are i18n keys translated at render time using the `useTranslator` hook. The locale files are organized by feature module.

### 8. Shared Component Library
The codebase relies on `@hospitalrun/components` for UI primitives (Button, Alert, Modal, Toast, Spinner, etc.) and wraps these in application-specific input components in `shared/components/input`.



3. Here is model b’s response: 
bash
command
find /tmp/inputs/hospitalrun-frontend -type f -name "*.ts" -o -name "*.tsx" | head -50
output
/tmp/inputs/hospitalrun-frontend/src/index.tsx
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
/tmp/inputs/hospitalrun-frontend/src/custom-pouchdb.d.ts
/tmp/inputs/hospitalrun-frontend/src/react-app-env.d.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/Incidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/IncidentFilter.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/model/IncidentSearchRequest.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/Imagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/model/ImagingSearchRequest.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ImagingRequestTable.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ViewImagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/useAddBreadcrumbs.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/Breadcrumbs.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/breadcrumbs-slice.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonToolBar.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/App.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/HospitalRun.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/Incidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/report/ReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/view/ViewIncidentDetails.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/view/ViewIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/list/ViewIncidentsTable.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/list/ViewIncidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useResolvedIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useIncidents.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/util/validate-incident.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/Imagings.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/hooks/useRequestImaging.test.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend, excluding hidden items and node_modules:
113M	/tmp/inputs/hospitalrun-frontend
79K	/tmp/inputs/hospitalrun-frontend/CHANGELOG.md
1.5K	/tmp/inputs/hospitalrun-frontend/LICENSE
3.0K	/tmp/inputs/hospitalrun-frontend/README.md
1.5K	/tmp/inputs/hospitalrun-frontend/SECURITY.md
3.0K	/tmp/inputs/hospitalrun-frontend/azure.yaml
512	/tmp/inputs/hospitalrun-frontend/commitlint.config.js
3.0K	/tmp/inputs/hospitalrun-frontend/couchdb
512	/tmp/inputs/hospitalrun-frontend/couchdb/Dockerfile
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-cleanup.bat
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-cleanup.sh
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-init.bat
512	/tmp/inputs/hospitalrun-frontend/couchdb/couchdb-init.sh
512	/tmp/inputs/hospitalrun-frontend/couchdb/local.ini
1.5K	/tmp/inputs/hospitalrun-frontend/docker-compose.yml
512	/tmp/inputs/hospitalrun-frontend/docs
512	/tmp/inputs/hospitalrun-frontend/docs/index.md
512	/tmp/inputs/hospitalrun-frontend/jest.config.js
512	/tmp/inputs/hospitalrun-frontend/mkdocs.yml
512	/tmp/inputs/hospitalrun-frontend/nginx.conf
5.5K	/tmp/inputs/hospitalrun-frontend/package.json
20K	/tmp/inputs/hospitalrun-frontend/public
1.5K	/tmp/inputs/hospitalrun-frontend/public/favicon.ico
2.0K	/tmp/inputs/hospitalrun-frontend/public/index.html
16K	/tmp/inputs/hospitalrun-frontend/public/logo.png
512	/tmp/inputs/hospitalrun-frontend/public/manifest.json
512	/tmp/inputs/hospitalrun-frontend/public/robots.txt
3.5K	/tmp/inputs/hospitalrun-frontend/scripts
2.5K	/tmp/inputs/hospitalrun-frontend/scripts/check-translations
512	/tmp/inputs/hospitalrun-frontend/scripts/tsconfig.json
1.2M	/tmp/inputs/hospitalrun-frontend/src
2.0K	/tmp/inputs/hospitalrun-frontend/src/App.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/__mocks__
564K	/tmp/inputs/hospitalrun-frontend/src/__tests__
1.5K	/tmp/inputs/hospitalrun-frontend/src/custom-pouchdb.d.ts
512	/tmp/inputs/hospitalrun-frontend/src/dashboard
17K	/tmp/inputs/hospitalrun-frontend/src/imagings
29K	/tmp/inputs/hospitalrun-frontend/src/incidents
2.0K	/tmp/inputs/hospitalrun-frontend/src/index.css
1.0K	/tmp/inputs/hospitalrun-frontend/src/index.tsx
28K	/tmp/inputs/hospitalrun-frontend/src/labs
36K	/tmp/inputs/hospitalrun-frontend/src/medications
6.5K	/tmp/inputs/hospitalrun-frontend/src/page-header
192K	/tmp/inputs/hospitalrun-frontend/src/patients
512	/tmp/inputs/hospitalrun-frontend/src/react-app-env.d.ts
30K	/tmp/inputs/hospitalrun-frontend/src/scheduling
5.5K	/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/settings
1.0K	/tmp/inputs/hospitalrun-frontend/src/setupTests.js
254K	/tmp/inputs/hospitalrun-frontend/src/shared
4.0K	/tmp/inputs/hospitalrun-frontend/src/user
1.0K	/tmp/inputs/hospitalrun-frontend/tsconfig.json



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/shared, excluding hidden items and node_modules:
254K	/tmp/inputs/hospitalrun-frontend/src/shared
38K	/tmp/inputs/hospitalrun-frontend/src/shared/components
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/PageComponent.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/PrivateRoute.tsx
15K	/tmp/inputs/hospitalrun-frontend/src/shared/components/Sidebar.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/component-slice.ts
8.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input
7.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/navbar
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/config
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/config/i18n.ts
2.5K	/tmp/inputs/hospitalrun-frontend/src/shared/config/pouchdb.ts
15K	/tmp/inputs/hospitalrun-frontend/src/shared/db
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/AppointmentRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/ImagingRepository.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/db/IncidentRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/LabRepository.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/MedicationRepository.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Page.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/PageRequest.ts
2.0K	/tmp/inputs/hospitalrun-frontend/src/shared/db/PatientRepository.ts
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Search.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/Sort.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/db/SortRequest.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/hooks
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useDebounce.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useTranslator.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/hooks/useUpdateEffect.ts
151K	/tmp/inputs/hospitalrun-frontend/src/shared/locales
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/README.md
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ar
15K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/de
21K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/es
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/id
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/index.ts
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/it
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ja
12K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr
27K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru
22K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr
5.5K	/tmp/inputs/hospitalrun-frontend/src/shared/locales/zhCN
13K	/tmp/inputs/hospitalrun-frontend/src/shared/model
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/AbstractDBModel.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Allergy.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Appointment.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Breadcrumb.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/CareGoal.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/CarePlan.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/ContactInformation.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Diagnosis.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Imaging.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Incident.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Lab.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Medication.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Name.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Note.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Patient.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/PatientHistoryRecord.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/model/Permissions.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/RelatedPerson.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/User.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/model/Visit.ts
29K	/tmp/inputs/hospitalrun-frontend/src/shared/static
29K	/tmp/inputs/hospitalrun-frontend/src/shared/static/images
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/store
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts
3.0K	/tmp/inputs/hospitalrun-frontend/src/shared/util
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/util/DataHelpers.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/extractUsername.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/formatDate.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/generateCode.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/util/uuid.ts



bash
command
grep -r "error" /tmp/inputs/hospitalrun-frontend/src --include="*.ts" --include="*.tsx" -l | head -30
output
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/report/ReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/hooks/useReportIncident.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/incidents/util/validate-incident.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/Imagings.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/hooks/useRequestImaging.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/requests/NewImagingRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/imagings/util/validate-imaging-request.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/user/user-slice.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/hooks/useScheduleAppointment.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/appointments/AppointmentDetailForm.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/scheduling/appointments/new/NewAppointment.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/ViewMedication.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/Medications.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/medication-slice.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/medications/requests/NewMedicationRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/test-utils/console.utils.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/ViewLab.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/hooks/useRequestLab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/hooks/useCompleteLab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/requests/NewLabRequest.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/labs/utils/validate-lab.test.ts
/tmp/inputs/hospitalrun-frontend/src/__tests__/patients/ContactInfo.test.tsx
/tmp/inputs/hospitalrun-frontend/src/__tests__/patients/GeneralInformation.test.tsx


bash
command
grep -r "Error" /tmp/inputs/hospitalrun-frontend/src --include="*.ts" --include="*.tsx" -l | grep -v "__tests__" | head -30
output
/tmp/inputs/hospitalrun-frontend/src/serviceWorker.ts
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
/tmp/inputs/hospitalrun-frontend/src/shared/locales/zhCN/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/tr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/states/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/es/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/fr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/id/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/de/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ar/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ptBr/translations/medications/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/patient/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/scheduling/index.ts
/tmp/inputs/hospitalrun-frontend/src/shared/locales/ru/translations/medications/index.ts


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3	import shortid from 'shortid'
4
5	import IncidentRepository from '../../shared/db/IncidentRepository'
6	import Incident from '../../shared/model/Incident'
7	import validateIncident from '../util/validate-incident'
8
9	const getIncidentCode = (): string => `I-${shortid.generate()}`
10
11	export function reportIncident(incident: Incident): Promise<Incident> {
12	  const error = validateIncident(incident)
13	  if (isEmpty(error)) {
14	    const updatedIncident: Incident = {
15	      ...incident,
16	      code: getIncidentCode(),
17	      status: 'reported',
18	      reportedBy: 'some user',
19	      reportedOn: new Date(Date.now()).toISOString(),
20	    }
21	    return IncidentRepository.save(updatedIncident)
22	  }
23
24	  throw error
25	}
26
27	export default function useReportIncident() {
28	  return useMutation(reportIncident, {
29	    onSuccess: async () => {
30	      await queryCache.invalidateQueries('incidents')
31	    },
32	    throwOnError: true,
33	  })
34	}
35	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts with line numbers:
1	import isAfter from 'date-fns/isAfter'
2
3	import Incident from '../../shared/model/Incident'
4
5	export class IncidentError extends Error {
6	  date?: string
7
8	  department?: string
9
10	  category?: string
11
12	  categoryItem?: string
13
14	  description?: string
15
16	  constructor(
17	    message: string,
18	    date: string,
19	    department: string,
20	    category: string,
21	    categoryItem: string,
22	    description: string,
23	  ) {
24	    super(message)
25	    this.date = date
26	    this.department = department
27	    this.category = category
28	    this.categoryItem = categoryItem
29	    this.description = description
30	    Object.setPrototypeOf(this, IncidentError.prototype)
31	  }
32	}
33
34	export default function validateIncident(incident: Incident): IncidentError {
35	  const newError: any = {}
36
37	  if (!incident.date) {
38	    newError.date = 'incidents.reports.error.dateRequired'
39	  } else if (isAfter(new Date(incident.date), new Date(Date.now()))) {
40	    newError.date = 'incidents.reports.error.dateMustBeInThePast'
41	  }
42
43	  if (!incident.department) {
44	    newError.department = 'incidents.reports.error.departmentRequired'
45	  }
46
47	  if (!incident.category) {
48	    newError.category = 'incidents.reports.error.categoryRequired'
49	  }
50
51	  if (!incident.categoryItem) {
52	    newError.categoryItem = 'incidents.reports.error.categoryItemRequired'
53	  }
54
55	  if (!incident.description) {
56	    newError.description = 'incidents.reports.error.descriptionRequired'
57	  }
58
59	  return newError as IncidentError
60	}
61	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx with line numbers:
1	import { Button, Row, Column, Typeahead, Label } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3	import { useHistory } from 'react-router-dom'
4
5	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
6	import { useUpdateTitle } from '../../page-header/title/TitleContext'
7	import DateTimePickerWithLabelFormGroup from '../../shared/components/input/DateTimePickerWithLabelFormGroup'
8	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
9	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
10	import PatientRepository from '../../shared/db/PatientRepository'
11	import useTranslator from '../../shared/hooks/useTranslator'
12	import Incident from '../../shared/model/Incident'
13	import Patient from '../../shared/model/Patient'
14	import useReportIncident from '../hooks/useReportIncident'
15	import { IncidentError } from '../util/validate-incident'
16
17	const ReportIncident = () => {
18	  const [mutate] = useReportIncident()
19	  const history = useHistory()
20	  const { t } = useTranslator()
21	  const updateTitle = useUpdateTitle()
22	  useEffect(() => {
23	    updateTitle(t('incidents.reports.new'))
24	  })
25	  const breadcrumbs = [
26	    {
27	      i18nKey: 'incidents.reports.new',
28	      location: `/incidents/new`,
29	    },
30	  ]
31	  useAddBreadcrumbs(breadcrumbs)
32	  const [incident, setIncident] = useState({
33	    date: new Date().toISOString(),
34	    department: '',
35	    category: '',
36	    categoryItem: '',
37	    description: '',
38	    patient: '',
39	  })
40
41	  const [error, setError] = useState<IncidentError | undefined>(undefined)
42
43	  const onDateChange = (newDate: Date) => {
44	    setIncident((prevState) => ({
45	      ...prevState,
46	      date: newDate.toISOString(),
47	    }))
48	  }
49
50	  const onTextInputChange = (text: string, name: string) => {
51	    setIncident((prevState) => ({
52	      ...prevState,
53	      [name]: text,
54	    }))
55	  }
56
57	  const onSave = async () => {
58	    try {
59	      const data = await mutate(incident as Incident)
60	      history.push(`/incidents/${data?.id}`)
61	    } catch (e) {
62	      setError(e)
63	    }
64	  }
65
66	  const onCancel = () => {
67	    history.push('/incidents')
68	  }
69
70	  const onPatientChange = (patient: Patient) => {
71	    if (patient) {
72	      setIncident((prevIncident) => ({
73	        ...prevIncident,
74	        patient: patient.id,
75	      }))
76	    } else {
77	      setIncident((prevIncident) => ({
78	        ...prevIncident,
79	        patient: '',
80	      }))
81	    }
82	  }
83
84	  return (
85	    <form aria-label="Report Incident form">
86	      <Row>
87	        <Column md={6}>
88	          <DateTimePickerWithLabelFormGroup
89	            name="dateOfIncident"
90	            label={t('incidents.reports.dateOfIncident')}
91	            isEditable
92	            isRequired
93	            onChange={onDateChange}
94	            value={new Date(incident.date)}
95	            isInvalid={!!error?.date}
96	            feedback={t(error?.date as string)}
97	          />
98	        </Column>
99	        <Column md={6}>
100	          <TextInputWithLabelFormGroup
101	            label={t('incidents.reports.department')}
102	            name="department"
103	            isRequired
104	            isEditable
105	            value={incident.department}
106	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'department')}
107	            isInvalid={!!error?.department}
108	            feedback={t(error?.department as string)}
109	          />
110	        </Column>
111	      </Row>
112	      <Row>
113	        <Column md={6}>
114	          <TextInputWithLabelFormGroup
115	            name="category"
116	            label={t('incidents.reports.category')}
117	            isEditable
118	            isRequired
119	            value={incident.category}
120	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'category')}
121	            isInvalid={!!error?.category}
122	            feedback={t(error?.category as string)}
123	          />
124	        </Column>
125	        <Column md={6}>
126	          <TextInputWithLabelFormGroup
127	            label={t('incidents.reports.categoryItem')}
128	            name="categoryItem"
129	            isRequired
130	            isEditable
131	            value={incident.categoryItem}
132	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'categoryItem')}
133	            isInvalid={!!error?.categoryItem}
134	            feedback={t(error?.categoryItem as string)}
135	          />
136	        </Column>
137	      </Row>
138	      <Row>
139	        <Column md={12}>
140	          <TextFieldWithLabelFormGroup
141	            label={t('incidents.reports.description')}
142	            name="description"
143	            isRequired
144	            isEditable
145	            value={incident.description}
146	            onChange={(event) => onTextInputChange(event.currentTarget.value, 'description')}
147	            isInvalid={!!error?.description}
148	            feedback={t(error?.description as string)}
149	          />
150	        </Column>
151	      </Row>
152	      <Row>
153	        <Column md={6}>
154	          <div className="form-group patient-typeahead">
155	            <Label htmlFor="patientTypeahead" text={t('incidents.reports.patient')} />
156	            <Typeahead
157	              id="patientTypeahead"
158	              placeholder={t('incidents.reports.patient')}
159	              onChange={(p: Patient[]) => onPatientChange(p[0])}
160	              onSearch={async (query: string) => PatientRepository.search(query)}
161	              searchAccessor="fullName"
162	              renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
163	            />
164	          </div>
165	        </Column>
166	      </Row>
167
168	      <div className="row float-right">
169	        <div className="btn-group btn-group-lg mt-3 mr-3">
170	          <Button className="mr-2" color="success" onClick={onSave}>
171	            {t('incidents.reports.new')}
172	          </Button>
173	          <Button color="danger" onClick={onCancel}>
174	            {t('actions.cancel')}
175	          </Button>
176	        </div>
177	      </div>
178	    </form>
179	  )
180	}
181
182	export default ReportIncident
183	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts with line numbers:
1	import Imaging from '../../shared/model/Imaging'
2
3	const statusType: string[] = ['requested', 'completed', 'canceled']
4
5	export class ImagingRequestError extends Error {
6	  patient?: string
7
8	  type?: string
9
10	  status?: string
11
12	  constructor(message: string, patient?: string, type?: string, status?: string) {
13	    super(message)
14	    this.patient = patient
15	    this.type = type
16	    this.status = status
17	    Object.setPrototypeOf(this, ImagingRequestError.prototype)
18	  }
19	}
20
21	export default function validateImagingRequest(request: Partial<Imaging>) {
22	  const imagingRequestError = {} as any
23	  if (!request.patient) {
24	    imagingRequestError.patient = 'imagings.requests.error.patientRequired'
25	  }
26
27	  if (!request.type) {
28	    imagingRequestError.type = 'imagings.requests.error.typeRequired'
29	  }
30
31	  if (!request.status) {
32	    imagingRequestError.status = 'imagings.requests.error.statusRequired'
33	  } else if (!statusType.includes(request.status)) {
34	    imagingRequestError.status = 'imagings.requests.error.incorrectStatus'
35	  }
36
37	  return imagingRequestError
38	}
39	


bash
command
find /tmp/inputs/hospitalrun-frontend/src -name "validate*.ts" | grep -v "__tests__"
output
/tmp/inputs/hospitalrun-frontend/src/incidents/util/validate-incident.ts
/tmp/inputs/hospitalrun-frontend/src/imagings/util/validate-imaging-request.ts
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts
/tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-diagnosis.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-related-person.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-note.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-visit.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-careplan.ts


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts with line numbers:
1	import isAfter from 'date-fns/isAfter'
2	import parseISO from 'date-fns/parseISO'
3	import validator from 'validator'
4
5	import { ContactInfoPiece } from '../../shared/model/ContactInformation'
6	import Patient from '../../shared/model/Patient'
7
8	const validateEmails = (emails: ContactInfoPiece[] | undefined) =>
9	  (emails ?? []).map((email) =>
10	    !validator.isEmail(email.value) ? 'patient.errors.invalidEmail' : undefined,
11	  )
12
13	const validatePhoneNumbers = (phoneNumbers: ContactInfoPiece[] | undefined) =>
14	  (phoneNumbers ?? []).map((phone) =>
15	    !validator.isMobilePhone(phone.value) ? 'patient.errors.invalidPhoneNumber' : undefined,
16	  )
17
18	const existAndIsAfterToday = (value: string | undefined) => {
19	  if (!value) {
20	    return false
21	  }
22
23	  const today = new Date(Date.now())
24	  const dateOfBirth = parseISO(value)
25
26	  return isAfter(dateOfBirth, today)
27	}
28
29	const existAndHasNumbers = (value: string | undefined) => value && /\d/.test(value)
30
31	interface IPatientFieldErrors {
32	  givenName?: 'patient.errors.patientGivenNameFeedback'
33	  dateOfBirth?: 'patient.errors.patientDateOfBirthFeedback'
34	  suffix?: 'patient.errors.patientNumInSuffixFeedback'
35	  prefix?: 'patient.errors.patientNumInPrefixFeedback'
36	  familyName?: 'patient.errors.patientNumInFamilyNameFeedback'
37	  preferredLanguage?: 'patient.errors.patientNumInPreferredLanguageFeedback'
38	  emails?: ('patient.errors.invalidEmail' | undefined)[]
39	  phoneNumbers?: ('patient.errors.invalidPhoneNumber' | undefined)[]
40	}
41
42	export class PatientValidationError extends Error {
43	  public fieldErrors: IPatientFieldErrors
44
45	  constructor() {
46	    super('Patient data is invalid.')
47	    this.name = 'PatientValidationError'
48	    this.fieldErrors = {}
49	  }
50
51	  get count(): number {
52	    return Object.keys(this.fieldErrors).length
53	  }
54	}
55
56	export default function validatePatient(patient: Patient) {
57	  const error = new PatientValidationError()
58
59	  if (!patient.givenName) {
60	    error.fieldErrors.givenName = 'patient.errors.patientGivenNameFeedback'
61	  }
62
63	  if (existAndIsAfterToday(patient.dateOfBirth)) {
64	    error.fieldErrors.dateOfBirth = 'patient.errors.patientDateOfBirthFeedback'
65	  }
66
67	  if (existAndHasNumbers(patient.suffix)) {
68	    error.fieldErrors.suffix = 'patient.errors.patientNumInSuffixFeedback'
69	  }
70
71	  if (existAndHasNumbers(patient.prefix)) {
72	    error.fieldErrors.prefix = 'patient.errors.patientNumInPrefixFeedback'
73	  }
74
75	  if (existAndHasNumbers(patient.familyName)) {
76	    error.fieldErrors.familyName = 'patient.errors.patientNumInFamilyNameFeedback'
77	  }
78
79	  if (existAndHasNumbers(patient.preferredLanguage)) {
80	    error.fieldErrors.preferredLanguage = 'patient.errors.patientNumInPreferredLanguageFeedback'
81	  }
82
83	  const emailsErrors = validateEmails(patient.emails)
84	  const phoneNumbersErrors = validatePhoneNumbers(patient.phoneNumbers)
85
86	  if (emailsErrors.some(Boolean)) {
87	    error.fieldErrors.emails = emailsErrors
88	  }
89
90	  if (phoneNumbersErrors.some(Boolean)) {
91	    error.fieldErrors.phoneNumbers = phoneNumbersErrors
92	  }
93
94	  if (error.count === 0) {
95	    return null
96	  }
97
98	  return error
99	}
100	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/utils/validate-lab.ts with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2
3	import Lab from '../../shared/model/Lab'
4
5	export class LabError extends Error {
6	  message: string
7
8	  result?: string
9
10	  patient?: string
11
12	  type?: string
13
14	  constructor(message: string, result: string, patient: string, type: string) {
15	    super(message)
16	    this.message = message
17	    this.result = result
18	    this.patient = patient
19	    this.type = type
20	  }
21	}
22
23	export function validateLabRequest(lab: Partial<Lab>): LabError {
24	  const labError = {} as LabError
25
26	  if (!lab.patient) {
27	    labError.patient = 'labs.requests.error.patientRequired'
28	  }
29
30	  if (!lab.type) {
31	    labError.type = 'labs.requests.error.typeRequired'
32	  }
33
34	  if (!isEmpty(labError)) {
35	    labError.message = 'labs.requests.error.unableToRequest'
36	  }
37	  return labError
38	}
39
40	export function validateLabComplete(lab: Partial<Lab>): LabError {
41	  const labError = {} as LabError
42
43	  if (!lab.result) {
44	    labError.result = 'labs.requests.error.resultRequiredToComplete'
45	    labError.message = 'labs.requests.error.unableToComplete'
46	  }
47
48	  return labError
49	}
50	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/util/validate-appointment.ts with line numbers:
1	import isBefore from 'date-fns/isBefore'
2
3	import Appointment from '../../../shared/model/Appointment'
4
5	export class AppointmentError extends Error {
6	  patient?: string
7
8	  startDateTime?: string
9
10	  constructor(patient: string, startDateTime: string, message: string) {
11	    super(message)
12	    this.patient = patient
13	    this.startDateTime = startDateTime
14	    Object.setPrototypeOf(this, AppointmentError.prototype)
15	  }
16	}
17
18	export default function validateAppointment(appointment: Appointment): AppointmentError {
19	  const newError: any = {}
20
21	  if (!appointment.patient) {
22	    newError.patient = 'scheduling.appointment.errors.patientRequired'
23	  }
24	  if (isBefore(new Date(appointment.endDateTime), new Date(appointment.startDateTime))) {
25	    newError.startDateTime = 'scheduling.appointment.errors.startDateMustBeBeforeEndDate'
26	  }
27
28	  return newError as AppointmentError
29	}
30	

Now let me look at how the hooks use these validation errors:

bash
command
find /tmp/inputs/hospitalrun-frontend/src -name "*.tsx" -path "*/hooks/*" | grep -v "__tests__" | head -15
output
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointments.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useDeleteAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/hooks/useMedicationSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useRemovePatientRelatedPerson.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx with line numbers:
1	import { MutateFunction, queryCache, useMutation } from 'react-query'
2
3	import AppointmentRepository from '../../shared/db/AppointmentRepository'
4	import Appointment from '../../shared/model/Appointment'
5	import validateAppointment, { AppointmentError } from '../appointments/util/validate-appointment'
6
7	interface newAppointmentResult {
8	  mutate: MutateFunction<Appointment, unknown, Appointment, unknown>
9	  isLoading: boolean
10	  isError: boolean
11	  validator(appointment: Appointment): AppointmentError
12	}
13
14	async function createNewAppointment(appointment: Appointment): Promise<Appointment> {
15	  return AppointmentRepository.save(appointment)
16	}
17
18	function validateCreateAppointment(appointment: Appointment): AppointmentError {
19	  return validateAppointment(appointment)
20	}
21
22	export default function useScheduleAppointment(): newAppointmentResult {
23	  const [mutate, { isLoading, isError }] = useMutation(createNewAppointment, {
24	    onSuccess: async () => {
25	      await queryCache.invalidateQueries('appointment')
26	    },
27	    throwOnError: true,
28	  })
29	  const result: newAppointmentResult = {
30	    mutate,
31	    isLoading,
32	    isError,
33	    validator: validateCreateAppointment,
34	  }
35	  return result
36	}
37	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3
4	import ImagingRepository from '../../shared/db/ImagingRepository'
5	import Imaging from '../../shared/model/Imaging'
6	import validateImagingRequest from '../util/validate-imaging-request'
7
8	export interface ImagingRequest {
9	  status: 'completed' | 'requested' | 'canceled'
10	  patient: string
11	  visitId: string
12	  fullName: string
13	  notes?: string
14	  type: string
15	}
16
17	function requestImagingWrapper(user: any) {
18	  return async function requestImaging(request: ImagingRequest): Promise<void> {
19	    const error = validateImagingRequest(request)
20
21	    if (!isEmpty(error)) {
22	      throw error
23	    }
24
25	    await ImagingRepository.save({
26	      ...request,
27	      requestedBy: user?.id || '',
28	      requestedByFullName: user?.fullName || '',
29	      requestedOn: new Date(Date.now()).toISOString(),
30	    } as Imaging)
31	  }
32	}
33
34	export default function useRequestImaging(user: any) {
35	  return useMutation(requestImagingWrapper(user), {
36	    onSuccess: async () => {
37	      await queryCache.invalidateQueries('imagings')
38	    },
39	    throwOnError: true,
40	  })
41	}
42	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx with line numbers:
1	import { Select, Typeahead, Label, Button, Alert, Column, Row } from '@hospitalrun/components'
2	import format from 'date-fns/format'
3	import React, { useState, useEffect } from 'react'
4	import { useSelector } from 'react-redux'
5	import { useHistory } from 'react-router-dom'
6
7	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
8	import { useUpdateTitle } from '../../page-header/title/TitleContext'
9	import { SelectOption } from '../../shared/components/input/SelectOption'
10	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
11	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
12	import PatientRepository from '../../shared/db/PatientRepository'
13	import useTranslator from '../../shared/hooks/useTranslator'
14	import Patient from '../../shared/model/Patient'
15	import { RootState } from '../../shared/store'
16	import useRequestImaging, { ImagingRequest } from '../hooks/useRequestImaging'
17	import { ImagingRequestError } from '../util/validate-imaging-request'
18
19	const NewImagingRequest = () => {
20	  const { t } = useTranslator()
21	  const history = useHistory()
22	  const { user } = useSelector((state: RootState) => state.user)
23
24	  const updateTitle = useUpdateTitle()
25	  useEffect(() => {
26	    updateTitle(t('imagings.requests.new'))
27	  })
28	  const [mutate] = useRequestImaging(user)
29	  const [error, setError] = useState<ImagingRequestError>()
30	  const [visitOption, setVisitOption] = useState([] as SelectOption[])
31
32	  const statusOptions: SelectOption[] = [
33	    { label: t('imagings.status.requested'), value: 'requested' },
34	    { label: t('imagings.status.completed'), value: 'completed' },
35	    { label: t('imagings.status.canceled'), value: 'canceled' },
36	  ]
37
38	  const [newImagingRequest, setNewImagingRequest] = useState<ImagingRequest>({
39	    patient: '',
40	    fullName: '',
41	    status: 'requested',
42	    notes: '',
43	    type: '',
44	    visitId: '',
45	  })
46
47	  const breadcrumbs = [
48	    {
49	      i18nKey: 'imagings.requests.new',
50	      location: `/imaging/new`,
51	    },
52	  ]
53	  useAddBreadcrumbs(breadcrumbs)
54
55	  const onPatientChange = (patient: Patient) => {
56	    if (patient) {
57	      setNewImagingRequest((previousNewImagingRequest) => ({
58	        ...previousNewImagingRequest,
59	        patient: patient.id,
60	        fullName: patient.fullName as string,
61	      }))
62
63	      const visits = patient.visits?.map((v) => ({
64	        label: `${v.type} at ${format(new Date(v.startDateTime), 'yyyy-MM-dd hh:mm a')}`,
65	        value: v.id,
66	      })) as SelectOption[]
67
68	      setVisitOption(visits)
69	    } else {
70	      setNewImagingRequest((previousNewImagingRequest) => ({
71	        ...previousNewImagingRequest,
72	        patient: '',
73	        fullName: '',
74	        visitId: '',
75	      }))
76	      setVisitOption([])
77	    }
78	  }
79
80	  const onImagingTypeChange = (event: React.ChangeEvent<HTMLInputElement>) => {
81	    const type = event.currentTarget.value
82	    setNewImagingRequest((previousNewImagingRequest) => ({
83	      ...previousNewImagingRequest,
84	      type,
85	    }))
86	  }
87
88	  const onStatusChange = (value: string) => {
89	    setNewImagingRequest((previousNewImagingRequest) => ({
90	      ...previousNewImagingRequest,
91	      status: value as 'completed' | 'canceled' | 'requested',
92	    }))
93	  }
94
95	  const onVisitChange = (value: string) => {
96	    setNewImagingRequest((previousNewImagingRequest) => ({
97	      ...previousNewImagingRequest,
98	      visitId: value,
99	    }))
100	  }
101
102	  const onNoteChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
103	    const notes = event.currentTarget.value
104	    setNewImagingRequest((previousNewImagingRequest) => ({
105	      ...previousNewImagingRequest,
106	      notes,
107	    }))
108	  }
109
110	  const onSave = async () => {
111	    try {
112	      await mutate(newImagingRequest)
113	      history.push(`/imaging`)
114	    } catch (e) {
115	      setError(e)
116	    }
117	  }
118
119	  const onCancel = () => {
120	    history.push('/imaging')
121	  }
122
123	  const defaultSelectedVisitsOption = () => {
124	    if (visitOption !== undefined) {
125	      return visitOption.filter(({ value }) => value === newImagingRequest.visitId)
126	    }
127	    return []
128	  }
129
130	  return (
131	    <>
132	      {error !== undefined && (
133	        <Alert color="danger" title={t('states.error')} message={t(error.message)} />
134	      )}
135	      <form>
136	        <Row>
137	          <Column>
138	            <div className="form-group patient-typeahead">
139	              <Label htmlFor="patientTypeahead" isRequired text={t('imagings.imaging.patient')} />
140	              <Typeahead
141	                id="patientTypeahead"
142	                placeholder={t('imagings.imaging.patient')}
143	                onChange={(p: Patient[]) => {
144	                  onPatientChange(p[0])
145	                }}
146	                onSearch={async (query: string) => PatientRepository.search(query)}
147	                searchAccessor="fullName"
148	                renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
149	                isInvalid={!!error?.patient}
150	                feedback={t(error?.patient)}
151	              />
152	            </div>
153	          </Column>
154	          <Column>
155	            <div className="visits" data-testid="visitSelect">
156	              <Label text={t('patient.visits.label')} title="visit" isRequired />
157	              <Select
158	                id="visitSelect"
159	                options={visitOption || []}
160	                defaultSelected={defaultSelectedVisitsOption()}
161	                onChange={(values) => {
162	                  onVisitChange(values[0])
163	                }}
164	                disabled={false}
165	              />
166	            </div>
167	          </Column>
168	        </Row>
169
170	        <TextInputWithLabelFormGroup
171	          name="imagingType"
172	          label={t('imagings.imaging.type')}
173	          isRequired
174	          isEditable
175	          isInvalid={!!error?.type}
176	          feedback={t(error?.type)}
177	          value={newImagingRequest.type}
178	          onChange={onImagingTypeChange}
179	        />
180	        <div className="imaging-status" data-testid="statusSelect">
181	          <Label text={t('imagings.imaging.status')} title="status" isRequired />
182	          <Select
183	            id="statusSelect"
184	            options={statusOptions}
185	            defaultSelected={statusOptions.filter(
186	              ({ value }) => value === newImagingRequest.status,
187	            )}
188	            onChange={(values) => onStatusChange(values[0])}
189	            disabled={false}
190	          />
191	        </div>
192	        <div className="form-group">
193	          <TextFieldWithLabelFormGroup
194	            name="ImagingNotes"
195	            label={t('imagings.imaging.notes')}
196	            isEditable
197	            value={newImagingRequest.notes}
198	            onChange={onNoteChange}
199	          />
200	        </div>
201	        <div className="row float-right">
202	          <div className="btn-group btn-group-lg mt-3 mr-3">
203	            <Button className="mr-2" color="success" onClick={onSave}>
204	              {t('imagings.requests.create')}
205	            </Button>
206	            <Button color="danger" onClick={onCancel}>
207	              {t('actions.cancel')}
208	            </Button>
209	          </div>
210	        </div>
211	      </form>
212	    </>
213	  )
214	}
215
216	export default NewImagingRequest
217	


bash
command
grep -r "Toast\|toast\|Alert\|alert" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" -l | grep -v "__tests__" | head -20
output
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/AppointmentDetailForm.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/edit/EditAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/requests/NewMedicationRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/AllergiesList.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/RelatedPersonTab.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/history/HistoryTable.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/new/DuplicateNewPatientModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/notes/NotesList.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/notes/NewNoteModal.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx with line numbers:
1	import { Toaster } from '@hospitalrun/components'
2	import React from 'react'
3	import { useSelector } from 'react-redux'
4	import { Route, Switch } from 'react-router-dom'
5
6	import Dashboard from './dashboard/Dashboard'
7	import Imagings from './imagings/Imagings'
8	import Incidents from './incidents/Incidents'
9	import Labs from './labs/Labs'
10	import Medications from './medications/Medications'
11	import Breadcrumbs from './page-header/breadcrumbs/Breadcrumbs'
12	import { ButtonBarProvider } from './page-header/button-toolbar/ButtonBarProvider'
13	import ButtonToolBar from './page-header/button-toolbar/ButtonToolBar'
14	import { useTitle } from './page-header/title/TitleContext'
15	import Patients from './patients/Patients'
16	import Appointments from './scheduling/appointments/Appointments'
17	import Settings from './settings/Settings'
18	import Navbar from './shared/components/navbar/Navbar'
19	import { NetworkStatusMessage } from './shared/components/network-status'
20	import Sidebar from './shared/components/Sidebar'
21	import { RootState } from './shared/store'
22
23	const HospitalRun = () => {
24	  const { title } = useTitle()
25	  const { sidebarCollapsed } = useSelector((state: RootState) => state.components)
26
27	  return (
28	    <div>
29	      <NetworkStatusMessage />
30	      <Navbar />
31	      <div className="container-fluid">
32	        <div className="col-md-2">
33	          <Sidebar />
34	        </div>
35	        <ButtonBarProvider>
36	          <div className="row">
37	            <main
38	              role="main"
39	              className={`${
40	                sidebarCollapsed ? 'col-md-10 col-lg-11' : 'col-md-9 col-lg-10'
41	              } ml-sm-auto px-4`}
42	            >
43	              <div className="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
44	                <h1 className="h2">{title}</h1>
45	                <ButtonToolBar />
46	              </div>
47	              <Breadcrumbs />
48	              <div>
49	                <Switch>
50	                  <Route exact path="/" component={Dashboard} />
51	                  <Route path="/appointments" component={Appointments} />
52	                  <Route path="/patients" component={Patients} />
53	                  <Route path="/labs" component={Labs} />
54	                  <Route path="/medications" component={Medications} />
55	                  <Route path="/incidents" component={Incidents} />
56	                  <Route path="/settings" component={Settings} />
57	                  <Route path="/imaging" component={Imagings} />
58	                </Switch>
59	              </div>
60	              <Toaster autoClose={5000} hideProgressBar draggable />
61	            </main>
62	          </div>
63	        </ButtonBarProvider>
64	      </div>
65	    </div>
66	  )
67	}
68
69	export default HospitalRun
70	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx with line numbers:
1	import { Button, Toast } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3	import { useDispatch, useSelector } from 'react-redux'
4	import { useHistory } from 'react-router-dom'
5
6	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
7	import { useUpdateTitle } from '../../page-header/title/TitleContext'
8	import useTranslator from '../../shared/hooks/useTranslator'
9	import Patient from '../../shared/model/Patient'
10	import { RootState } from '../../shared/store'
11	import GeneralInformation from '../GeneralInformation'
12	import { createPatient } from '../patient-slice'
13	import { isPossibleDuplicatePatient } from '../util/is-possible-duplicate-patient'
14	import DuplicateNewPatientModal from './DuplicateNewPatientModal'
15
16	const breadcrumbs = [
17	  { i18nKey: 'patients.label', location: '/patients' },
18	  { i18nKey: 'patients.newPatient', location: '/patients/new' },
19	]
20
21	const NewPatient = () => {
22	  const { t } = useTranslator()
23	  const history = useHistory()
24	  const dispatch = useDispatch()
25	  const { createError } = useSelector((state: RootState) => state.patient)
26	  const { patients } = Object(useSelector((state: RootState) => state.patients))
27
28	  const [patient, setPatient] = useState({} as Patient)
29	  const [duplicatePatient, setDuplicatePatient] = useState<Patient | undefined>(undefined)
30	  const [showDuplicateNewPatientModal, setShowDuplicateNewPatientModal] = useState<boolean>(false)
31
32	  const testPatient = {
33	    givenName: 'Kelly',
34	    familyName: 'Clark',
35	    sex: 'female',
36	    dateOfBirth: '1963-01-09T05:00:00.000Z',
37	  } as Patient
38
39	  const updateTitle = useUpdateTitle()
40	  useEffect(() => {
41	    updateTitle(t('patients.newPatient'))
42	  })
43	  useAddBreadcrumbs(breadcrumbs, true)
44
45	  const onCancel = () => {
46	    history.push('/patients')
47	  }
48
49	  const onSuccessfulSave = (newPatient: Patient) => {
50	    history.push(`/patients/${newPatient.id}`)
51	    Toast(
52	      'success',
53	      t('states.success'),
54	      `${t('patients.successfullyCreated')} ${newPatient.fullName}`,
55	    )
56	  }
57
58	  const onSave = () => {
59	    let duplicatePatients = []
60	    if (patients !== undefined) {
61	      duplicatePatients = patients.filter((existingPatient: any) =>
62	        isPossibleDuplicatePatient(patient, existingPatient),
63	      )
64	    }
65
66	    if (duplicatePatients.length > 0) {
67	      setShowDuplicateNewPatientModal(true)
68	      setDuplicatePatient(duplicatePatients as Patient)
69	    } else {
70	      dispatch(createPatient(patient, onSuccessfulSave))
71	    }
72
73	    const testCase = [isPossibleDuplicatePatient(patient, testPatient)]
74	    if (testCase.length > 0) {
75	      return true
76	    }
77	    return false
78	  }
79
80	  const onPatientChange = (newPatient: Partial<Patient>) => {
81	    setPatient(newPatient as Patient)
82	  }
83
84	  const createDuplicateNewPatient = () => {
85	    dispatch(createPatient(patient, onSuccessfulSave))
86	  }
87
88	  const closeDuplicateNewPatientModal = () => {
89	    setShowDuplicateNewPatientModal(false)
90	  }
91
92	  return (
93	    <div>
94	      <GeneralInformation
95	        patient={patient}
96	        isEditable
97	        onChange={onPatientChange}
98	        error={createError}
99	      />
100	      <div className="row float-right">
101	        <div className="btn-group btn-group-lg mt-3 mr-3">
102	          <Button className="btn-save mr-2" color="success" onClick={onSave}>
103	            {t('patients.createPatient')}
104	          </Button>
105	          <Button className="btn-cancel" color="danger" onClick={onCancel}>
106	            {t('actions.cancel')}
107	          </Button>
108	        </div>
109	      </div>
110
111	      <DuplicateNewPatientModal
112	        duplicatePatient={duplicatePatient}
113	        show={showDuplicateNewPatientModal}
114	        toggle={closeDuplicateNewPatientModal}
115	        onContinueButtonClick={createDuplicateNewPatient}
116	        onCloseButtonClick={closeDuplicateNewPatientModal}
117	      />
118	    </div>
119	  )
120	}
121
122	export default NewPatient
123	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx with line numbers:
1	import { Select, Label, Panel, Checkbox, Alert } from '@hospitalrun/components'
2	import differenceInYears from 'date-fns/differenceInYears'
3	import startOfDay from 'date-fns/startOfDay'
4	import subYears from 'date-fns/subYears'
5	import React, { ReactElement } from 'react'
6
7	import DatePickerWithLabelFormGroup from '../shared/components/input/DatePickerWithLabelFormGroup'
8	import { SelectOption } from '../shared/components/input/SelectOption'
9	import TextInputWithLabelFormGroup from '../shared/components/input/TextInputWithLabelFormGroup'
10	import useTranslator from '../shared/hooks/useTranslator'
11	import { ContactInfoPiece } from '../shared/model/ContactInformation'
12	import Patient from '../shared/model/Patient'
13	import ContactInfo from './ContactInfo'
14
15	interface Error {
16	  message?: string
17	  prefix?: string
18	  givenName?: string
19	  familyName?: string
20	  suffix?: string
21	  dateOfBirth?: string
22	  preferredLanguage?: string
23	  phoneNumbers?: (string | undefined)[]
24	  emails?: (string | undefined)[]
25	}
26
27	interface Props {
28	  patient: Patient
29	  isEditable?: boolean
30	  onChange?: (newPatient: Partial<Patient>) => void
31	  error?: Error
32	}
33
34	const GeneralInformation = (props: Props): ReactElement => {
35	  const { t } = useTranslator()
36	  const { patient, isEditable, onChange, error } = props
37
38	  const onFieldChange = (name: string, value: string | boolean | ContactInfoPiece[]) => {
39	    if (onChange) {
40	      const newPatient = {
41	        ...patient,
42	        [name]: value,
43	      }
44	      onChange(newPatient)
45	    }
46	  }
47
48	  const guessDateOfBirthFromApproximateAge = (value: string) => {
49	    const age = Number.isNaN(parseFloat(value)) ? 0 : parseFloat(value)
50	    const dateOfBirth = subYears(new Date(Date.now()), age)
51	    return startOfDay(dateOfBirth).toISOString()
52	  }
53
54	  const onApproximateAgeChange = (event: React.ChangeEvent<HTMLInputElement>) => {
55	    const { value } = event.currentTarget
56	    onFieldChange('dateOfBirth', guessDateOfBirthFromApproximateAge(value))
57	  }
58
59	  const onUnknownDateOfBirthChange = (event: React.ChangeEvent<HTMLInputElement>) => {
60	    const { checked } = event.currentTarget
61	    onFieldChange('isApproximateDateOfBirth', checked)
62	  }
63
64	  const sexOptions: SelectOption[] = [
65	    { label: t('sex.male'), value: 'male' },
66	    { label: t('sex.female'), value: 'female' },
67	    { label: t('sex.other'), value: 'other' },
68	    { label: t('sex.unknown'), value: 'unknown' },
69	  ]
70
71	  const typeOptions: SelectOption[] = [
72	    { label: t('patient.types.charity'), value: 'charity' },
73	    { label: t('patient.types.private'), value: 'private' },
74	  ]
75
76	  const bloodTypeOptions: SelectOption[] = [
77	    { label: t('bloodType.apositive'), value: 'A+' },
78	    { label: t('bloodType.anegative'), value: 'A-' },
79	    { label: t('bloodType.abpositive'), value: 'AB+' },
80	    { label: t('bloodType.abnegative'), value: 'AB-' },
81	    { label: t('bloodType.bpositive'), value: 'B+' },
82	    { label: t('bloodType.bnegative'), value: 'B-' },
83	    { label: t('bloodType.opositive'), value: 'O+' },
84	    { label: t('bloodType.onegative'), value: 'O-' },
85	    { label: t('bloodType.unknown'), value: 'unknown' },
86	  ]
87
88	  return (
89	    <div>
90	      <Panel title={t('patient.basicInformation')} color="primary" collapsible>
91	        {error?.message && <Alert className="alert" color="danger" message={t(error?.message)} />}
92	        <div className="row">
93	          <div className="col-md-2">
94	            <TextInputWithLabelFormGroup
95	              label={t('patient.prefix')}
96	              name="prefix"
97	              value={patient.prefix}
98	              isEditable={isEditable}
99	              onChange={(event) => onFieldChange('prefix', event.currentTarget.value)}
100	              isInvalid={!!error?.prefix}
101	              feedback={t(error?.prefix)}
102	            />
103	          </div>
104	          <div className="col-md-4">
105	            <TextInputWithLabelFormGroup
106	              label={t('patient.givenName')}
107	              name="givenName"
108	              value={patient.givenName}
109	              isEditable={isEditable}
110	              onChange={(event) => onFieldChange('givenName', event.currentTarget.value)}
111	              isRequired
112	              isInvalid={!!error?.givenName}
113	              feedback={t(error?.givenName)}
114	            />
115	          </div>
116	          <div className="col-md-4">
117	            <TextInputWithLabelFormGroup
118	              label={t('patient.familyName')}
119	              name="familyName"
120	              value={patient.familyName}
121	              isEditable={isEditable}
122	              onChange={(event) => onFieldChange('familyName', event.currentTarget.value)}
123	              isInvalid={!!error?.familyName}
124	              feedback={t(error?.familyName)}
125	            />
126	          </div>
127	          <div className="col-md-2">
128	            <TextInputWithLabelFormGroup
129	              label={t('patient.suffix')}
130	              name="suffix"
131	              value={patient.suffix}
132	              isEditable={isEditable}
133	              onChange={(event) => onFieldChange('suffix', event.currentTarget.value)}
134	              isInvalid={!!error?.suffix}
135	              feedback={t(error?.suffix)}
136	            />
137	          </div>
138	        </div>
139	        <div className="row">
140	          <div className="col">
141	            <div className="form-group" data-testid="sexSelect">
142	              <Label text={t('patient.sex')} title="sex" />
143	              <Select
144	                id="sexSelect"
145	                options={sexOptions}
146	                defaultSelected={sexOptions.filter(({ value }) => value === patient.sex)}
147	                onChange={(values) => onFieldChange('sex', values[0])}
148	                disabled={!isEditable}
149	              />
150	            </div>
151	          </div>
152	          <div className="col">
153	            <div className="form-group" data-testid="typeSelect">
154	              <Label text={t('patient.type')} title="type" />
155	              <Select
156	                id="typeSelect"
157	                options={typeOptions}
158	                defaultSelected={typeOptions.filter(({ value }) => value === patient.type)}
159	                onChange={(values) => onFieldChange('type', values[0])}
160	                disabled={!isEditable}
161	              />
162	            </div>
163	          </div>
164	          <div className="col">
165	            <div className="form-group" data-testid="bloodTypeSelect">
166	              <Label text={t('patient.bloodType')} title="bloodType" />
167	              <Select
168	                id="bloodTypeSelect"
169	                options={bloodTypeOptions}
170	                defaultSelected={bloodTypeOptions.filter(
171	                  ({ value }) => value === patient.bloodType,
172	                )}
173	                onChange={(values) => onFieldChange('bloodType', values[0])}
174	                disabled={!isEditable}
175	              />
176	            </div>
177	          </div>
178	        </div>
179	        <div className="row">
180	          <div className="col-md-3">
181	            {patient.isApproximateDateOfBirth ? (
182	              <TextInputWithLabelFormGroup
183	                label={t('patient.approximateAge')}
184	                name="approximateAge"
185	                type="number"
186	                value={`${differenceInYears(new Date(Date.now()), new Date(patient.dateOfBirth))}`}
187	                isEditable={isEditable}
188	                onChange={onApproximateAgeChange}
189	              />
190	            ) : (
191	              <DatePickerWithLabelFormGroup
192	                name="dateOfBirth"
193	                label={t('patient.dateOfBirth')}
194	                isEditable={isEditable && !patient.isApproximateDateOfBirth}
195	                value={
196	                  patient.dateOfBirth && patient.dateOfBirth.length > 0
197	                    ? new Date(patient.dateOfBirth)
198	                    : undefined
199	                }
200	                maxDate={new Date(Date.now().valueOf())}
201	                onChange={(date: Date) => onFieldChange('dateOfBirth', date.toISOString())}
202	                isInvalid={!!error?.dateOfBirth}
203	                feedback={t(error?.dateOfBirth)}
204	              />
205	            )}
206	            <div className="form-group">
207	              <Checkbox
208	                label={t('patient.unknownDateOfBirth')}
209	                name="unknown"
210	                disabled={!isEditable}
211	                onChange={onUnknownDateOfBirthChange}
212	              />
213	            </div>
214	          </div>
215	          <div className="col">
216	            <TextInputWithLabelFormGroup
217	              label={t('patient.occupation')}
218	              name="occupation"
219	              value={patient.occupation}
220	              isEditable={isEditable}
221	              onChange={(event) => onFieldChange('occupation', event.currentTarget.value)}
222	            />
223	          </div>
224	          <div className="col">
225	            <TextInputWithLabelFormGroup
226	              label={t('patient.preferredLanguage')}
227	              name="preferredLanguage"
228	              value={patient.preferredLanguage}
229	              isEditable={isEditable}
230	              onChange={(event) => onFieldChange('preferredLanguage', event.currentTarget.value)}
231	              isInvalid={!!error?.preferredLanguage}
232	              feedback={t(error?.preferredLanguage)}
233	            />
234	          </div>
235	        </div>
236	      </Panel>
237	      <br />
238	      <Panel title={t('patient.contactInformation')} color="primary" collapsible>
239	        <div className="mb-4">
240	          <Panel title={t('patient.phoneNumber')} color="primary" collapsible>
241	            <ContactInfo
242	              component="TextInputWithLabelFormGroup"
243	              data={patient.phoneNumbers}
244	              errors={error?.phoneNumbers}
245	              label="patient.phoneNumber"
246	              name="phoneNumber"
247	              isEditable={isEditable}
248	              onChange={(newPhoneNumbers) => onFieldChange('phoneNumbers', newPhoneNumbers)}
249	            />
250	          </Panel>
251	        </div>
252	        <div className="mb-4">
253	          <Panel title={t('patient.email')} color="primary" collapsible>
254	            <ContactInfo
255	              component="TextInputWithLabelFormGroup"
256	              data={patient.emails}
257	              errors={error?.emails}
258	              label="patient.email"
259	              name="email"
260	              isEditable={isEditable}
261	              onChange={(newEmails) => onFieldChange('emails', newEmails)}
262	            />
263	          </Panel>
264	        </div>
265	        <div>
266	          <Panel title={t('patient.address')} color="primary" collapsible>
267	            <ContactInfo
268	              component="TextFieldWithLabelFormGroup"
269	              data={patient.addresses}
270	              label="patient.address"
271	              name="address"
272	              isEditable={isEditable}
273	              onChange={(newAddresses) => onFieldChange('addresses', newAddresses)}
274	            />
275	          </Panel>
276	        </div>
277	      </Panel>
278	    </div>
279	  )
280	}
281
282	export default GeneralInformation
283	


bash
command
find /tmp/inputs/hospitalrun-frontend/src -name "*slice*" | grep -v "__tests__"
output
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/breadcrumbs-slice.ts
/tmp/inputs/hospitalrun-frontend/src/shared/components/component-slice.ts
/tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts
/tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts
/tmp/inputs/hospitalrun-frontend/src/patients/patients-slice.ts
/tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts with line numbers:
1	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
2	import isEmpty from 'lodash/isEmpty'
3
4	import PatientRepository from '../shared/db/PatientRepository'
5	import Diagnosis from '../shared/model/Diagnosis'
6	import Patient from '../shared/model/Patient'
7	import { AppThunk } from '../shared/store'
8	import { uuid } from '../shared/util/uuid'
9	import { cleanupPatient } from './util/set-patient-helper'
10	import validatePatient from './util/validate-patient'
11
12	interface PatientState {
13	  status: 'loading' | 'error' | 'completed'
14	  isUpdatedSuccessfully: boolean
15	  patient: Patient
16	  relatedPersons: Patient[]
17	  createError?: Error
18	  updateError?: Error
19	  allergyError?: AddAllergyError
20	  diagnosisError?: AddDiagnosisError
21	  relatedPersonError?: AddRelatedPersonError
22	}
23
24	interface Error {
25	  message?: string
26	  givenName?: string
27	  dateOfBirth?: string
28	  suffix?: string
29	  prefix?: string
30	  familyName?: string
31	  preferredLanguage?: string
32	  emails?: (string | undefined)[]
33	  phoneNumbers?: (string | undefined)[]
34	}
35
36	interface AddRelatedPersonError {
37	  message?: string
38	  relatedPerson?: string
39	  relationshipType?: string
40	}
41
42	interface AddAllergyError {
43	  message?: string
44	  name?: string
45	}
46
47	interface AddDiagnosisError {
48	  message?: string
49	  name?: string
50	  date?: string
51	  status?: string
52	}
53
54	const initialState: PatientState = {
55	  status: 'loading',
56	  isUpdatedSuccessfully: false,
57	  patient: {} as Patient,
58	  relatedPersons: [],
59	  createError: undefined,
60	  updateError: undefined,
61	  diagnosisError: undefined,
62	  relatedPersonError: undefined,
63	}
64
65	function start(state: PatientState) {
66	  state.status = 'loading'
67	  state.createError = {}
68	}
69
70	const patientSlice = createSlice({
71	  name: 'patient',
72	  initialState,
73	  reducers: {
74	    createPatientStart: start,
75	    createPatientSuccess(state) {
76	      state.status = 'completed'
77	    },
78	    createPatientError(state, { payload }: PayloadAction<Error>) {
79	      state.status = 'error'
80	      state.createError = payload
81	    },
82	    updatePatientStart: start,
83	    updatePatientSuccess(state, { payload }: PayloadAction<Patient>) {
84	      state.status = 'completed'
85	      state.patient = payload
86	    },
87	    updatePatientError(state, { payload }: PayloadAction<Error>) {
88	      state.status = 'error'
89	      state.updateError = payload
90	    },
91	    addDiagnosisError(state, { payload }: PayloadAction<AddDiagnosisError>) {
92	      state.status = 'error'
93	      state.diagnosisError = payload
94	    },
95	  },
96	})
97
98	export const {
99	  createPatientStart,
100	  createPatientSuccess,
101	  createPatientError,
102	  updatePatientStart,
103	  updatePatientSuccess,
104	  updatePatientError,
105	  addDiagnosisError,
106	} = patientSlice.actions
107
108	export const createPatient = (
109	  patient: Patient,
110	  onSuccess?: (patient: Patient) => void,
111	): AppThunk => async (dispatch) => {
112	  dispatch(createPatientStart())
113
114	  const cleanPatient = cleanupPatient(patient)
115	  const newPatientError = validatePatient(cleanPatient)
116
117	  if (!newPatientError) {
118	    const newPatient = await PatientRepository.save(cleanPatient)
119	    dispatch(createPatientSuccess())
120
121	    if (onSuccess) {
122	      onSuccess(newPatient)
123	    }
124	  } else {
125	    dispatch(
126	      createPatientError({
127	        ...newPatientError.fieldErrors,
128	        message: 'patient.errors.createPatientError',
129	      }),
130	    )
131	  }
132	}
133
134	export const updatePatient = (
135	  patient: Patient,
136	  onSuccess?: (patient: Patient) => void,
137	): AppThunk => async (dispatch) => {
138	  dispatch(updatePatientStart())
139
140	  const cleanPatient = cleanupPatient(patient)
141	  const updateError = validatePatient(cleanPatient)
142
143	  if (!updateError) {
144	    const updatedPatient = await PatientRepository.saveOrUpdate(cleanPatient)
145	    dispatch(updatePatientSuccess(updatedPatient))
146
147	    if (onSuccess) {
148	      onSuccess(updatedPatient)
149	    }
150	  } else {
151	    dispatch(
152	      updatePatientError({
153	        ...updateError.fieldErrors,
154	        message: 'patient.errors.updatePatientError',
155	      }),
156	    )
157	  }
158	}
159
160	function validateDiagnosis(diagnosis: Diagnosis) {
161	  const error: AddDiagnosisError = {}
162
163	  if (!diagnosis.name) {
164	    error.name = 'patient.diagnoses.error.nameRequired'
165	  }
166
167	  if (!diagnosis.diagnosisDate) {
168	    error.date = 'patient.diagnoses.error.dateRequired'
169	  }
170
171	  if (!diagnosis.onsetDate) {
172	    error.date = 'patient.diagnoses.error.dateRequired'
173	  }
174
175	  if (!diagnosis.status) {
176	    error.status = 'patient.diagnoses.error.statusRequired'
177	  }
178	  return error
179	}
180
181	export const addDiagnosis = (
182	  patientId: string,
183	  diagnosis: Diagnosis,
184	  onSuccess?: (patient: Patient) => void,
185	): AppThunk => async (dispatch) => {
186	  const newDiagnosisError = validateDiagnosis(diagnosis)
187
188	  if (isEmpty(newDiagnosisError)) {
189	    const patient = await PatientRepository.find(patientId)
190	    const diagnoses = patient.diagnoses || []
191	    diagnoses.push({ id: uuid(), ...diagnosis })
192	    patient.diagnoses = diagnoses
193
194	    await dispatch(updatePatient(patient, onSuccess))
195	  } else {
196	    newDiagnosisError.message = 'patient.diagnoses.error.unableToAdd'
197	    dispatch(addDiagnosisError(newDiagnosisError))
198	  }
199	}
200
201	export default patientSlice.reducer
202	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/medications/medication-slice.ts with line numbers:
1	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
2
3	import MedicationRepository from '../shared/db/MedicationRepository'
4	import PatientRepository from '../shared/db/PatientRepository'
5	import Medication from '../shared/model/Medication'
6	import Patient from '../shared/model/Patient'
7	import { AppThunk } from '../shared/store'
8
9	interface Error {
10	  medication?: string
11	  patient?: string
12	  quantity?: string
13	  quantityValue?: string
14	  quantityUnit?: string
15	  message?: string
16	}
17
18	interface MedicationState {
19	  error: Error
20	  medication?: Medication
21	  patient?: Patient
22	  status: 'loading' | 'error' | 'completed'
23	}
24
25	const initialState: MedicationState = {
26	  error: {},
27	  medication: undefined,
28	  patient: undefined,
29	  status: 'loading',
30	}
31
32	function start(state: MedicationState) {
33	  state.status = 'loading'
34	}
35
36	function finish(state: MedicationState, { payload }: PayloadAction<Medication>) {
37	  state.status = 'completed'
38	  state.medication = payload
39	  state.error = {}
40	}
41
42	function error(state: MedicationState, { payload }: PayloadAction<Error>) {
43	  state.status = 'error'
44	  state.error = payload
45	}
46
47	const medicationSlice = createSlice({
48	  name: 'medication',
49	  initialState,
50	  reducers: {
51	    fetchMedicationStart: start,
52	    fetchMedicationSuccess: (
53	      state: MedicationState,
54	      { payload }: PayloadAction<{ medication: Medication; patient: Patient }>,
55	    ) => {
56	      state.status = 'completed'
57	      state.medication = payload.medication
58	      state.patient = payload.patient
59	    },
60	    updateMedicationStart: start,
61	    updateMedicationSuccess: finish,
62	    requestMedicationStart: start,
63	    requestMedicationSuccess: finish,
64	    requestMedicationError: error,
65	    cancelMedicationStart: start,
66	    cancelMedicationSuccess: finish,
67	  },
68	})
69
70	export const {
71	  fetchMedicationStart,
72	  fetchMedicationSuccess,
73	  updateMedicationStart,
74	  updateMedicationSuccess,
75	  requestMedicationStart,
76	  requestMedicationSuccess,
77	  requestMedicationError,
78	  cancelMedicationStart,
79	  cancelMedicationSuccess,
80	} = medicationSlice.actions
81
82	export const fetchMedication = (medicationId: string): AppThunk => async (dispatch) => {
83	  dispatch(fetchMedicationStart())
84	  const fetchedMedication = await MedicationRepository.find(medicationId)
85	  const fetchedPatient = await PatientRepository.find(fetchedMedication.patient)
86	  dispatch(fetchMedicationSuccess({ medication: fetchedMedication, patient: fetchedPatient }))
87	}
88
89	const validateMedicationRequest = (newMedication: Medication): Error => {
90	  const medicationRequestError: Error = {}
91	  if (!newMedication.patient) {
92	    medicationRequestError.patient = 'medications.requests.error.patientRequired'
93	  }
94
95	  if (!newMedication.quantity) {
96	    medicationRequestError.quantity = 'medications.requests.error.quantityRequired'
97	  }
98
99	  return medicationRequestError
100	}
101
102	export const requestMedication = (
103	  newMedication: Medication,
104	  onSuccess?: (medication: Medication) => void,
105	): AppThunk => async (dispatch, getState) => {
106	  dispatch(requestMedicationStart())
107
108	  const medicationRequestError = validateMedicationRequest(newMedication)
109	  if (Object.keys(medicationRequestError).length > 0) {
110	    medicationRequestError.message = 'medications.requests.error.unableToRequest'
111	    dispatch(requestMedicationError(medicationRequestError))
112	  } else {
113	    newMedication.status = 'draft'
114	    newMedication.requestedOn = new Date(Date.now().valueOf()).toISOString()
115	    newMedication.requestedBy = getState().user?.user?.id || ''
116	    const requestedMedication = await MedicationRepository.save(newMedication)
117	    dispatch(requestMedicationSuccess(requestedMedication))
118
119	    if (onSuccess) {
120	      onSuccess(requestedMedication)
121	    }
122	  }
123	}
124
125	export const cancelMedication = (
126	  medicationToCancel: Medication,
127	  onSuccess?: (medication: Medication) => void,
128	): AppThunk => async (dispatch) => {
129	  dispatch(cancelMedicationStart())
130
131	  medicationToCancel.canceledOn = new Date(Date.now().valueOf()).toISOString()
132	  medicationToCancel.status = 'canceled'
133	  const canceledMedication = await MedicationRepository.saveOrUpdate(medicationToCancel)
134	  dispatch(cancelMedicationSuccess(canceledMedication))
135
136	  if (onSuccess) {
137	    onSuccess(canceledMedication)
138	  }
139	}
140
141	export const updateMedication = (
142	  medicationToUpdate: Medication,
143	  onSuccess?: (medication: Medication) => void,
144	): AppThunk => async (dispatch) => {
145	  dispatch(updateMedicationStart())
146	  const updatedMedication = await MedicationRepository.saveOrUpdate(medicationToUpdate)
147	  dispatch(updateMedicationSuccess(updatedMedication))
148
149	  if (onSuccess) {
150	    onSuccess(updatedMedication)
151	  }
152	}
153
154	export default medicationSlice.reducer
155	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/store/index.ts with line numbers:
1	import { configureStore, combineReducers, Action } from '@reduxjs/toolkit'
2	import ReduxThunk, { ThunkAction } from 'redux-thunk'
3
4	import medication from '../../medications/medication-slice'
5	import breadcrumbs from '../../page-header/breadcrumbs/breadcrumbs-slice'
6	import patient from '../../patients/patient-slice'
7	import patients from '../../patients/patients-slice'
8	import user from '../../user/user-slice'
9	import components from '../components/component-slice'
10
11	const reducer = combineReducers({
12	  patient,
13	  patients,
14	  user,
15	  breadcrumbs,
16	  components,
17	  medication,
18	})
19
20	const store = configureStore({
21	  reducer,
22	  middleware: [ReduxThunk],
23	})
24
25	export type AppDispatch = typeof store.dispatch
26	export type AppThunk = ThunkAction<void, RootState, null, Action<string>>
27	export type RootState = ReturnType<typeof reducer>
28
29	export default store
30	


bash
command
grep -r "react-query\|useMutation\|useQuery" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" --include="*.ts" -l | grep -v "__tests__" | head -20
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useResolveIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/hooks/useRequestImaging.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointments.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useDeleteAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/hooks/useMedicationSearch.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCancelLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCompleteLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useLab.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useLabsSearch.ts
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useUpdateLab.ts


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/App.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/App.tsx with line numbers:
1	/* eslint-disable no-console */
2
3	import { Spinner } from '@hospitalrun/components'
4	import React, { Suspense, useEffect, useState } from 'react'
5	import { ReactQueryDevtools } from 'react-query-devtools'
6	import { useDispatch } from 'react-redux'
7	import { BrowserRouter, Route, Switch } from 'react-router-dom'
8
9	import HospitalRun from './HospitalRun'
10	import { TitleProvider } from './page-header/title/TitleContext'
11	import { remoteDb } from './shared/config/pouchdb'
12	import { getCurrentSession } from './user/user-slice'
13
14	const App: React.FC = () => {
15	  const dispatch = useDispatch()
16	  const [loading, setLoading] = useState(true)
17
18	  useEffect(() => {
19	    let cancelled = false
20
21	    remoteDb
22	      .getSession()
23	      .then((session) => {
24	        if (cancelled) {
25	          return
26	        }
27	        if (session.userCtx.name) {
28	          dispatch(getCurrentSession(session.userCtx.name))
29	        }
30	      })
31	      .catch((e) => {
32	        console.log(e)
33	      })
34	      .finally(() => {
35	        if (!cancelled) {
36	          setLoading(false)
37	        }
38	      })
39
40	    return () => {
41	      cancelled = true
42	    }
43	  }, [dispatch])
44
45	  if (loading) {
46	    return null
47	  }
48
49	  return (
50	    <>
51	      <BrowserRouter>
52	        <Suspense fallback={<Spinner color="blue" loading size={[10, 25]} type="ScaleLoader" />}>
53	          <Switch>
54	            <TitleProvider>
55	              <Route path="/" component={HospitalRun} />
56	            </TitleProvider>
57	          </Switch>
58	        </Suspense>
59	      </BrowserRouter>
60	      <ReactQueryDevtools initialIsOpen={false} />
61	    </>
62	  )
63	}
64
65	export default App
66	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/hooks/useIncident.tsx with line numbers:
1	import { useQuery } from 'react-query'
2
3	import IncidentRepository from '../../shared/db/IncidentRepository'
4	import Incident from '../../shared/model/Incident'
5
6	function fetchIncidentById(_: any, incidentId: string): Promise<Incident> {
7	  return IncidentRepository.find(incidentId)
8	}
9
10	export default function useIncident(incidentId: string) {
11	  return useQuery(['incident', incidentId], fetchIncidentById)
12	}
13	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/hooks/useRequestLab.ts with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { useMutation, queryCache } from 'react-query'
3
4	import LabRepository from '../../shared/db/LabRepository'
5	import Lab from '../../shared/model/Lab'
6	import { validateLabRequest } from '../utils/validate-lab'
7
8	function requestLab(newLab: Lab): Promise<Lab> {
9	  const requestLabErrors = validateLabRequest(newLab)
10
11	  if (isEmpty(requestLabErrors)) {
12	    newLab.requestedOn = new Date(Date.now().valueOf()).toISOString()
13	    return LabRepository.save(newLab)
14	  }
15
16	  throw requestLabErrors
17	}
18
19	export default function useRequestLab() {
20	  return useMutation(requestLab, {
21	    onSuccess: async () => {
22	      await queryCache.invalidateQueries('labs')
23	    },
24	    throwOnError: true,
25	  })
26	}
27	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx with line numbers:
1	import {
2	  Select,
3	  Typeahead,
4	  Label,
5	  Button,
6	  Alert,
7	  Toast,
8	  Column,
9	  Row,
10	} from '@hospitalrun/components'
11	import format from 'date-fns/format'
12	import React, { useState, useEffect } from 'react'
13	import { useSelector } from 'react-redux'
14	import { useHistory } from 'react-router-dom'
15
16	import useAddBreadcrumbs from '../../page-header/breadcrumbs/useAddBreadcrumbs'
17	import { useUpdateTitle } from '../../page-header/title/TitleContext'
18	import { SelectOption } from '../../shared/components/input/SelectOption'
19	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
20	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
21	import PatientRepository from '../../shared/db/PatientRepository'
22	import useTranslator from '../../shared/hooks/useTranslator'
23	import Lab from '../../shared/model/Lab'
24	import Note from '../../shared/model/Note'
25	import Patient from '../../shared/model/Patient'
26	import { RootState } from '../../shared/store'
27	import { uuid } from '../../shared/util/uuid'
28	import useRequestLab from '../hooks/useRequestLab'
29	import { LabError } from '../utils/validate-lab'
30
31	const NewLabRequest = () => {
32	  const { t } = useTranslator()
33	  const history = useHistory()
34	  const { user } = useSelector((state: RootState) => state.user)
35	  const [mutate] = useRequestLab()
36	  const [newNoteText, setNewNoteText] = useState('')
37	  const [error, setError] = useState<LabError | undefined>(undefined)
38	  const [visitOptions, setVisitOptions] = useState([] as SelectOption[])
39
40	  const updateTitle = useUpdateTitle()
41	  useEffect(() => {
42	    updateTitle(t('labs.requests.new'))
43	  })
44	  const [newLabRequest, setNewLabRequest] = useState({
45	    patient: '',
46	    type: '',
47	    status: 'requested',
48	    requestedBy: user?.id || '',
49	    requestedOn: '',
50	    visitId: '',
51	  })
52
53	  const breadcrumbs = [
54	    {
55	      i18nKey: 'labs.requests.new',
56	      location: `/labs/new`,
57	    },
58	  ]
59	  useAddBreadcrumbs(breadcrumbs)
60
61	  const onPatientChange = (patient: Patient) => {
62	    if (patient) {
63	      const visits = patient.visits?.map((v) => ({
64	        label: `${v.type} at ${format(new Date(v.startDateTime), 'yyyy-MM-dd hh:mm a')}`,
65	        value: v.id,
66	      })) as SelectOption[]
67
68	      setVisitOptions(visits)
69	      setNewLabRequest((previousNewLabRequest) => ({
70	        ...previousNewLabRequest,
71	        patient: patient.id,
72	        fullName: patient.fullName,
73	      }))
74	    } else {
75	      setVisitOptions([])
76	      setNewLabRequest((previousNewLabRequest) => ({
77	        ...previousNewLabRequest,
78	        patient: '',
79	        visitId: '',
80	      }))
81	    }
82	  }
83
84	  const onLabTypeChange = (event: React.ChangeEvent<HTMLInputElement>) => {
85	    const type = event.currentTarget.value
86	    setNewLabRequest((previousNewLabRequest) => ({
87	      ...previousNewLabRequest,
88	      type,
89	    }))
90	  }
91
92	  const onNoteChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
93	    const noteText = event.currentTarget.value
94	    setNewNoteText(noteText)
95
96	    const newNote: Note = {
97	      id: uuid(),
98	      date: new Date().toISOString(),
99	      text: noteText,
100	      deleted: false,
101	    }
102
103	    setNewLabRequest((previousNewLabRequest) => ({
104	      ...previousNewLabRequest,
105	      notes: [newNote],
106	    }))
107	  }
108
109	  const onSave = async () => {
110	    try {
111	      const newLab = await mutate(newLabRequest as Lab)
112	      history.push(`/labs/${newLab?.id}`)
113	      Toast(
114	        'success',
115	        t('states.success'),
116	        `${t('labs.successfullyCreated')} ${newLab?.type} ${t('labs.lab.for')} ${
117	          (await PatientRepository.find(newLab?.patient || '')).fullName
118	        }`,
119	      )
120	      setError(undefined)
121	    } catch (e) {
122	      setError(e)
123	    }
124	  }
125
126	  const onVisitChange = (visitId: string) => {
127	    setNewLabRequest((previousNewLabRequest) => ({
128	      ...previousNewLabRequest,
129	      visitId,
130	    }))
131	  }
132
133	  const onCancel = () => {
134	    history.push('/labs')
135	  }
136
137	  const defaultSelectedVisitsOption = () => {
138	    if (visitOptions !== undefined) {
139	      return visitOptions.filter(({ value }) => value === newLabRequest.visitId)
140	    }
141	    return []
142	  }
143
144	  return (
145	    <>
146	      {error && <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />}
147	      <form>
148	        <Row>
149	          <Column>
150	            <div className="form-group patient-typeahead">
151	              <Label htmlFor="patientTypeahead" isRequired text={t('labs.lab.patient')} />
152	              <Typeahead
153	                id="patientTypeahead"
154	                placeholder={t('labs.lab.patient')}
155	                onChange={(p: Patient[]) => onPatientChange(p[0])}
156	                onSearch={async (query: string) => PatientRepository.search(query)}
157	                searchAccessor="fullName"
158	                renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
159	                isInvalid={!!error?.patient}
160	                feedback={t(error?.patient as string)}
161	              />
162	            </div>
163	          </Column>
164	          <Column>
165	            <div className="form-group" data-testid="visitSelect">
166	              <Label text={t('patient.visit')} title="This is a required input" isRequired />
167	              <Select
168	                id="visit"
169	                options={visitOptions || []}
170	                defaultSelected={defaultSelectedVisitsOption()}
171	                onChange={(values) => {
172	                  onVisitChange(values[0])
173	                }}
174	                disabled={false}
175	              />
176	            </div>
177	          </Column>
178	        </Row>
179	        <TextInputWithLabelFormGroup
180	          name="labType"
181	          label={t('labs.lab.type')}
182	          isRequired
183	          isEditable
184	          isInvalid={!!error?.type}
185	          feedback={t(error?.type as string)}
186	          value={newLabRequest.type}
187	          onChange={onLabTypeChange}
188	        />
189	        <div className="form-group">
190	          <TextFieldWithLabelFormGroup
191	            name="labNotes"
192	            label={t('labs.lab.notes')}
193	            isEditable
194	            value={newNoteText}
195	            onChange={onNoteChange}
196	          />
197	        </div>
198	        <div className="row float-right">
199	          <div className="btn-group btn-group-lg mt-3 mr-3">
200	            <Button className="mr-2" color="success" onClick={onSave}>
201	              {t('labs.requests.new')}
202	            </Button>
203
204	            <Button color="danger" onClick={onCancel}>
205	              {t('actions.cancel')}
206	            </Button>
207	          </div>
208	        </div>
209	      </form>
210	    </>
211	  )
212	}
213
214	export default NewLabRequest
215	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx with line numbers:
1	import { Button, Spinner, Toast } from '@hospitalrun/components'
2	import addMinutes from 'date-fns/addMinutes'
3	import roundToNearestMinutes from 'date-fns/roundToNearestMinutes'
4	import isEmpty from 'lodash/isEmpty'
5	import React, { useEffect, useState } from 'react'
6	import { useHistory, useLocation } from 'react-router-dom'
7
8	import useAddBreadcrumbs from '../../../page-header/breadcrumbs/useAddBreadcrumbs'
9	import { useUpdateTitle } from '../../../page-header/title/TitleContext'
10	import useTranslator from '../../../shared/hooks/useTranslator'
11	import Appointment from '../../../shared/model/Appointment'
12	import Patient from '../../../shared/model/Patient'
13	import useScheduleAppointment from '../../hooks/useScheduleAppointment'
14	import AppointmentDetailForm from '../AppointmentDetailForm'
15	import { AppointmentError } from '../util/validate-appointment'
16
17	const breadcrumbs = [
18	  { i18nKey: 'scheduling.appointments.label', location: '/appointments' },
19	  { i18nKey: 'scheduling.appointments.new', location: '/appointments/new' },
20	]
21
22	interface LocationProps {
23	  pathname: string
24	  state?: {
25	    patient: Patient
26	  }
27	}
28
29	const NewAppointment = () => {
30	  const { t } = useTranslator()
31	  const history = useHistory()
32	  const location: LocationProps = useLocation()
33	  const patient = location.state?.patient
34	  const updateTitle = useUpdateTitle()
35	  useEffect(() => {
36	    updateTitle(t('scheduling.appointments.new'))
37	  })
38	  useAddBreadcrumbs(breadcrumbs, true)
39
40	  const startDateTime = roundToNearestMinutes(new Date(), { nearestTo: 15 })
41	  const endDateTime = addMinutes(startDateTime, 60)
42	  const [saved, setSaved] = useState(false)
43	  const [newAppointmentMutateError, setError] = useState<AppointmentError>({} as AppointmentError)
44	  const [newAppointment, setAppointment] = useState({
45	    patient: patient || '',
46	    startDateTime: startDateTime.toISOString(),
47	    endDateTime: endDateTime.toISOString(),
48	    location: '',
49	    reason: '',
50	    type: '',
51	  } as Appointment)
52
53	  const {
54	    mutate: newAppointmentMutate,
55	    isLoading: isLoadingNewAppointment,
56	    isError: isErrorNewAppointment,
57	    validator: validateNewAppointment,
58	  } = useScheduleAppointment()
59
60	  const onCancelClick = () => {
61	    history.push('/appointments')
62	  }
63
64	  const onSave = () => {
65	    setSaved(true)
66	    setError(validateNewAppointment(newAppointment))
67	  }
68
69	  useEffect(() => {
70	    // if save click and no error proceed, else give error message.
71	    if (saved) {
72	      if (isEmpty(newAppointmentMutateError) && !isErrorNewAppointment) {
73	        newAppointmentMutate(newAppointment).then((result) => {
74	          Toast('success', t('states.success'), t('scheduling.appointment.successfullyCreated'))
75	          history.push(`/appointments/${result?.id}`)
76	        })
77	      } else if (!isEmpty(newAppointmentMutateError)) {
78	        newAppointmentMutateError.message = 'scheduling.appointment.errors.createAppointmentError'
79	      }
80	    }
81	    setSaved(false)
82	  }, [
83	    saved,
84	    newAppointmentMutateError,
85	    isErrorNewAppointment,
86	    newAppointmentMutate,
87	    newAppointment,
88	    t,
89	    history,
90	  ])
91
92	  if (isLoadingNewAppointment) {
93	    return <Spinner color="blue" loading size={[10, 25]} type="ScaleLoader" />
94	  }
95
96	  const onFieldChange = (key: string, value: string | boolean) => {
97	    setAppointment({
98	      ...newAppointment,
99	      [key]: value,
100	    })
101	  }
102
103	  return (
104	    <div>
105	      <form aria-label="new appointment form">
106	        <AppointmentDetailForm
107	          appointment={newAppointment as Appointment}
108	          patient={patient as Patient}
109	          error={newAppointmentMutateError}
110	          onFieldChange={onFieldChange}
111	        />
112	        <div className="row float-right">
113	          <div className="btn-group btn-group-lg mr-3">
114	            <Button className="mr-2" color="success" onClick={onSave}>
115	              {t('scheduling.appointments.createAppointment')}
116	            </Button>
117	            <Button color="danger" onClick={onCancelClick}>
118	              {t('actions.cancel')}
119	            </Button>
120	          </div>
121	        </div>
122	      </form>
123	    </div>
124	  )
125	}
126
127	export default NewAppointment
128	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/AppointmentDetailForm.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/AppointmentDetailForm.tsx with line numbers:
1	import { Select, Typeahead, Label, Alert } from '@hospitalrun/components'
2	import React from 'react'
3
4	import DateTimePickerWithLabelFormGroup from '../../shared/components/input/DateTimePickerWithLabelFormGroup'
5	import { SelectOption } from '../../shared/components/input/SelectOption'
6	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
7	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
8	import PatientRepository from '../../shared/db/PatientRepository'
9	import useTranslator from '../../shared/hooks/useTranslator'
10	import Appointment from '../../shared/model/Appointment'
11	import Patient from '../../shared/model/Patient'
12
13	interface Props {
14	  appointment: Appointment
15	  patient?: Patient
16	  isEditable: boolean
17	  error?: any
18	  onFieldChange?: (key: string, value: string | boolean) => void
19	}
20
21	const AppointmentDetailForm = (props: Props) => {
22	  const { onFieldChange, appointment, patient, isEditable, error } = props
23	  const { t } = useTranslator()
24
25	  const onDateChange = (date: Date, fieldName: string) =>
26	    onFieldChange && onFieldChange(fieldName, date.toISOString())
27
28	  const onInputElementChange = (event: React.ChangeEvent<HTMLInputElement>, fieldName: string) =>
29	    onFieldChange && onFieldChange(fieldName, event.target.value)
30
31	  const typeOptions: SelectOption[] = [
32	    { label: t('scheduling.appointment.types.checkup'), value: 'checkup' },
33	    { label: t('scheduling.appointment.types.emergency'), value: 'emergency' },
34	    { label: t('scheduling.appointment.types.followUp'), value: 'follow up' },
35	    { label: t('scheduling.appointment.types.routine'), value: 'routine' },
36	    { label: t('scheduling.appointment.types.walkIn'), value: 'walk in' },
37	  ]
38
39	  return (
40	    <>
41	      {error?.message && <Alert className="alert" color="danger" message={t(error?.message)} />}
42	      <div className="row">
43	        <div className="col">
44	          <div className="form-group">
45	            <Label
46	              htmlFor="patientTypeahead"
47	              isRequired
48	              text={t('scheduling.appointment.patient')}
49	            />
50	            <Typeahead
51	              id="patientTypeahead"
52	              disabled={!isEditable || patient !== undefined}
53	              value={patient?.fullName}
54	              placeholder={t('scheduling.appointment.patient')}
55	              onChange={(p: Patient[]) =>
56	                onFieldChange && p[0] && onFieldChange('patient', p[0].id)
57	              }
58	              onSearch={async (query: string) => PatientRepository.search(query)}
59	              searchAccessor="fullName"
60	              renderMenuItemChildren={(p: Patient) => <div>{`${p.fullName} (${p.code})`}</div>}
61	              isInvalid={!!error?.patient}
62	              feedback={t(error?.patient)}
63	            />
64	          </div>
65	        </div>
66	      </div>
67	      <div className="row">
68	        <div className="col">
69	          <DateTimePickerWithLabelFormGroup
70	            name="startDate"
71	            label={t('scheduling.appointment.startDate')}
72	            value={
73	              appointment.startDateTime && appointment.startDateTime.length > 0
74	                ? new Date(appointment.startDateTime)
75	                : undefined
76	            }
77	            isEditable={isEditable}
78	            isInvalid={error?.startDateTime}
79	            feedback={t(error?.startDateTime)}
80	            onChange={(date: Date) => {
81	              onDateChange(date, 'startDateTime')
82	            }}
83	          />
84	        </div>
85	        <div className="col">
86	          <DateTimePickerWithLabelFormGroup
87	            name="endDate"
88	            label={t('scheduling.appointment.endDate')}
89	            value={
90	              appointment.endDateTime && appointment.endDateTime.length > 0
91	                ? new Date(appointment.endDateTime)
92	                : undefined
93	            }
94	            isEditable={isEditable}
95	            onChange={(date: Date) => {
96	              onDateChange(date, 'endDateTime')
97	            }}
98	          />
99	        </div>
100	      </div>
101	      <div className="row">
102	        <div className="col">
103	          <TextInputWithLabelFormGroup
104	            name="location"
105	            label={t('scheduling.appointment.location')}
106	            value={appointment.location}
107	            isEditable={isEditable}
108	            onChange={(event) => {
109	              onInputElementChange(event, 'location')
110	            }}
111	          />
112	        </div>
113	      </div>
114	      <div className="row">
115	        <div className="col">
116	          <div className="form-group" data-testid="typeSelect">
117	            <Label text={t('scheduling.appointment.type')} title="type" />
118	            <Select
119	              id="type"
120	              options={typeOptions}
121	              defaultSelected={typeOptions.filter(({ value }) => value === appointment.type)}
122	              onChange={(values) => onFieldChange && onFieldChange('type', values[0])}
123	              disabled={!isEditable}
124	            />
125	          </div>
126	        </div>
127	      </div>
128	      <div className="row">
129	        <div className="col">
130	          <div className="form-group">
131	            <TextFieldWithLabelFormGroup
132	              name="reason"
133	              label={t('scheduling.appointment.reason')}
134	              value={appointment.reason}
135	              isEditable={isEditable}
136	              onChange={(event: React.ChangeEvent<HTMLTextAreaElement>) =>
137	                onFieldChange && onFieldChange('reason', event.currentTarget.value)
138	              }
139	            />
140	          </div>
141	        </div>
142	      </div>
143	    </>
144	  )
145	}
146
147	AppointmentDetailForm.defaultProps = {
148	  isEditable: true,
149	}
150
151	export default AppointmentDetailForm
152	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status, excluding hidden items and node_modules:
3.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/index.ts
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/types.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/NetworkStatusMessage.tsx with line numbers:
1	import React, { useState } from 'react'
2
3	import useTranslator from '../../hooks/useTranslator'
4	import { useNetworkStatus } from './useNetworkStatus'
5
6	const ONLINE_COLOR = 'rgba(0, 255, 0, 0.55)'
7	const OFFLINE_COLOR = 'rgba(255, 0, 0, 0.65)'
8	const OPACITY_TRANSITION_TIME = 4000
9	const BASE_STYLE = {
10	  height: '50px',
11	  pointerEvents: 'none' as const,
12	  transition: `opacity ${OPACITY_TRANSITION_TIME}ms ease-in`,
13	}
14
15	export const NetworkStatusMessage = () => {
16	  const { t } = useTranslator()
17	  const { isOnline, wasOffline } = useNetworkStatus()
18	  const [shouldRender, setShouldRender] = useState(true)
19	  const [opacity, setOpacity] = useState(1)
20
21	  if (isOnline && !wasOffline) {
22	    return null
23	  }
24
25	  if (!isOnline && opacity !== 1) {
26	    setShouldRender(true)
27	    setOpacity(1)
28	  }
29
30	  if (isOnline && wasOffline && opacity !== 0) {
31	    setOpacity(0)
32	    setTimeout(() => {
33	      setShouldRender(false)
34	    }, OPACITY_TRANSITION_TIME)
35	  }
36
37	  if (!shouldRender) {
38	    return null
39	  }
40
41	  const style = {
42	    ...BASE_STYLE,
43	    backgroundColor: isOnline ? ONLINE_COLOR : OFFLINE_COLOR,
44	    opacity,
45	  }
46
47	  return (
48	    <div
49	      className={`fixed-bottom d-flex justify-content-center align-items-center ${
50	        isOnline ? 'online' : 'offline'
51	      }`}
52	      style={style}
53	    >
54	      {isOnline ? t('networkStatus.online') : t('networkStatus.offline')}
55	    </div>
56	  )
57	}
58	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/network-status/useNetworkStatus.ts with line numbers:
1	import { useState, useEffect } from 'react'
2
3	import { NetworkStatus } from './types'
4
5	export const useNetworkStatus = (): NetworkStatus => {
6	  const isOnline = navigator.onLine
7	  const [networkStatus, setNetworkStatus] = useState({
8	    isOnline,
9	    wasOffline: !isOnline,
10	  })
11	  const handleOnline = () => {
12	    setNetworkStatus((prevState) => ({ ...prevState, isOnline: true }))
13	  }
14	  const handleOffline = () => {
15	    setNetworkStatus((prevState) => ({ ...prevState, isOnline: false, wasOffline: true }))
16	  }
17	  useEffect(() => {
18	    window.addEventListener('online', handleOnline)
19	    window.addEventListener('offline', handleOffline)
20
21	    return () => {
22	      window.removeEventListener('online', handleOnline)
23	      window.removeEventListener('offline', handleOffline)
24	    }
25	  }, [])
26
27	  return networkStatus
28	}
29	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx with line numbers:
1	import { Spinner } from '@hospitalrun/components'
2	import React from 'react'
3
4	const Loading = () => <Spinner color="blue" loading size={20} type="BeatLoader" />
5
6	export default Loading
7	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/db/Repository.ts with line numbers:
1	import { v4 as uuidv4 } from 'uuid'
2
3	import { schema } from '../config/pouchdb'
4	import AbstractDBModel from '../model/AbstractDBModel'
5	import SortRequest, { Unsorted } from './SortRequest'
6
7	export default class Repository<T extends AbstractDBModel> {
8	  db: PouchDB.RelDatabase
9
10	  type: string
11
12	  pluralType: string
13
14	  constructor(type: string, db: PouchDB.RelDatabase) {
15	    this.db = db
16	    this.type = type
17	    this.pluralType = schema.find((s) => s.singular === this.type)?.plural || ''
18	  }
19
20	  async find(id: string): Promise<T> {
21	    const documents = await this.db.rel.find(this.type, id)
22	    const entity = documents[this.pluralType][0]
23	    return entity
24	  }
25
26	  async findAll(sort = Unsorted): Promise<T[]> {
27	    const selector: any = {
28	      _id: {
29	        $regex: RegExp(this.type, 'i'),
30	      },
31	    }
32
33	    sort.sorts.forEach((s) => {
34	      selector[`data.${s.field}`] = { $gt: null }
35	    })
36
37	    // Adds an index to each of the fields coming from the sorting object
38	    // allowing the algorithm to sort by any given SortRequest, by avoiding the default index error (lack of index)
39
40	    await Promise.all(
41	      sort.sorts.map(
42	        async (s): Promise<SortRequest> => {
43	          await this.db.createIndex({
44	            index: {
45	              fields: [`data.${s.field}`],
46	            },
47	          })
48
49	          return sort
50	        },
51	      ),
52	    )
53
54	    const result = await this.db.find({
55	      selector,
56	      sort:
57	        sort.sorts.length > 0
58	          ? sort.sorts.map((s) => ({ [`data.${s.field}`]: s.direction }))
59	          : undefined,
60	    })
61	    const relDocs = await this.db.rel.parseRelDocs(this.type, result.docs)
62	    return relDocs[this.pluralType]
63	  }
64
65	  async count(): Promise<number> {
66	    const result = await this.findAll()
67	    return result.length
68	  }
69
70	  async search(criteria: any): Promise<T[]> {
71	    const response = await this.db.find({
72	      selector: {
73	        $and: [
74	          {
75	            _id: {
76	              $regex: RegExp(this.type, 'i'),
77	            },
78	          },
79	          { ...criteria.selector },
80	        ],
81	      },
82	    })
83	    const data = await this.db.rel.parseRelDocs(this.type, response.docs)
84	    return data[this.pluralType]
85	  }
86
87	  async save(entity: T): Promise<T> {
88	    const currentTime = new Date().toISOString()
89
90	    const { id, rev, ...valuesToSave } = entity
91	    const savedEntity = await this.db.rel.save(this.type, {
92	      id: uuidv4(),
93	      ...valuesToSave,
94	      createdAt: currentTime,
95	      updatedAt: currentTime,
96	    })
97	    return this.find(savedEntity.id)
98	  }
99
100	  async saveOrUpdate(entity: T): Promise<T> {
101	    if (!entity.id) {
102	      return this.save(entity)
103	    }
104
105	    const { id, rev, ...dataToSave } = entity
106
107	    try {
108	      await this.find(entity.id)
109	      const entityToUpdate = {
110	        id,
111	        rev,
112	        ...dataToSave,
113	        updatedAt: new Date().toISOString(),
114	      }
115
116	      await this.db.rel.save(this.type, entityToUpdate)
117	      return this.find(entity.id)
118	    } catch (error) {
119	      return this.save(entity)
120	    }
121	  }
122
123	  async delete(entity: T): Promise<T> {
124	    const entityToDelete = await this.find(entity.id)
125	    await this.db.rel.del(this.type, entity)
126	    return entityToDelete
127	  }
128	}
129	


bash
command
grep -r "Loading\|Spinner\|loading" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" -l | grep -v "__tests__" | head -10
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ImagingRequestTable.tsx
/tmp/inputs/hospitalrun-frontend/src/shared/components/Loading.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useScheduleAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/hooks/useUpdateAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncidentDetails.tsx with line numbers:
1	import { Button, Column, Row, Spinner } from '@hospitalrun/components'
2	import format from 'date-fns/format'
3	import React from 'react'
4	import { useHistory } from 'react-router'
5
6	import usePatient from '../../patients/hooks/usePatient'
7	import TextFieldWithLabelFormGroup from '../../shared/components/input/TextFieldWithLabelFormGroup'
8	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
9	import useTranslator from '../../shared/hooks/useTranslator'
10	import Permissions from '../../shared/model/Permissions'
11	import { extractUsername } from '../../shared/util/extractUsername'
12	import useIncident from '../hooks/useIncident'
13	import useResolveIncident from '../hooks/useResolveIncident'
14
15	interface Props {
16	  incidentId: string
17	  permissions: (Permissions | null)[]
18	}
19
20	function ViewIncidentDetails(props: Props) {
21	  const { incidentId, permissions } = props
22	  const history = useHistory()
23	  const { t } = useTranslator()
24	  const { data, isLoading } = useIncident(incidentId)
25	  const { data: patient } = usePatient(data?.patient)
26	  const [mutate] = useResolveIncident()
27
28	  if (data === undefined || isLoading) {
29	    return <Spinner type="DotLoader" loading />
30	  }
31
32	  const onResolve = async () => {
33	    await mutate(data)
34	    history.push('/incidents')
35	  }
36
37	  const getButtons = () => {
38	    const buttons: React.ReactNode[] = []
39	    if (data.status === 'resolved') {
40	      return buttons
41	    }
42
43	    if (permissions.includes(Permissions.ResolveIncident)) {
44	      buttons.push(
45	        <Button onClick={onResolve} color="primary" key="incidents.reports.resolve">
46	          {t('incidents.reports.resolve')}
47	        </Button>,
48	      )
49	    }
50
51	    return buttons
52	  }
53
54	  const getResolvedOnDate = () => {
55	    if (data.status === 'resolved' && data.resolvedOn) {
56	      return (
57	        <Column>
58	          <div className="form-group incident-resolved-on">
59	            <h4>{t('incidents.reports.resolvedOn')}</h4>
60	            <h5>{format(new Date(data.resolvedOn), 'yyyy-MM-dd hh:mm a')}</h5>
61	          </div>
62	        </Column>
63	      )
64	    }
65	    return <></>
66	  }
67
68	  return (
69	    <>
70	      <Row>
71	        <Column>
72	          <div className="form-group incident-date">
73	            <h4>{t('incidents.reports.dateOfIncident')}</h4>
74	            <h5>{format(new Date(data.date || ''), 'yyyy-MM-dd hh:mm a')}</h5>
75	          </div>
76	        </Column>
77	        <Column>
78	          <div className="form-group incident-status">
79	            <h4>{t('incidents.reports.status')}</h4>
80	            <h5>{data.status}</h5>
81	          </div>
82	        </Column>
83	        <Column>
84	          <div className="form-group incident-reported-by">
85	            <h4>{t('incidents.reports.reportedBy')}</h4>
86	            <h5>{extractUsername(data.reportedBy)}</h5>
87	          </div>
88	        </Column>
89	        <Column>
90	          <div className="form-group incident-reported-on">
91	            <h4>{t('incidents.reports.reportedOn')}</h4>
92	            <h5>{format(new Date(data.reportedOn || ''), 'yyyy-MM-dd hh:mm a')}</h5>
93	          </div>
94	        </Column>
95	        {getResolvedOnDate()}
96	      </Row>
97	      <div className="border-bottom mb-2" />
98	      <Row>
99	        <Column md={12}>
100	          <TextInputWithLabelFormGroup
101	            label={t('incidents.reports.department')}
102	            name="department"
103	            value={data.department}
104	          />
105	        </Column>
106	      </Row>
107	      <Row>
108	        <Column md={6}>
109	          <TextInputWithLabelFormGroup
110	            name="category"
111	            label={t('incidents.reports.category')}
112	            value={data.category}
113	          />
114	        </Column>
115	        <Column md={6}>
116	          <TextInputWithLabelFormGroup
117	            label={t('incidents.reports.categoryItem')}
118	            name="categoryItem"
119	            value={data.categoryItem}
120	          />
121	        </Column>
122	      </Row>
123	      <Row>
124	        <Column md={12}>
125	          <TextFieldWithLabelFormGroup
126	            label={t('incidents.reports.description')}
127	            name="description"
128	            value={data.description}
129	          />
130	        </Column>
131	      </Row>
132	      {data.patient && (
133	        <Row>
134	          <Column md={6}>
135	            <TextInputWithLabelFormGroup
136	              label={t('incidents.reports.patient')}
137	              name="patient"
138	              value={patient?.fullName}
139	            />
140	          </Column>
141	        </Row>
142	      )}
143	      {data.resolvedOn === undefined && (
144	        <div className="row float-right">
145	          <div className="btn-group btn-group-lg mt-3 mr-3">{getButtons()}</div>
146	        </div>
147	      )}
148	    </>
149	  )
150	}
151
152	export default ViewIncidentDetails
153	


bash
command
grep -r "isError\|error\|status" /tmp/inputs/hospitalrun-frontend/src/patients/hooks --include="*.tsx" --include="*.ts" | head -30
output
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx:  const error = validateDiagnosis(request.diagnosis)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx:  const error = validateAllergy(request.allergy)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx:  const error = validateCarePlan(request.carePlan)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx:  error.message = 'patient.carePlan.error.unableToAdd'
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx:  const error = validateNote(request.note)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx:  const error = validateVisit(request.visit)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx:  error.message = 'patient.visits.error.unableToAdd'
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx:  const error = validateCareGoal(request.careGoal)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx:  error.message = 'patient.careGoal.error.unableToAdd'
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx:  throw error
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx:  const error = validateRelatedPerson(request.relatedPerson)
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx:  if (isEmpty(error)) {
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx:  throw error


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { queryCache, useMutation } from 'react-query'
3
4	import PatientRepository from '../../shared/db/PatientRepository'
5	import Diagnosis from '../../shared/model/Diagnosis'
6	import { uuid } from '../../shared/util/uuid'
7	import validateDiagnosis from '../util/validate-diagnosis'
8
9	interface AddDiagnosisRequest {
10	  patientId: string
11	  diagnosis: Omit<Diagnosis, 'id'>
12	}
13
14	async function addDiagnosis(request: AddDiagnosisRequest): Promise<Diagnosis[]> {
15	  const error = validateDiagnosis(request.diagnosis)
16	  if (isEmpty(error)) {
17	    const patient = await PatientRepository.find(request.patientId)
18	    const diagnoses = patient.diagnoses ? [...patient.diagnoses] : []
19	    const newDiagnosis: Diagnosis = {
20	      id: uuid(),
21	      ...request.diagnosis,
22	    }
23	    diagnoses.push(newDiagnosis)
24	    await PatientRepository.saveOrUpdate({ ...patient, diagnoses })
25	    return diagnoses
26	  }
27	  throw error
28	}
29
30	export default function useAddPatientDiagnosis() {
31	  return useMutation(addDiagnosis, {
32	    onSuccess: async (data, variables) => {
33	      await queryCache.setQueryData(['diagnoses', variables.patientId], data)
34	    },
35	    throwOnError: true,
36	  })
37	}
38	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/AddDiagnosisModal.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/AddDiagnosisModal.tsx with line numbers:
1	import { Modal } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3
4	import useTranslator from '../../shared/hooks/useTranslator'
5	import Diagnosis, { DiagnosisStatus } from '../../shared/model/Diagnosis'
6	import Patient from '../../shared/model/Patient'
7	import useAddPatientDiagnosis from '../hooks/useAddPatientDiagnosis'
8	import { DiagnosisError } from '../util/validate-diagnosis'
9	import DiagnosisForm from './DiagnosisForm'
10
11	interface NewDiagnosisModalProps {
12	  patient: Patient
13	  show: boolean
14	  onCloseButtonClick: () => void
15	}
16
17	const initialDiagnosisState = {
18	  name: '',
19	  diagnosisDate: new Date().toISOString(),
20	  onsetDate: new Date().toISOString(),
21	  abatementDate: new Date().toISOString(),
22	  note: '',
23	  visit: '',
24	  status: DiagnosisStatus.Active,
25	}
26
27	const AddDiagnosisModal = (props: NewDiagnosisModalProps) => {
28	  const { show, onCloseButtonClick, patient } = props
29	  const { t } = useTranslator()
30	  const [mutate] = useAddPatientDiagnosis()
31
32	  const [diagnosis, setDiagnosis] = useState(initialDiagnosisState)
33	  const [diagnosisError, setDiagnosisError] = useState<DiagnosisError | undefined>(undefined)
34	  useEffect(() => {
35	    setDiagnosis(initialDiagnosisState)
36	  }, [show])
37
38	  const onDiagnosisChange = (newDiagnosis: Partial<Diagnosis>) => {
39	    setDiagnosis(newDiagnosis as Diagnosis)
40	  }
41	  const onSaveButtonClick = async () => {
42	    try {
43	      await mutate({ diagnosis, patientId: patient.id })
44	      onCloseButtonClick()
45	    } catch (e) {
46	      setDiagnosisError(e)
47	    }
48	  }
49
50	  const body = (
51	    <DiagnosisForm
52	      diagnosis={diagnosis}
53	      diagnosisError={diagnosisError}
54	      onChange={onDiagnosisChange}
55	      patient={patient}
56	    />
57	  )
58	  return (
59	    <Modal
60	      show={show}
61	      toggle={onCloseButtonClick}
62	      title={t('patient.diagnoses.new')}
63	      body={body}
64	      closeButton={{
65	        children: t('actions.cancel'),
66	        color: 'danger',
67	        onClick: onCloseButtonClick,
68	      }}
69	      successButton={{
70	        children: t('patient.diagnoses.new'),
71	        color: 'success',
72	        icon: 'add',
73	        iconLocation: 'left',
74	        onClick: onSaveButtonClick,
75	      }}
76	    />
77	  )
78	}
79
80	export default AddDiagnosisModal
81	

Let me also look at the localization files for error messages:

bash
command
grep -r "error" /tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs --include="*.ts" | head -40
output
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/incidents/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/imagings/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/states/index.ts:    error: 'Error!',
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts:    errors: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/user/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/scheduling/index.ts:      errors: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/medications/index.ts:      error: {
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/labs/index.ts:      error: {


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts
view_range
[1, 100]
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts with line numbers (which has a total of 243 lines) with view_range=[1, 100]:
1	export default {
2	  patient: {
3	    label: 'Patient',
4	    code: 'Patient Code',
5	    firstName: 'First Name',
6	    lastName: 'Last Name',
7	    suffix: 'Suffix',
8	    prefix: 'Prefix',
9	    givenName: 'Given Name',
10	    familyName: 'Family Name',
11	    dateOfBirth: 'Date of Birth',
12	    approximateDateOfBirth: 'Approximate Date of Birth',
13	    age: 'Age',
14	    approximateAge: 'Approximate Age',
15	    placeOfBirth: 'Place of Birth',
16	    sex: 'Sex',
17	    bloodType: 'Blood Type',
18	    contactInfoType: {
19	      label: 'Type',
20	      options: {
21	        home: 'Home',
22	        mobile: 'Mobile',
23	        work: 'Work',
24	        temporary: 'Temporary',
25	        old: 'Old',
26	      },
27	    },
28	    phoneNumber: 'Phone Number',
29	    email: 'Email',
30	    address: 'Address',
31	    occupation: 'Occupation',
32	    type: 'Patient Type',
33	    preferredLanguage: 'Preferred Language',
34	    basicInformation: 'Basic Information',
35	    generalInformation: 'General Information',
36	    contactInformation: 'Contact Information',
37	    unknownDateOfBirth: 'Unknown',
38	    relatedPerson: 'Related Person',
39	    relatedPersons: {
40	      error: {
41	        unableToAddRelatedPerson: 'Unable to add new related person.',
42	        relatedPersonRequired: 'Related Person is required.',
43	        relationshipTypeRequired: 'Relationship Type is required.',
44	      },
45	      label: 'Related Persons',
46	      new: 'New Related Person',
47	      add: 'Add Related Person',
48	      relationshipType: 'Relationship Type',
49	      warning: {
50	        noRelatedPersons: 'No related persons',
51	      },
52	      addRelatedPersonAbove: 'Add a related person using the button above.',
53	    },
54	    appointments: {
55	      new: 'Add Appointment',
56	      warning: {
57	        noAppointments: 'No Appointments',
58	      },
59	      addAppointmentAbove: 'Add an appointment using the button above.',
60	    },
61	    allergies: {
62	      label: 'Allergies',
63	      allergyName: 'Allergy Name',
64	      new: 'Add Allergy',
65	      error: {
66	        nameRequired: 'Name is required.',
67	        unableToAdd: 'Unable to add allergy.',
68	      },
69	      warning: {
70	        noAllergies: 'No Allergies',
71	      },
72	      addAllergyAbove: 'Add an allergy using the button above.',
73	      successfullyAdded: 'Successfully added a new allergy!',
74	    },
75	    diagnoses: {
76	      label: 'Diagnoses',
77	      new: 'Add Diagnosis',
78	      diagnosisName: 'Name',
79	      diagnosisDate: 'Date',
80	      onsetDate: 'Onset Date',
81	      abatementDate: 'Abatement Date',
82	      visit: 'Visit',
83	      status: 'Status',
84	      active: 'Active',
85	      recurrence: 'Recurrence',
86	      relapse: 'Relapse',
87	      inactive: 'Inactive',
88	      remission: 'Remission',
89	      resolved: 'Resolved',
90	      note: 'Note',
91	      warning: {
92	        noDiagnoses: 'No Diagnoses',
93	      },
94	      error: {
95	        nameRequired: 'Diagnosis Name is required.',
96	        dateRequired: 'Diagnosis Date is required.',
97	        unableToAdd: 'Unable to add new diagnosis',
98	      },
99	      addDiagnosisAbove: 'Add a diagnosis using the button above.',
100	      successfullyAdded: 'Successfully added a new diagnosis!',



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts
view_range
[200, 243]
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/locales/enUs/translations/patient/index.ts with line numbers (which has a total of 243 lines) with view_range=[200, 243]:
200	    },
201	    visits: {
202	      new: 'Add Visit',
203	      label: 'Visits',
204	      startDateTime: 'Start Date',
205	      endDateTime: 'End Date',
206	      type: 'Type',
207	      status: 'Status',
208	      reason: 'Reason',
209	      location: 'Location',
210	      error: {
211	        unableToAdd: 'Unable to add a new visit.',
212	        startDateRequired: 'Start date is required.',
213	        endDateRequired: 'End date is required',
214	        endDateMustBeAfterStartDate: 'End date must be after start date',
215	        typeRequired: 'Type is required.',
216	        statusRequired: 'Status is required.',
217	        reasonRequired: 'Reason is required.',
218	        locationRequired: 'Location is required.',
219	      },
220	      warning: {
221	        noVisits: 'No Visits',
222	        addVisitAbove: 'Add a visit using the button above.',
223	      },
224	    },
225	    types: {
226	      charity: 'Charity',
227	      private: 'Private',
228	    },
229	    errors: {
230	      createPatientError: 'Could not create new patient.',
231	      updatePatientError: 'Could not update patient.',
232	      patientGivenNameFeedback: 'Given Name is required.',
233	      patientDateOfBirthFeedback: 'Date of Birth can not be greater than today',
234	      patientNumInSuffixFeedback: 'Cannot contain numbers.',
235	      patientNumInPrefixFeedback: 'Cannot contain numbers.',
236	      patientNumInFamilyNameFeedback: 'Cannot contain numbers.',
237	      patientNumInPreferredLanguageFeedback: 'Cannot contain numbers.',
238	      invalidEmail: 'Must be a valid email.',
239	      invalidPhoneNumber: 'Must be a valid phone number.',
240	    },
241	  },
242	}
243	


bash
command
find /tmp/inputs/hospitalrun-frontend/src -name "*.tsx" | xargs grep -l "catch\|try" | grep -v "__tests__" | head -20
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidentsTable.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/ContactInfo.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useDiagnosis.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/notes/NewNoteModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/AddDiagnosisModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/AddCareGoalModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/AddCarePlanModal.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/visits/AddVisitModal.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx with line numbers:
1	import { Modal, Alert } from '@hospitalrun/components'
2	import React, { useState, useEffect } from 'react'
3
4	import TextInputWithLabelFormGroup from '../../shared/components/input/TextInputWithLabelFormGroup'
5	import useTranslator from '../../shared/hooks/useTranslator'
6	import useAddAllergy from '../hooks/useAddAllergy'
7	import { AllergyError } from '../util/validate-allergy'
8
9	interface NewAllergyModalProps {
10	  patientId: string
11	  show: boolean
12	  onCloseButtonClick: () => void
13	}
14
15	const NewAllergyModal = (props: NewAllergyModalProps) => {
16	  const { show, onCloseButtonClick, patientId } = props
17	  const { t } = useTranslator()
18	  const [mutate] = useAddAllergy()
19
20	  const [allergy, setAllergy] = useState({ name: '' })
21	  const [allergyError, setAllergyError] = useState<AllergyError | undefined>(undefined)
22
23	  useEffect(() => {
24	    setAllergy({ name: '' })
25	  }, [show])
26
27	  const onNameChange = (event: React.ChangeEvent<HTMLInputElement>) => {
28	    const name = event.target.value
29	    setAllergy((prevAllergy) => ({ ...prevAllergy, name }))
30	  }
31
32	  const onSaveButtonClick = async () => {
33	    try {
34	      await mutate({ patientId, allergy })
35	      onCloseButtonClick()
36	    } catch (e) {
37	      setAllergyError(e)
38	    }
39	  }
40
41	  const onClose = () => {
42	    onCloseButtonClick()
43	  }
44
45	  const body = (
46	    <>
47	      {allergyError && (
48	        <Alert
49	          color="danger"
50	          title={t('states.error')}
51	          message={t('patient.allergies.error.unableToAdd')}
52	        />
53	      )}
54	      <form>
55	        <TextInputWithLabelFormGroup
56	          name="name"
57	          isRequired
58	          label={t('patient.allergies.allergyName')}
59	          isEditable
60	          placeholder={t('patient.allergies.allergyName')}
61	          value={allergy.name}
62	          onChange={onNameChange}
63	          feedback={t(allergyError?.nameError || '')}
64	          isInvalid={!!allergyError?.nameError}
65	        />
66	      </form>
67	    </>
68	  )
69
70	  return (
71	    <Modal
72	      show={show}
73	      toggle={onClose}
74	      title={t('patient.allergies.new')}
75	      body={body}
76	      closeButton={{
77	        children: t('actions.cancel'),
78	        color: 'danger',
79	        onClick: onClose,
80	      }}
81	      successButton={{
82	        children: t('patient.allergies.new'),
83	        color: 'success',
84	        icon: 'add',
85	        iconLocation: 'left',
86	        onClick: onSaveButtonClick,
87	      }}
88	    />
89	  )
90	}
91
92	export default NewAllergyModal
93	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/input
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/shared/components/input, excluding hidden items and node_modules:
8.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/DatePickerWithLabelFormGroup.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/DateTimePickerWithLabelFormGroup.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/LanguageSelector.tsx
512	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/SelectOption.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextFieldWithLabelFormGroup.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextInputWithLabelFormGroup.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/shared/components/input/index.tsx



str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextInputWithLabelFormGroup.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/shared/components/input/TextInputWithLabelFormGroup.tsx with line numbers:
1	import { TextInput, Label } from '@hospitalrun/components'
2	import React from 'react'
3
4	interface Props {
5	  value: string
6	  label?: string
7	  name: string
8	  isEditable?: boolean
9	  type: 'text' | 'email' | 'number' | 'tel' | 'password'
10	  placeholder?: string
11	  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void
12	  isRequired?: boolean
13	  feedback?: string
14	  isInvalid?: boolean
15	}
16
17	const TextInputWithLabelFormGroup = (props: Props) => {
18	  const {
19	    value,
20	    label,
21	    name,
22	    isEditable,
23	    onChange,
24	    placeholder,
25	    type,
26	    isRequired,
27	    feedback,
28	    isInvalid,
29	  } = props
30	  const id = `${name}TextInput`
31	  return (
32	    <div className="form-group">
33	      {label && <Label text={label} htmlFor={id} isRequired={isRequired} />}
34	      <TextInput
35	        feedback={feedback}
36	        id={id}
37	        isInvalid={isInvalid}
38	        value={value}
39	        disabled={!isEditable}
40	        onChange={onChange}
41	        type={type}
42	        placeholder={placeholder || label}
43	      />
44	    </div>
45	  )
46	}
47
48	TextInputWithLabelFormGroup.defaultProps = {
49	  value: '',
50	  type: 'text',
51	}
52
53	export default TextInputWithLabelFormGroup
54	


bash
command
grep -r "Context\|createContext\|useContext" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" --include="*.ts" -l | grep -v "__tests__"
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/report/ReportIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/list/ViewIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/visualize/VisualizeIncidents.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ViewImagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
/tmp/inputs/hospitalrun-frontend/src/dashboard/Dashboard.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/ViewAppointments.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/new/NewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/edit/EditAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/search/ViewMedications.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/requests/NewMedicationRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/settings/Settings.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLabs.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
/tmp/inputs/hospitalrun-frontend/src/labs/requests/NewLabRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/view/ViewPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/edit/EditPatient.tsx
/tmp/inputs/hospitalrun-frontend/src/patients/search/ViewPatients.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/page-header/title/TitleContext.tsx with line numbers:
1	import * as React from 'react'
2
3	type SetTitle = (title: string) => void
4	type State = { title: string }
5	type TitleProviderProps = { children: React.ReactNode }
6	const TitleStateContext = React.createContext<State | undefined>(undefined)
7	const TitleDispatchContext = React.createContext<SetTitle | undefined>(undefined)
8
9	function TitleProvider({ children }: TitleProviderProps) {
10	  const [title, setTitle] = React.useState('')
11	  return (
12	    <TitleStateContext.Provider value={{ title }}>
13	      <TitleDispatchContext.Provider value={setTitle}>{children}</TitleDispatchContext.Provider>
14	    </TitleStateContext.Provider>
15	  )
16	}
17	function useTitle() {
18	  const context = React.useContext(TitleStateContext)
19	  if (context === undefined) {
20	    throw new Error('useTitle must be used within a TitleProvider')
21	  }
22	  return context
23	}
24	function useUpdateTitle() {
25	  const context = React.useContext(TitleDispatchContext)
26	  if (context === undefined) {
27	    throw new Error('useUpdateTitle must be used within a TitleProvider')
28	  }
29	  return context
30	}
31	export { TitleProvider, useTitle, useUpdateTitle }
32	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/page-header/button-toolbar/ButtonBarProvider.tsx with line numbers:
1	import React, { useState } from 'react'
2
3	type Props = {
4	  children?: React.ReactNode
5	}
6
7	type ButtonUpdater = (buttons: React.ReactNode[]) => void
8
9	const ButtonBarStateContext = React.createContext<React.ReactNode[]>([])
10	const ButtonBarUpdateContext = React.createContext<ButtonUpdater>(() => {
11	  // empty initial state
12	})
13
14	function ButtonBarProvider(props: Props) {
15	  const { children } = props
16	  const [state, setState] = useState<React.ReactNode[]>([])
17	  return (
18	    <ButtonBarStateContext.Provider value={state}>
19	      <ButtonBarUpdateContext.Provider value={setState}>{children}</ButtonBarUpdateContext.Provider>
20	    </ButtonBarStateContext.Provider>
21	  )
22	}
23	function useButtons() {
24	  const context = React.useContext(ButtonBarStateContext)
25	  if (context === undefined) {
26	    throw new Error('useButtons must be used within a Button Bar Context')
27	  }
28	  return context
29	}
30	function useButtonToolbarSetter() {
31	  const context = React.useContext(ButtonBarUpdateContext)
32	  if (context === undefined) {
33	    throw new Error('useButtonToolBarSetter must be used within a Button Bar Context')
34	  }
35	  return context
36	}
37
38	export { ButtonBarProvider, useButtons, useButtonToolbarSetter }
39	


bash
command
grep -r "useSelector\|useDispatch" /tmp/inputs/hospitalrun-frontend/src --include="*.tsx" -l | grep -v "__tests__" | head -15
output
/tmp/inputs/hospitalrun-frontend/src/App.tsx
/tmp/inputs/hospitalrun-frontend/src/HospitalRun.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/Incidents.tsx
/tmp/inputs/hospitalrun-frontend/src/incidents/view/ViewIncident.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/Imagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/search/ViewImagings.tsx
/tmp/inputs/hospitalrun-frontend/src/imagings/requests/NewImagingRequest.tsx
/tmp/inputs/hospitalrun-frontend/src/page-header/breadcrumbs/Breadcrumbs.tsx
/tmp/inputs/hospitalrun-frontend/src/shared/components/Sidebar.tsx
/tmp/inputs/hospitalrun-frontend/src/shared/components/navbar/Navbar.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/Appointments.tsx
/tmp/inputs/hospitalrun-frontend/src/scheduling/appointments/view/ViewAppointment.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/ViewMedication.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/Medications.tsx
/tmp/inputs/hospitalrun-frontend/src/medications/search/ViewMedications.tsx


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/patients
output
Here're the files and directories up to 2 levels deep in /tmp/inputs/hospitalrun-frontend/src/patients, excluding hidden items and node_modules:
192K	/tmp/inputs/hospitalrun-frontend/src/patients
4.5K	/tmp/inputs/hospitalrun-frontend/src/patients/ContactInfo.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/ContactInfoTypes.ts
11K	/tmp/inputs/hospitalrun-frontend/src/patients/GeneralInformation.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/Patients.tsx
7.0K	/tmp/inputs/hospitalrun-frontend/src/patients/allergies
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/allergies/Allergies.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/allergies/AllergiesList.tsx
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/allergies/NewAllergyModal.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/allergies/ViewAllergy.tsx
3.5K	/tmp/inputs/hospitalrun-frontend/src/patients/appointments
3.5K	/tmp/inputs/hospitalrun-frontend/src/patients/appointments/AppointmentsList.tsx
15K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/AddCareGoalModal.tsx
7.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalForm.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalTab.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/CareGoalTable.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/ViewCareGoal.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/care-goals/ViewCareGoals.tsx
15K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/AddCarePlanModal.tsx
7.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/CarePlanForm.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/CarePlanTab.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/CarePlanTable.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/ViewCarePlan.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/care-plans/ViewCarePlans.tsx
15K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/AddDiagnosisModal.tsx
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/Diagnoses.tsx
6.0K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/DiagnosisForm.tsx
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/DiagnosisTable.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/ViewDiagnoses.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/diagnoses/ViewDiagnosis.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/patients/edit
3.0K	/tmp/inputs/hospitalrun-frontend/src/patients/edit/EditPatient.tsx
6.0K	/tmp/inputs/hospitalrun-frontend/src/patients/history
512	/tmp/inputs/hospitalrun-frontend/src/patients/history/HistoryTab.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/history/HistoryTable.tsx
3.5K	/tmp/inputs/hospitalrun-frontend/src/patients/history/mappers
25K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddAllergy.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCareGoal.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddCarePlan.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientDiagnosis.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientNote.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddPatientRelatedPerson.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAddVisit.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useAllergy.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCareGoal.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useCarePlan.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useDiagnosis.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatient.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientAllergies.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientAppointments.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientCareGoals.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientCarePlans.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientDiagnoses.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientLabs.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientMedications.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientNote.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientNotes.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientRelatedPersons.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatientVisits.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/usePatients.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useRemovePatientRelatedPerson.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/hooks/useVisit.tsx
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/labs
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/labs/Labs.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/labs/LabsList.tsx
3.0K	/tmp/inputs/hospitalrun-frontend/src/patients/medications
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/medications/Medications.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/medications/MedicationsList.tsx
512	/tmp/inputs/hospitalrun-frontend/src/patients/models
512	/tmp/inputs/hospitalrun-frontend/src/patients/models/PatientSearchRequest.tsx
6.0K	/tmp/inputs/hospitalrun-frontend/src/patients/new
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/new/DuplicateNewPatientModal.tsx
4.0K	/tmp/inputs/hospitalrun-frontend/src/patients/new/NewPatient.tsx
7.5K	/tmp/inputs/hospitalrun-frontend/src/patients/notes
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/notes/NewNoteModal.tsx
2.5K	/tmp/inputs/hospitalrun-frontend/src/patients/notes/NoteTab.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/notes/NotesList.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/notes/ViewNote.tsx
5.0K	/tmp/inputs/hospitalrun-frontend/src/patients/patient-slice.ts
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/patients-slice.ts
8.5K	/tmp/inputs/hospitalrun-frontend/src/patients/related-persons
4.5K	/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/AddRelatedPersonModal.tsx
4.0K	/tmp/inputs/hospitalrun-frontend/src/patients/related-persons/RelatedPersonTab.tsx
7.0K	/tmp/inputs/hospitalrun-frontend/src/patients/search
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/search/NoPatientsExist.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/search/PatientSearchInput.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/search/SearchPatients.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/search/ViewPatients.tsx
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/search/ViewPatientsTable.tsx
16K	/tmp/inputs/hospitalrun-frontend/src/patients/util
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/is-possible-duplicate-patient.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/patient-util.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/set-patient-helper.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/timestamp-id-generator.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-allergy.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-caregoal.ts
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-careplan.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-diagnosis.ts
512	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-note.ts
3.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-patient.ts
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-related-person.ts
1.5K	/tmp/inputs/hospitalrun-frontend/src/patients/util/validate-visit.ts
16K	/tmp/inputs/hospitalrun-frontend/src/patients/view
8.5K	/tmp/inputs/hospitalrun-frontend/src/patients/view/ImportantPatientInfo.tsx
7.0K	/tmp/inputs/hospitalrun-frontend/src/patients/view/ViewPatient.tsx
12K	/tmp/inputs/hospitalrun-frontend/src/patients/visits
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/visits/AddVisitModal.tsx
1.0K	/tmp/inputs/hospitalrun-frontend/src/patients/visits/ViewVisit.tsx
5.0K	/tmp/inputs/hospitalrun-frontend/src/patients/visits/VisitForm.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/visits/VisitTab.tsx
2.0K	/tmp/inputs/hospitalrun-frontend/src/patients/visits/VisitTable.tsx


Let me look at a few more files to understand the patterns better:

str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCompleteLab.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/hooks/useCompleteLab.ts with line numbers:
1	import isEmpty from 'lodash/isEmpty'
2	import { useMutation, queryCache } from 'react-query'
3
4	import LabRepository from '../../shared/db/LabRepository'
5	import Lab from '../../shared/model/Lab'
6	import { validateLabComplete } from '../utils/validate-lab'
7
8	function completeLab(lab: Lab): Promise<Lab> {
9	  const completeLabErrors = validateLabComplete(lab)
10
11	  if (isEmpty(completeLabErrors)) {
12	    const completedLab: Lab = {
13	      ...lab,
14	      completedOn: new Date(Date.now().valueOf()).toISOString(),
15	      status: 'completed',
16	    }
17
18	    return LabRepository.saveOrUpdate(completedLab)
19	  }
20
21	  throw completeLabErrors
22	}
23
24	export default function useCompleteLab() {
25	  return useMutation(completeLab, {
26	    onSuccess: async (data) => {
27	      queryCache.setQueryData(['lab', data.id], data)
28	      await queryCache.invalidateQueries('labs')
29	    },
30	    throwOnError: true,
31	  })
32	}
33	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/labs/ViewLab.tsx with line numbers:
1	import { Row, Column, Badge, Button, Alert, Toast, Callout, Label } from '@hospitalrun/components'
2	import format from 'date-fns/format'
3	import React, { useEffect, useState } from 'react'
4	import { useSelector } from 'react-redux'
5	import { useParams, useHistory } from 'react-router-dom'
6
7	import useAddBreadcrumbs from '../page-header/breadcrumbs/useAddBreadcrumbs'
8	import { useUpdateTitle } from '../page-header/title/TitleContext'
9	import usePatient from '../patients/hooks/usePatient'
10	import TextFieldWithLabelFormGroup from '../shared/components/input/TextFieldWithLabelFormGroup'
11	import useTranslator from '../shared/hooks/useTranslator'
12	import Lab from '../shared/model/Lab'
13	import Patient from '../shared/model/Patient'
14	import Permissions from '../shared/model/Permissions'
15	import { RootState } from '../shared/store'
16	import { uuid } from '../shared/util/uuid'
17	import useCancelLab from './hooks/useCancelLab'
18	import useCompleteLab from './hooks/useCompleteLab'
19	import useLab from './hooks/useLab'
20	import useUpdateLab from './hooks/useUpdateLab'
21	import { LabError } from './utils/validate-lab'
22
23	const getTitle = (patient: Patient | undefined, lab: Lab | undefined) =>
24	  patient && lab ? `${lab.type} for ${patient.fullName}(${lab.code})` : ''
25
26	const ViewLab = () => {
27	  const { id } = useParams()
28	  const { t } = useTranslator()
29	  const history = useHistory()
30	  const { permissions } = useSelector((state: RootState) => state.user)
31
32	  const [labToView, setLabToView] = useState<Lab>()
33	  const [newNoteText, setNewNoteText] = useState<string>()
34	  const [isEditable, setIsEditable] = useState<boolean>(true)
35
36	  const { data: lab } = useLab(id)
37	  const { data: patient } = usePatient(lab?.patient)
38	  const [updateLab] = useUpdateLab()
39	  const [completeLab] = useCompleteLab()
40	  const [cancelLab] = useCancelLab()
41	  const [error, setError] = useState<LabError | undefined>(undefined)
42
43	  const updateTitle = useUpdateTitle()
44	  useEffect(() => {
45	    updateTitle(getTitle(patient, labToView))
46	  })
47
48	  const breadcrumbs = [
49	    {
50	      i18nKey: 'labs.requests.view',
51	      location: `/labs/${labToView?.id}`,
52	    },
53	  ]
54	  useAddBreadcrumbs(breadcrumbs)
55
56	  useEffect(() => {
57	    if (lab) {
58	      setLabToView({ ...lab })
59	      setIsEditable(lab.status === 'requested')
60	    }
61	  }, [lab])
62
63	  const onResultChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
64	    const result = event.currentTarget.value
65	    const newLab = labToView as Lab
66	    setLabToView({ ...newLab, result })
67	  }
68
69	  const onNotesChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
70	    const notes = event.currentTarget.value
71	    setNewNoteText(notes)
72	  }
73
74	  const deleteNote = async (noteIdToDelete: string) => {
75	    if (!labToView || !labToView.notes) {
76	      return
77	    }
78
79	    const updatedNotes = labToView!.notes!.map((note) => {
80	      if (note.id === noteIdToDelete) {
81	        note.deleted = true
82	      }
83
84	      return note
85	    })
86
87	    const newLab = {
88	      ...labToView,
89	      notes: updatedNotes,
90	    }
91
92	    await updateLab(newLab as Lab)
93	    Toast('success', t('states.success'), t('labs.successfullyDeletedNote'))
94	  }
95
96	  const onUpdate = async () => {
97	    if (labToView) {
98	      const newLab = labToView as Lab
99
100	      if (newNoteText) {
101	        const newNote = {
102	          id: uuid(),
103	          date: new Date().toISOString(),
104	          text: newNoteText,
105	          deleted: false,
106	        }
107
108	        newLab.notes = newLab.notes ? [...newLab.notes, newNote] : [newNote]
109	        setNewNoteText('')
110	      }
111
112	      const updatedLab = await updateLab(newLab)
113	      history.push(`/labs/${updatedLab?.id}`)
114	      Toast(
115	        'success',
116	        t('states.success'),
117	        `${t('labs.successfullyUpdated')} ${updatedLab?.type} for ${patient?.fullName}`,
118	      )
119	    }
120	    setError(undefined)
121	  }
122
123	  const onComplete = async () => {
124	    try {
125	      if (labToView) {
126	        const completedLab = await completeLab(labToView)
127	        history.push(`/labs/${completedLab?.id}`)
128	        Toast(
129	          'success',
130	          t('states.success'),
131	          `${t('labs.successfullyCompleted')} ${completedLab?.type} for ${patient?.fullName} `,
132	        )
133	      }
134	      setError(undefined)
135	    } catch (e) {
136	      setError(e)
137	    }
138	  }
139
140	  const onCancel = async () => {
141	    if (labToView) {
142	      cancelLab(labToView)
143	      history.push('/labs')
144	    }
145	  }
146
147	  const getButtons = () => {
148	    const buttons: React.ReactNode[] = []
149	    if (labToView?.status === 'completed' || labToView?.status === 'canceled') {
150	      return buttons
151	    }
152
153	    buttons.push(
154	      <Button className="mr-2" color="success" onClick={onUpdate} key="actions.update">
155	        {t('labs.requests.update')}
156	      </Button>,
157	    )
158
159	    if (permissions.includes(Permissions.CompleteLab)) {
160	      buttons.push(
161	        <Button className="mr-2" onClick={onComplete} color="primary" key="labs.requests.complete">
162	          {t('labs.requests.complete')}
163	        </Button>,
164	      )
165	    }
166
167	    if (permissions.includes(Permissions.CancelLab)) {
168	      buttons.push(
169	        <Button onClick={onCancel} color="danger" key="labs.requests.cancel">
170	          {t('labs.requests.cancel')}
171	        </Button>,
172	      )
173	    }
174
175	    return buttons
176	  }
177
178	  if (labToView && patient) {
179	    const getBadgeColor = () => {
180	      if (labToView.status === 'completed') {
181	        return 'primary'
182	      }
183	      if (labToView.status === 'canceled') {
184	        return 'danger'
185	      }
186	      return 'warning'
187	    }
188
189	    const getCanceledOnOrCompletedOnDate = () => {
190	      if (labToView.status === 'completed' && labToView.completedOn) {
191	        return (
192	          <Column>
193	            <div className="form-group completed-on">
194	              <h4>{t('labs.lab.completedOn')}</h4>
195	              <h5>{format(new Date(labToView.completedOn), 'yyyy-MM-dd hh:mm a')}</h5>
196	            </div>
197	          </Column>
198	        )
199	      }
200	      if (labToView.status === 'canceled' && labToView.canceledOn) {
201	        return (
202	          <Column>
203	            <div className="form-group canceled-on">
204	              <h4>{t('labs.lab.canceledOn')}</h4>
205	              <h5>{format(new Date(labToView.canceledOn), 'yyyy-MM-dd hh:mm a')}</h5>
206	            </div>
207	          </Column>
208	        )
209	      }
210	      return <></>
211	    }
212
213	    const getPastNotes = () => {
214	      if (labToView?.notes?.length && labToView.notes.length > 0) {
215	        return labToView.notes
216	          .filter((note) => !note.deleted)
217	          .map((note) => (
218	            <Callout key={note.id} color="info">
219	              <div className="d-flex justify-content-between">
220	                <p data-testid="note">{note.text}</p>
221	                {labToView.status === 'requested' && (
222	                  <Button icon="remove" onClick={async () => deleteNote(note.id)} color="danger">
223	                    <span data-testid={`delete-note-${note.id}`}>Delete</span>
224	                  </Button>
225	                )}
226	              </div>
227	            </Callout>
228	          ))
229	      }
230
231	      return <></>
232	    }
233
234	    return (
235	      <>
236	        {error && (
237	          <Alert color="danger" title={t('states.error')} message={t(error.message || '')} />
238	        )}
239	        <Row>
240	          <Column>
241	            <div className="form-group lab-status">
242	              <h4>{t('labs.lab.status')}</h4>
243	              <Badge color={getBadgeColor()}>
244	                <h5>{labToView.status}</h5>
245	              </Badge>
246	            </div>
247	          </Column>
248	          <Column>
249	            <div className="form-group for-patient">
250	              <h4>{t('labs.lab.for')}</h4>
251	              <h5>{patient.fullName}</h5>
252	            </div>
253	          </Column>
254	          <Column>
255	            <div className="form-group lab-type">
256	              <h4>{t('labs.lab.type')}</h4>
257	              <h5>{labToView.type}</h5>
258	            </div>
259	          </Column>
260	          <Column>
261	            <div className="form-group requested-on">
262	              <h4>{t('labs.lab.requestedOn')}</h4>
263	              <h5>{format(new Date(labToView.requestedOn), 'yyyy-MM-dd hh:mm a')}</h5>
264	            </div>
265	          </Column>
266	          {getCanceledOnOrCompletedOnDate()}
267	        </Row>
268	        <div className="border-bottom" />
269	        <form>
270	          <TextFieldWithLabelFormGroup
271	            name="result"
272	            label={t('labs.lab.result')}
273	            value={labToView.result}
274	            isEditable={isEditable}
275	            isInvalid={!!error?.result}
276	            feedback={t(error?.result as string)}
277	            onChange={onResultChange}
278	          />
279	          <Label text={t('labs.lab.notes')} htmlFor="notesTextField" />
280	          {getPastNotes()}
281	          {isEditable && (
282	            <TextFieldWithLabelFormGroup
283	              name="notes"
284	              value={newNoteText}
285	              isEditable={isEditable}
286	              onChange={onNotesChange}
287	            />
288	          )}
289	          {isEditable && (
290	            <div className="row float-right">
291	              <div className="btn-group btn-group-lg mt-3 mr-3">{getButtons()}</div>
292	            </div>
293	          )}
294	        </form>
295	      </>
296	    )
297	  }
298	  return <h1>Loading...</h1>
299	}
300
301	export default ViewLab
302	


str_replace_based_edit_tool
command
view
path
/tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts
output
Here's the content of /tmp/inputs/hospitalrun-frontend/src/user/user-slice.ts with line numbers:
1	/* eslint-disable no-underscore-dangle */
2	import { createSlice, PayloadAction } from '@reduxjs/toolkit'
3
4	import { remoteDb } from '../shared/config/pouchdb'
5	import Permissions from '../shared/model/Permissions'
6	import User from '../shared/model/User'
7	import { AppThunk } from '../shared/store'
8
9	export interface LoginError {
10	  message?: string
11	  username?: string
12	  password?: string
13	}
14
15	export interface UserState {
16	  permissions: (Permissions | null)[]
17	  user?: User
18	  loginError?: LoginError
19	}
20
21	const initialState: UserState = {
22	  user: {
23	    givenName: 'HospitalRun',
24	    familyName: 'Test',
25	    fullName: 'HospitalRun Test',
26	    id: 'test-hospitalrun',
27	  },
28	  permissions: [
29	    Permissions.ReadPatients,
30	    Permissions.WritePatients,
31	    Permissions.ReadAppointments,
32	    Permissions.WriteAppointments,
33	    Permissions.DeleteAppointment,
34	    Permissions.AddAllergy,
35	    Permissions.AddDiagnosis,
36	    Permissions.ViewLabs,
37	    Permissions.ViewLab,
38	    Permissions.RequestLab,
39	    Permissions.CompleteLab,
40	    Permissions.CancelLab,
41	    Permissions.ViewIncident,
42	    Permissions.ViewIncidents,
43	    Permissions.ReportIncident,
44	    Permissions.ResolveIncident,
45	    Permissions.ViewIncidentWidgets,
46	    Permissions.AddCarePlan,
47	    Permissions.ReadCarePlan,
48	    Permissions.AddCareGoal,
49	    Permissions.ReadCareGoal,
50	    Permissions.RequestMedication,
51	    Permissions.CompleteMedication,
52	    Permissions.CancelMedication,
53	    Permissions.ViewMedications,
54	    Permissions.ViewMedication,
55	    Permissions.AddVisit,
56	    Permissions.ReadVisits,
57	    Permissions.ViewImagings,
58	    Permissions.RequestImaging,
59	  ],
60	}
61
62	const userSlice = createSlice({
63	  name: 'user',
64	  initialState,
65	  reducers: {
66	    fetchPermissions(state, { payload }: PayloadAction<Permissions[]>) {
67	      state.permissions = payload
68	    },
69	    loginSuccess(
70	      state,
71	      { payload }: PayloadAction<{ user: User; permissions: (Permissions | null)[] }>,
72	    ) {
73	      state.user = payload.user
74	      state.permissions = initialState.permissions
75	    },
76	    loginError(state, { payload }: PayloadAction<LoginError>) {
77	      state.loginError = payload
78	    },
79	    logoutSuccess(state) {
80	      state.user = undefined
81	      state.permissions = []
82	    },
83	  },
84	})
85
86	export const { fetchPermissions, loginError, loginSuccess, logoutSuccess } = userSlice.actions
87
88	export const getCurrentSession = (username: string): AppThunk => async (dispatch) => {
89	  const user = await remoteDb.getUser(username)
90	  dispatch(
91	    loginSuccess({
92	      user: {
93	        id: user._id,
94	        givenName: (user as any).metadata.givenName,
95	        familyName: (user as any).metadata.familyName,
96	      },
97	      permissions: initialState.permissions,
98	    }),
99	  )
100	}
101
102	export const login = (username: string, password: string): AppThunk => async (dispatch) => {
103	  try {
104	    const response = await remoteDb.logIn(username, password)
105	    const user = await remoteDb.getUser(response.name)
106	    dispatch(
107	      loginSuccess({
108	        user: {
109	          id: user._id,
110	          givenName: (user as any).metadata.givenName,
111	          familyName: (user as any).metadata.familyName,
112	        },
113	        permissions: initialState.permissions,
114	      }),
115	    )
116	  } catch (error) {
117	    if (!username || !password) {
118	      dispatch(
119	        loginError({
120	          message: 'user.login.error.message.required',
121	          username: 'user.login.error.username.required',
122	          password: 'user.login.error.password.required',
123	        }),
124	      )
125	    } else if (error.status === 401) {
126	      dispatch(
127	        loginError({
128	          message: 'user.login.error.message.incorrect',
129	        }),
130	      )
131	    }
132	  }
133	}
134
135	export const logout = (): AppThunk => async (dispatch) => {
136	  await remoteDb.logOut()
137	  dispatch(logoutSuccess())
138	}
139
140	export default userSlice.reducer
141	

Based on my research of the codebase, I can now give you a comprehensive answer about the client-side error handling and architectural design patterns.

---

The HospitalRun frontend codebase implements a fairly consistent but somewhat hybrid approach to client-side error handling and follows several clear architectural patterns.

## Error Handling Approach

**1. Domain-Specific Error Classes**

The codebase defines custom error classes for each domain entity, extending the base JavaScript `Error` class. These error classes carry field-specific validation errors as properties. For example, `IncidentError`, `PatientValidationError`, `LabError`, `AppointmentError`, and `ImagingRequestError` each hold properties corresponding to the specific fields that can fail validation (like `date`, `patient`, `type`, etc.). The error messages themselves are i18n translation keys (e.g., `'incidents.reports.error.dateRequired'`), which allows errors to be displayed in the user's language.

**2. Validation Functions**

Each domain has a dedicated validation utility in a `util/` or `utils/` folder (e.g., `validate-incident.ts`, `validate-patient.ts`, `validate-lab.ts`). These functions take an entity object, check each required field, and return an error object populated with i18n keys for any failed validations. If there are no errors, they either return an empty object or null.

**3. Error Throwing Pattern in Hooks**

Custom hooks that perform mutations (using `react-query`'s `useMutation`) call the validation function first. If validation fails, they throw the error object, which bubbles up to the calling component. For example, in `useRequestLab.ts`:
```
const requestLabErrors = validateLabRequest(newLab)
if (isEmpty(requestLabErrors)) {
return LabRepository.save(newLab)
}
throw requestLabErrors
```

The mutations are configured with `throwOnError: true`, ensuring errors propagate to components.

**4. Component-Level Try/Catch Handling**

UI components that trigger mutations wrap calls in try/catch blocks, catching the thrown error and storing it in local state. The error state then controls inline validation feedback on form fields. For instance, in `NewLabRequest.tsx`, the `onSave` handler catches validation errors and sets them via `setError(e)`, which then triggers `isInvalid={!!error?.patient}` and `feedback={t(error?.patient)}` props on form inputs.

**5. Visual Feedback Mechanisms**

The codebase uses several visual patterns:
- **Inline field validation**: Form fields receive `isInvalid` and `feedback` props that display red borders and translated error messages.
- **Alert banners**: The `<Alert>` component from `@hospitalrun/components` displays prominent error messages at the top of forms.
- **Toast notifications**: The `<Toaster>` component mounted in `HospitalRun.tsx` provides ephemeral success/error messages. Components call `Toast('success', ...)` for confirmations.
- **Loading spinners**: Components display `<Spinner>` while data is fetching, with react-query providing `isLoading` states.

**6. Network Status Handling**

A `NetworkStatusMessage` component uses a custom `useNetworkStatus` hook that listens to browser `online`/`offline` events, displaying a colored banner when connectivity changes.

## Architectural Design Patterns

**1. Feature-Based Folder Structure**

The codebase organizes code by domain feature (patients, labs, medications, incidents, imagings, scheduling) rather than by technical layer. Each feature folder contains its own components, hooks, models, and utilities.

**2. Custom Hooks Pattern**

Data fetching and mutations are abstracted into reusable custom hooks (`usePatient`, `useLab`, `useRequestLab`, `useCompleteLab`, etc.). These wrap `react-query`'s `useQuery` and `useMutation`, handling cache invalidation and providing a clean interface to components.

**3. Hybrid State Management**

The app uses two state management approaches:
- **Redux Toolkit with Thunks**: For global state like user session, permissions, patient creation/update, and medications. Slices handle loading/error/completed status with actions like `createPatientStart`, `createPatientSuccess`, `createPatientError`.
- **React Query**: For server state caching and mutations, particularly in newer or refactored features (incidents, labs, imaging, scheduling). This handles caching, background refetching, and optimistic updates.

**4. Repository Pattern**

Data access is abstracted through repository classes (`PatientRepository`, `LabRepository`, `IncidentRepository`) that extend a generic `Repository<T>` base class. These encapsulate PouchDB operations, providing `find`, `save`, `saveOrUpdate`, `delete`, and `search` methods.

**5. React Context for UI State**

Page-level UI concerns use React Context: `TitleContext` manages the page title, and `ButtonBarProvider` manages toolbar buttons. Both follow the state/dispatch pattern with separate contexts for reading and updating.

**6. Container/Presentational Separation (Loosely)**

While not strict, feature pages (like `NewLabRequest`) handle state and data while delegating display to shared form components (`TextInputWithLabelFormGroup`, `DateTimePickerWithLabelFormGroup`). These shared components accept `isInvalid` and `feedback` props for error display.

**7. i18n-First Error Messages**

All user-facing error strings are translation keys rather than hardcoded text, loaded through a `useTranslator` hook that wraps `i18next`. Locales are organized in `shared/locales/` with nested structures matching error key paths.

The overall approach is pragmatic and reasonably consistent, though there's some variation between features (some use Redux for mutations, others use react-query exclusively). The error handling is primarily form-level validation rather than global error boundaries, which means unexpected runtime errors may not be gracefully handled.


4. Now write the ideal answer, model a  summary, model a feedback,  model b summary model b feedback,justification. i want same level of details and evidence and writing style and lenght like this sample THIS IS SAMPLE FOR you below, READ CAREFULLY: 


SUPER IMPORTANT RULE YOU MUST FOLLOW. YOU MUST WRITE SAME WAY SAME QUALITY SAME FORMAT SAME STYLE AS SAMPLE BELOW!@!!!!!!!

——SAMPLE:—
—Every below is sample—

Ideal Response.

This ideal answer should clearly describe how Spring Petclinic wires its components through dependency injection using common patterns like constructor based injection, component scanning, and configuration-driven bean factories ...etc, and even dive deeper to explain how controllers (e.g.,src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java) declare all the collaborators in the constructors rather than in the fields, how stereotype annotations make those classes eligible for autodetection, how the repository abstractions are injected as interfaces implemented by the Spring Data JPA, and how @Configuration classes expose shared infrastructure beans that all the other components consume.
Model must explain that Spring Petclinic leans on constructor-based dependency injection to keep controllers explicit and testable. For example, it should explain controller like spring-petclinic/src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java is annotated with @Controller and declares a single constructor that takes an OwnerRepository, which has the role of letting Spring populate the dependency while preventing partially constructed instance. Model should point out that the controller never uses field injection or @Autowired on members, so the required collaborator is enforced at creation time. For example, in src/main/java/org/springframework/samples/petclinic/vet/VetController.java, whose constructor requires a VetRepository and assigns it to a final field, it is also relying on the container to supply the repository proxy. Even non-controller components follow this approach, for example src/main/java/org/springframework/samples/petclinic/owner/PetTypeFormatter.java, which is a @Component that exposes a Formatter<PetType> but takes its PetTypeRepository in the constructor, which is keeping parsing logic decoupled from storage details while still making the repository mandatory for instantiation.
Model must also explain repository layer demonstrates interface-driven injection. Interfaces such as spring-petclinic/src/main/java/org/springframework/samples/petclinic/owner/OwnerRepository.java extend Spring Data JPA’s JpaRepository, which is letting the framework auto-create runtime proxies that satisfy the dependency signatures declared in controllers and formatters.
Overall, the dependency injection explanation should ideally go deep and cover how @SpringBootApplication bootstraps component scanning, constructors declare required collaborators, repositories are injected as interfaces backed by generated proxies, and @Configuration classes publish shared infrastructure as beans.



Model A Response Summary

Model A did pretty well because it correctly identifiy constructor-based injection as the major dominant pattern and notes the absence of @Autowired, aligning with controllers like OwnerController and VetController that declare single-argument constructors for their repositories, which are src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java and src/main/java/org/springframework/samples/petclinic/vet/VetController.java,. It also correctly observes that PetTypeFormatter uses constructor injection as a component, which matches the formatters’ constructor-driven PetTypeRepository dependency. It points out that in src/main/java/org/springframework/samples/petclinic/owner/PetTypeFormatter.java, the response highlights component scanning via the stereotype annotations and the role of repository interfaces that Spring Data implements at runtime, dynamically, and consistent with the JpaRepository extension inside src/main/java/org/springframework/samples/petclinic/owner/OwnerRepository.java.  Overall, the summary gives good overview of the core DI patterns present in the codebase.
Model A Response Feedback

the answer is strong on constructor injection and the lack of @Autowired, both supported by the controller and formatter classes cited in summary above, which are very impressive findings in my opinion as tehy’re not that obvious. One area it could be improved is by referencing configuration-driven beans such as the cache and locale interceptors declared in CacheConfiguration and WebConfiguration , to show that DI also wires infrastructure services, not just repositories and controllers in files like src/main/java/org/springframework/samples/petclinic/system/CacheConfiguration,main/java/org/springframework/samples/petclinic/system/WebConfiguration.java. Mentioning of @SpringBootApplication as the trigger for component scanning would further strengthen the explanation by tying bean discovery to the application entry point in src/main/java/org/springframework/samples/petclinic/PetClinicApplication.java. These additions would align the response even more tightly with the full range of DI patterns in the repo. But overall, the model did pretty well despite these issues.

Model B Response Summary

Model B repeats the constructor-injection narrative and cites the same controllers (OwnerController, PetController, VetController, VisitController) and the PetTypeFormatter component under main/java/org/springframework/samples/petclinic/*, matching their constructor-based repository dependencies.It notes the absence of @Autowired/@Inject and correctly attributes bean registration to stereotype annotations and Spring Data proxies for repositories like OwnerRepository in src/main/java/org/springframework/samples/petclinic/owner/OwnerRepository.java†. The summary emphasizes constructor injection benefits but remains fairly high-level. Overall the model did not give an in-depth explanation and i believe the model did not really check the code thoroughly for the explanation. 
Model B Response Feedback

While this model is technically accurate about constructor injection and stereotype-based registration, but Model B stays generic and omits key DI elements present in the code which are obvious and should not be missed at all! It does not even mention the configuration classes that publish infrastructure beans (e.g., cache customization or locale handling), which are central examples of DI beyond the configurations like src/main/java/org/springframework/samples/petclinic/system/CacheConfiguration,src/main/java/org/springframework/samples/petclinic/system/WebConfiguration.java. The response also overlooks the @SpringBootApplication entry point that enables component scanning for all these beans such as in src/main/java/org/springframework/samples/petclinic/PetClinicApplication.java.Compared to Model A, it provides less depth on how DI wiring spans both application endpoints and shared infrastructure.
Overall Preference Justification

Model A is way better because it balances correctness about constructor injection with explicit recognition of repository interfaces and the role of component scanning, closely matching the structure seen in controllers, formatters, and repositories...etc such as src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java,src/main/java/org/springframework/samples/petclinic/owner/PetTypeFormatter.java,src/main/java/org/springframework/samples/petclinic/owner/OwnerRepository.java, Although both models miss some configuration details, Model A surfaces more of the actual DI practices visible in the code and provides a clearer link between stereotypes and injection than Model B, which remains more generic and omits infrastructure wiring examples such as ,src/main/java/org/springframework/samples/petclinic/system/CacheConfiguration.java,src/main/java/org/springframework/samples/petclinic/system/WebConfiguration.java.....etc. Therefore, Model A offers the stronger, more code-grounded explanation in my opinion.
